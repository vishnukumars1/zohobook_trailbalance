{% extends 'base.html' %}
{% block content %}
{% load static %}

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>






<style>
  .form-control{
        color: white;
    }

  .modal-content{
        color-scheme: black;
        color: white;
        background-color:#464545fd;
        border: 1px solid rgb(138, 135, 135);
    }

  input {
      color-scheme: dark;
   }

   select{
    color-scheme: dark;
   }

  #searchInput {
  margin-bottom: 10px;
  }

  .section-3
    {
        display: flex;
        justify-content: flex-start;
        align-items: center;
        gap: 1rem;
        margin-bottom: 1.5rem;
        margin-top: 1rem;
    }

    label{
        color: white;
    }

    .section-3 .section-toggle
    {
        margin-bottom: 0.50rem;
    }
     .section-toggle a
    {

        color: rgb(230, 171, 45);
        font-family: Cambria, Cochin, Georgia, Times, 'Times New Roman', serif;
        font-size:1.275rem;
    }
    .add_another
    {
       
        color: rgb(230, 171, 45);
    }
    #tbl thead th{
        font-size: 0.785rem;
    }
    @media (max-width:700px)
    {
    .section-3
    {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr 1fr ;  

    }
    .section-3 .section-toggle a
    {

        color: rgb(230, 171, 45);
        font-family: Cambria, Cochin, Georgia, Times, 'Times New Roman', serif;
        font-size:0.875rem;
    }
    }

    /* Account Modal */

  .select-box1 {
      position: relative;
      width: 100%;
  }
  

  .select-option1 {
      position: relative;
      
  }

  .select-option1 input {
      width: 100%;
      cursor: pointer;
      background-color: white;
      color: black;
      border-radius: 7px;
      padding: 10px 15px;
      border: 0 !important;
      outline: 0 !important;
  }

  .select-option1:after {
      content: "";
      border-top: 12px solid #000;
      border-left: 8px solid transparent;
      border-right: 8px solid transparent;
      position: absolute;
      right: 15px;
      top: 50%;
      margin-top: -8px;

  }

  .content1 {
      background-color: white;
      position: absolute;
      color: black;
      border-radius: 7px;
      margin-top: 15px;
      width: 100%;
      z-index: 999;
      padding: 20px;
      display: none;
  }

  .search1 input {
      width: 100%;
      font-size: 17px;
      padding: 15px;
      outline: 0;
      border: 1px solid #b3b3b3;
      border-radius: 5px;
  }

  .options1 {
      margin-top: 10px;
      max-height: 150px;
      overflow-y: scroll;
      padding: 0;
  }

  /* .options1::-webkit-scrollbar{
      width: 5px;
     
    } */
  .options1 li {
      padding: 10px 15px;
      border-radius: 5px;
      cursor: pointer;
      border-bottom: 1px solid gray;
  }

  .select-box1.active .content1 {
      display: block;
  }

  .select-box1.active .select-option1:after {
      transform: rotate(-180deg);
  }

  .selectize-input {
    background-color: #000 !important;
    color: white !important;
  }

  .dropdown-item.customers-options:hover, .dropdown-item.items-options:hover{
    background: white !important;
    color: black !important;
    cursor: pointer;
  }

  ::-webkit-scrollbar {
    display: none;
  }

  ::-webkit-scrollbar-track {
    background: #f1f1f1; 
  }

  ::-webkit-scrollbar-thumb {
    background: #888; 
  }

  ::-webkit-scrollbar-thumb:hover {
    background: #555; 
  }
  
</style>

<!-- Bootstrap JS, Popper.js, and jQuery -->
<!-- <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script> -->

<link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.1.0-beta.1/css/select2.min.css" rel="stylesheet" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.1.0-beta.1/js/select2.min.js"></script>
  <style>
    /* Optional styling */
    .select2-container {
      width: 200px; /* Set the width as you desire */
    }
  </style>



<body>

    <div class="body-wrapper">
        <div class="container-fluid">
          <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
              <li class="breadcrumb-item"><a {% if login_d.user_type == 'Company' %} href="{% url 'company_dashboard' %}" {% else %} href="{% url 'staff_dashboard' %}" {% endif %} class="text-warning-emphasis">Dashboard</a></li>
              <li class="breadcrumb-item"><a href="{% url 'sales_estimate' %}" class="text-warning-emphasis">Estimate</a></li>
              <li class="breadcrumb-item" aria-current="page">Add</li>
            </ol>
          </nav>

          <div style="overflow-x:auto;background-color: black;border-radius: 10px;color: white;" class="m-3 p-5">
            <h1 class="text-white mb-3 mt-3">NEW ESTIMATE</h1>
            <hr style="color: yellow;" class="mb-5">

            


            <form  method="POST" action="{% url 'sales_estimate_new_add' %}"  enctype="multipart/form-data" class="mb-3">
                {% csrf_token %}

                <input type="text" id="cmpstate" hidden value="{{cmp.state}}">

                <div class="form-group row mt-4">
                    <div class="col-sm-12 col-md-3 col-lg-3 col-form-label">
                        <label for="" class="labels">Customer</label>
                    </div>
                    <div class="col-sm-12 col-md-6 col-lg-7">
                    
                        <input type="hidden" name="customerId" id="customerId" value="">
                        <div class="d-flex">
                            <div class="w-100">
                                <div class="p-0 border-0 bg-none position-relative drop-box">
                                    <input required type="text" id="customer" value="" name="customer" class="dropdown-toggle form-control text-white customers-display" onkeyup="filterCustomers()" data-bs-toggle="dropdown" aria-expanded="false" placeholder="Select Customer.." autocomplete="off">
                                    <ul class="dropdown-menu w-100 customers-available position-absolute bg-black text-white" id="cust_drop"  style="overflow-y: auto; height: fit-content;max-height: 40vh; border: 1px solid gray;"> 
                                        <li class="dropdown-item customers-options text-white" onclick="getCustomerDetails('','')">Select Customer</li>
                                        {% for cust in customer %}
                                        <li class="dropdown-item customers-options text-white" onclick="getCustomerDetails(`{{cust.id}}`,this.innerHTML)">{{ cust.title }} {{ cust.first_name }} {{ cust.last_name }}</li>
                                        {% endfor %}
                                    </ul>
                                    
                                </div>
                            </div>
                            <button type="button" data-toggle="modal" data-target="#newCustomer" class="btn btn-outline-warning py-2 ms-1"><i class="fa fa-plus text-yellow"></i></button>
                        </div>
                    </div>
                </div>




                <div class="form-group row mt-4">
                  <div class="col-sm-12 col-md-3 col-lg-3 col-form-label">
                      <label>Email</label>
                  </div>
                  <div class="col-sm-12 col-md-6 col-lg-7">
                      <input  type="email" class="form-control" name="email" id="customerEmail" readonly>     
                      <div class="invalid-feedback">Please fill out this field.</div>   

                  </div>
                </div>

                <div class="form-group row mt-4" id="billAddressSection" style="display: none;">
                    <div class="col-sm-12 col-md-3 col-lg-3 col-form-label">
                        <label>Billing Address</label>
                    </div>
                    <div class="col-sm-12 col-md-6 col-lg-7">
                        <textarea class="form-control" name="billingAddress" id="billAddress" rows="4" readonly></textarea>     
                        <div class="invalid-feedback">Please fill out this field.</div>   
                    </div>
                </div>

                <div class="form-group row mt-4">
                    <div class="col-sm-12 col-md-3 col-lg-3 col-form-label">
                        <label>GST Treatment</label>
                    </div>
                    <div class="col-sm-12 col-md-6 col-lg-7">
                        <input  type="text" class="form-control" name="gst_treatment" id="customerGstType" readonly>     
                        <div class="invalid-feedback">Please fill out this field.</div>   
                    </div>
                </div>

                <div class="form-group row mt-4" id="customerGstInDisplay" style="display: none;">
                    <div class="col-sm-12 col-md-3 col-lg-3 col-form-label">
                        <label>GST Number</label>
                    </div>
                    <div class="col-sm-12 col-md-6 col-lg-7">
                        <input  type="text" class="form-control" name="gst_number" id="customerGSTIN" readonly>     
                        <div class="invalid-feedback">Please fill out this field.</div>   
                    </div>
                </div>

                <div class="form-group row mt-4">
                    <div class="col-sm-12 col-md-3 col-lg-3 col-form-label">
                        <label>Place of Supply</label>
                    </div>
                    <div class="col-sm-12 col-md-6 col-lg-7">
                        <input hidden value="{{cmp.state}}" id="cmpstate">
                        <select name="place_of_supply" id="placeOfSupply" class="form-control">
                            <option value="" selected></option>
                            <option value="[AN]-Andaman And Nicobar Islands">[AN]-Andaman And Nicobar Islands</option>
                            <option value="[AD]-Andhra Pradesh">[AD]-Andhra Pradesh</option>
                            <option value="[AR]-Arunachal Pradesh">[AR]-Arunachal Pradesh	</option> 
                            <option value="volvo">[AS]-Assam</option>
                            <option value="[BR]-Bihar">[BR]-Bihar</option> 
                            <option value="volvo">[CH]-	Chandhigarh</option>
                            <option value="[CG]-Chattisgarh">[CG]-Chattisgarh</option>
                            <option value="[DD]-Daman Diu">[DD]-Daman Diu</option>
                            <option value="volvo">[DL]-	Delhi</option>
                            <option value="[GA]-Goa">[GA]-Goa</option> 
                            <option value="[GJ]-Gujarat">[GJ]-Gujarat</option>
                            <option value="[HR]-Haryana">[HR]-Haryana</option> 
                            <option value="[HP]-Himachal Pradesh">[HP]-Himachal Pradesh</option>
                            <option value="[JK]-Jammu And Kashmir">[JK]-Jammu And Kashmir</option>
                            <option value="[JH]-Jharkand">[JH]-Jharkand</option>
                            <option value="[KA]-Karnataka">[KA]-Karnataka</option>
                            <option value="[KL]-Kerala">[KL]-Kerala</option>
                            <option value="[LA]-Ladakh">[LA]-Ladakh</option>
                            <option value="[LD]-Lakshadweep">[LD]-Lakshadweep</option>
                            <option value="[MP]-Madhyapradesh">[MP]-Madhyapradesh</option>
                            <option value="[MH]-Maharashtra">[MH]-Maharashtra</option>
                            <option value="[MN]-Manipur">[MN]-Manipur</option>  
                            <option value="[ML]-Meghalaya">[ML]-Meghalaya</option>
                            <option value="[MZ]-Mizoram">[MZ]-Mizoram</option>
                            <option value="[NL]-Nagaland">[NL]-Nagaland</option> 
                            <option value="[NL]-Nagaland">[NL]-Nagaland</option>
                            <option value="[OD]-Odisha">[OD]-Odisha</option>
                            <option value="[PY]-Puducherry">[PY]-Puducherry</option>
                            <option value="[PB]-Punjab">[PB]-Punjab.</option>
                            <option value="[RL]-Rajasthan">[RL]-Rajasthan</option>
                            <option value="[SK]-Sikkim">[SK]-Sikkim</option>
                            <option value="[TN]-Tamilnadu">[TN]-Tamilnadu</option>
                            <option value="[TS]-Telenghana">[TS]-Telenghana</option>
                            <option value="[TR]-Tripura">[TR]-Tripura</option>
                            <option value="[UP]-Uttar Pradesh">[UP]-Uttar Pradesh</option>
                            <option value="[UK]-Utharakhand">[UK]-Utharakhand</option>
                            <option value="[WB]-West Bengal">[WB]-West Bengal</option>
                            <option value="[OT]-Other Territory">[OT]-Other Territory</option>
                        </select>     
                        <div class="invalid-feedback">Please fill out this field.</div>   
                    </div>
                </div>

                <div class="form-group row mt-4">
                    <div class="col-sm-12 col-md-3 col-lg-3 col-form-label">
                        <label>Estimate No</label>
                    </div>
                    <div class="col-sm-12 col-md-6 col-lg-7">
                        <input  type="text" class="form-control" id="estNumber" name="estimate_no" placeholder="{{est_no}}" required >     
                        <span class="text-danger ml-1" id="estNoErr"></span>  
                    </div>
                </div>
                
                <div class="form-group row mt-4">
                    <div class="col-sm-12 col-md-3 col-lg-3 col-form-label">
                        <label>Reference No</label>
                    </div>
                    <div class="col-sm-12 col-md-6 col-lg-7">
                        <input  type="number" class="form-control" name="reference_no" value="{{ref_no}}"  readonly>     
                        <div class="invalid-feedback">Please fill out this field.</div>   

                    </div>
                  </div>

                <div class="form-group row mt-4">
                    <div class="col-sm-12 col-md-3 col-lg-3 col-form-label">
                        <label>Estimate Date</label>
                    </div>
                    <div class="col-sm-12 col-md-6 col-lg-7">
                        <input id="est_date" type="date" class="form-control" name="estimate_date" required  value="{% now 'Y-m-d' %}" style="color-scheme: dark;">     
                        <div class="invalid-feedback">Please fill out this field.</div>   
                    </div>
                </div>




                <div class="form-group row mt-4">
                    <div class="col-sm-12 col-md-3 col-lg-3 col-form-label">
                      <label>Payment Terms</label>
                    </div>
                    <div class="col-sm-12 col-md-6 col-lg-7">
                        <div class="d-flex">
                            <div class="w-100">
                                <select name="payment_term" id="paytearm-select1" class="form-control">
                            
                                    <option selected>Select a payment_term</option>
                                    {% for pay_terms in comp_payment_terms %}
                                    <option value="{{pay_terms.id}}" text="{{pay_terms.days}}" >{{pay_terms.term_name}}</option>
                                    {% endfor %}
                                    
                                </select>
                            </div>
                            <!-- Button to trigger modal -->
                            <button class="btn btn-outline-warning text-yellow" type="button" data-bs-toggle="modal" data-bs-target="#newpaymentTerm"><i class="fa fa-plus text-yellow"></i></button>

                        </div>
                    </div>
                </div>





                






                
                <div class="form-group row mt-4">
                    <div class="col-sm-12 col-md-3 col-lg-3 col-form-label">
                        <label>Expiration Date</label>
                    </div>
                    <div class="col-sm-12 col-md-6 col-lg-7">
                        <input id="exp_date" type="date" class="form-control" name="exp_date" required readonly style="color-scheme: dark;">     
                        <div class="invalid-feedback">Please fill out this field.</div>   
                    </div>
                </div>




                <div class="row mt-4">
                    <div class="col-12 table-responsive">
                      <table class="table table-bordered" id="estimateItemsTable">
                        <thead>
                            <tr>
                                <th class="text-center text-white" style="width: 3%;">#</th>
                                <th class="text-center text-white" style="width: 20%;">PRODUCT</th>
                                <th class="text-center text-white" style="width: 11%;">HSN</th>
                                <th class="text-center text-white" style="width: 15%;">QTY</th>
                                <th class="text-center text-white" style="width: 12%;">PRICE</th>
                                <th class="text-center text-white" style="width: 15%;">TAX (%)</th>
                                <th class="text-center text-white" style="width: 9%;">DISCOUNT</th>
                                <th class="text-center text-white" style="width: 12%;">TOTAL</th>
                                <th style="width: 3%;"></th>
                            </tr>
                        </thead>
                        <tbody id="items-table-body">
                            <tr id='tab_row1'>
                                <td class="nnum  bg-black text-white" style="text-align: center;">1</td>
                                <td>
                                    <input type="hidden" name="itemId[]" id="itemId1" value="">
                                    <div class="d-flex">
                                        <div class="w-100">
                                            <div class="p-0 border-0 bg-none position-relative drop-box" style="display: block;">
                                                <input required type="text" id="item1" value="" name="item_name[]" class="dropdown-toggle form-control text-white item-display" onkeyup="filterFunction()"  data-bs-toggle="dropdown" aria-expanded="false" placeholder="Items.." autocomplete="off">
                                                <ul class="dropdown-menu w-100 items-available position-absolute bg-black text-white" id="menu1"  style="overflow-y: auto; height: fit-content;max-height: 40vh; border: 1px solid gray;"> 
                                                    {% for i in items %}
                                                    <li class="dropdown-item items-options text-white" onclick="get_item_details($(this).parent().prev().attr('id'),`{{i.item_name}}`,'{{i.id}}')">{{i.item_name}}</li>
                                                    {% endfor %}
                                                </ul>
                                                
                                            </div>
                                        </div>
                                        <a href="#">
                                            <button type="button" class="btn btn-outline-warning ms-1" data-target="#newItem" data-toggle="modal"><i class="fa fa-plus text-yellow"></i></button>
                                        </a>
                                    </div>
                                
                                </td>
                                <td>
                                    <input type="hidden" name="item_id[]" id="itemId1">
                                    <input type="hidden" name="id[]">
                                    <input type="text" name='hsn[]' id="hsn1" placeholder='HSN' class="form-control bg-black text-white HSNCODE" readonly />
                                </td>
                                <td >
                                    <input type="number" name='qty[]' id="qty1"  class="form-control bg-black text-white qty mb-1" step=0 min=1 value=0 onchange="changeItemQty(this.id)" required/>
                                    <input type="text" id="avl1" style="display: none;">
                                    <div class="d-flex text-white" style="font-size: 0.7rem;"><span>Available Qty:</span><span id="qtyspan1" class=''></span></div>
                                </td>
                                <td>
                                    <input type="number" name='price[]' id="price1" class="form-control bg-black text-white price" step="0.00" min="0" style="display: block;" value=0 readonly />
                                    <input type="number" name='priceListPrice[]' id="priceListPrice1" class="form-control bg-black text-white priceListPrice" step="0.00" min="0" style="display: none;" value=0 readonly />
                                </td>
                                
                                <td>
                                    <!-- <input type="text"  id="select_tax" placeholder="Tax Rate" class="form-control seltax d-flex"> -->
                                    <select name='taxGST[]' id="taxGST1" class="form-control bg-black text-white tax_ref tax_ref_gst" style="display: block;" onchange="taxchange(this.id)">
                                        <option selected disabled hidden>Select GST</option>
                                        <option value=28 >28.0% GST</option>
                                        <option value=18 >18.0% GST</option>
                                        <option value=12 >12.0% GST</option>
                                        <option value=5 >05.0% GST</option>
                                        <option value=3 >03.0% GST</option>
                                        <option value=0 >0.0% GST</option>
                                    </select>
                                    <select name='taxIGST[]' id="taxIGST1" class="form-control bg-black text-white tax_ref tax_ref_igst" style="display: none;" onchange="taxchange(this.id)">
                                        <option selected disabled hidden >Select IGST</option>
                                        <option value=28 >28.0% IGST</option>
                                        <option value=18 >18.0% IGST</option>
                                        <option value=12 >12.0% IGST</option>
                                        <option value=5 >05.0% IGST</option>
                                        <option value=3 >03.0% IGST</option>
                                        <option value=0 >0.0% IGST</option>
                                    </select>
                                    <div class="mt-1" style=" text-align: center;color: red;" ><span id="invalidtax1" style="display: none;"> Invalid Tax %</span> </div>    
                                </td>
                                <td >
                                    <input type="number" name='discount[]'  placeholder='Enter Discount' id="disc1" value=0 class="form-control bg-black text-white disc" step='any' min=0  />
                                </td>
    
                                <td><input type="number" name='total[]' id="total1" class="form-control bg-black text-white total" value=0 readonly /></td>
                                <td style="display: none;"><input type="hidden" id="taxamount1" class="form-control itemTaxAmount" /></td>
                                <td>
                                  <i class="fa fa-trash text-danger remove_row" style="cursor: pointer;" title="Remove Row" id="1"></i>
                                </td>

                            </tr>
                        </tbody>
                        <tr>
                            <td colspan="9"><a class="btn btn-outline-warning ms-1" role="button" id="add" ><i class="fa fa-plus text-yellow"></i></a></td>
                        </tr>
                      </table>
                    </div>
                  </div>
    




                        <div class="row clearfix" style="margin-top:20px">
                            <div class="col-md-6">
                                <textarea class="form-control bg-black text-white mt-3"  id="" name="description" placeholder="Note" style="height: 190px;"></textarea>
                                <input type="file" class="form-control" name="file"  style="margin-top: 10px;">
                                <textarea class="form-control bg-black text-white mt-3"  id="" name="terms" placeholder="Terms & conditions" style="height: 130px;"></textarea>
                            </div>            
                            <div class="col-md-1"></div>
                            <div class="col-md-5 table-responsive-md mt-3 " id="invoiceItemsTableTotal" style="background-color:rgba(0,0,0,.4); border: 1px solid rgba(128, 128, 128, 0.6); margin-left: -2vh;">
                                <div class="p-3">
                                    <div class="row container-fluid p-2 m-0">
                                        <div class="col-sm-4 mt-2"><label class="text-center text-white">Sub Total</label></div>
                                        <div class="col-sm-1 mt-2">:</div>
                                        <div class="col-sm-7 mt-2"><input type="number" step="any" name='subtotal' value=0.00 readonly class="form-control bg-black text-white" id="sub_total"></div>
                                    </div>
                                    <div class="row container-fluid p-2 m-0" id="taxamountIGST" style="display: flex;">
                                        <div class="col-sm-4 mt-2"><label for="a" class="text-center text-white">IGST</label></div>
                                        <div class="col-sm-1 mt-2">:</div>
                                        <div class="col-sm-7 mt-2"><input type="number" name='igst' step="any" id="igstAmount" value=0.00 readonly class="form-control bg-black text-white"/></div>
                                    </div>
                                    <div class="row container-fluid p-2 m-0" style="display: none;" id="taxamountCGST">
                                        <div class="col-sm-4 mt-2"><label for="a" class="text-center text-white">CGST</label></div>
                                        <div class="col-sm-1 mt-2">:</div>
                                        <div class="col-sm-7 mt-2"><input type="number" name='cgst' step="any" id="cgstAmount" value=0.00 readonly class="form-control bg-black text-white"/></div>
                                    </div>
                                    <div class="row container-fluid p-2 m-0" style="display: none;" id="taxamountSGST">
                                        <div class="col-sm-4 mt-2"><label for="a" class="text-cente text-white">SGST</label></div>
                                        <div class="col-sm-1 mt-2">:</div>
                                        <div class="col-sm-7 mt-2"><input type="number" name='sgst' step="any" id="sgstAmount" value=0.00 readonly class="form-control bg-black text-white"/></div>
                                    </div>
                                    <div class="row container-fluid p-2 m-0">
                                        <div class="col-sm-4 mt-2"><label for="a" class="text-center text-white">Tax Amount</label></div>
                                        <div class="col-sm-1 mt-2">:</div>
                                        <div class="col-sm-7 mt-2"><input type="number" step="any" name='taxamount' id="tax_amount" value=0.00 readonly class="form-control bg-black text-white"/></div>
                                    </div>
                                    
                                    <div class="row container-fluid p-2 m-0">
                                        <div class="col-sm-4 mt-2"><label for="a" class="text-center text-white">Ship Charge</label></div>
                                        <div class="col-sm-1 mt-2">:</div>
                                        <div class="col-sm-7 mt-2"><input type="number" step="any" name='ship' id="ship" value=0.00 class="form-control bg-black text-white"/></div>
                                    </div>
                                    <div class="row container-fluid p-2 m-0">
                                        <div class="col-sm-4 mt-2"><label for="a" class="text-center text-white">Adjustment</label></div>
                                        <div class="col-sm-1 mt-2">:</div>
                                        <div class="col-sm-7 mt-2"><input type="number" step="any" name='adj' id="adj" value=0.00 class="form-control bg-black text-white"/></div>
                                    </div>
                                    <div class="row container-fluid p-2 m-0">
                                        <div class="col-sm-4 mt-2"><label for="a" class="text-center text-white">Grand Total</label></div>
                                        <div class="col-sm-1 mt-2">:</div>
                                        <div class="col-sm-7 mt-2"><input type="number" name='grandtotal' id="grandtotal" value=0.00 readonly class="form-control bg-black text-white"/></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <br>
                        <div class="mt-4">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="" id="agreeTerms" required>
                            <label for="agreeTerms">Agree to terms and conditions</label>
                            <div class="invalid-feedback">You must agree before submitting.</div>
                        </div>
                        </div>
                        <div class="mt-4">
                        <input type="submit" class="btn save_btn" style="background-color: chocolate; color: white;" value="Save" name="Save" id="Save">
                        <input type="submit" class="btn save_btn" style="background-color: chocolate; color: white;"  value="Draft" name="Draft" id="Draft">
                        <input class="btn save_btn" style="background-color: chocolate; color: white;" type="reset" onclick="window.location.href=`{% url 'sales_estimate_new' %}`" value="CANCEL" id="cancel">
                        </div>
            </form>



            <!--------------- Payments Term modal ----------------->

            <div class="modal fade" id="newpaymentTerm">
                <div class="modal-dialog modal-md">
                <div class="modal-content" style="background: rgb(32, 35, 37);border-radius: 20px;">
                    <div class="modal-header " style="background: rgb(32, 35, 37);">
                        <h3 class="m-3 text-uppercase" style="color: white;">Add Payment Term</h3>
                        <button type="button" class="close btn btn-danger close_pay_modal" data-dismiss="modal">
                            <span class="close-button"  aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body" style="background: rgb(32, 35, 37);">
                    <div class="card p-3 m-3" style="background-color: black;">
                        <form  id="modalPayment_terms1">
                        
            
            
                        <div class="row mt-2">
            
                            <div class="col-lg-12 col-md-12 col-sm-12 mt-2">
                                <label for="termname" style="color: white">Term Name *</label>

                            <input type="text " class="form-control mt-2" id="tname1" name="term_name" autocapitalize="characters" required> 
                            <span id="message-id" class="mt-1 text-danger" style="font-size: 10px;"></span> 
                            <span id="success-message-id" class=" mt-1 text-success" style="font-size: 10px;"></span>    
                            </div>
            
                            <div class="col-lg-12 col-md-12 col-sm-12 mt-2">
                                <label for="termdays" style="color: white">Number of Days *</label>

                            <input type="number" class="form-control mt-2" id="tdays1" name="term_days" autocapitalize="characters" required>
                            </div>
                            <div class="col-md-2 mt-2"></div>
            
                        </div>
                        
                        <div class="row mt-5">
                            <div class="col-lg-12 col-md-12 col-sm-12">
                            <div class="d-flex">
                                <button class="btn save_btn rounded-pill text-grey w-50 my-1 mx-1 btn-outline-warning "
                                type="button" data-dismiss="modal"  id="termSave1">Save
                                </button> 
                                
            
                                <button type="button" class="close btn save_btn rounded-pill text-grey w-50 my-1 mx-1 btn-outline-warning" 
                                data-dismiss="modal" aria-label="Close" onclick="closePaymodal()">
                                    <span aria-hidden="true">Cancel</span>
                                </button>
                            </div>
                            </div>
                        </div>
                        </form>
                    </div>
                    </div>
                </div>
                </div>  
            </div> 

            <!------------------- Payments Term modal End -------------->
                        




            <!-- New Item Modal -->
            <div class="modal fade" id="newItem">
                <div class="modal-dialog modal-xl">
                <div class="modal-content" style="background: rgb(32, 35, 37);border-radius: 20px;">
                    <div class="modal-header px-3" style="background: rgb(32, 35, 37);">
                        <h3 class="text-uppercase" style="color: white;">Add New Item</h3>
                        <button type="button" class="close btn btn-danger" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body" style="background: rgb(32, 35, 37);">
                    <div class="card px-2 py-4" style="background-color: #000;">
                        <form id="newItemForm">
                        {% csrf_token %}
                        <fieldset class="form-group" >
                                <div class="row mt-3">
                                <hr>
                                    <div class="col-12 col-md-10">
                                    <label class="col-12 col-md-2 col-form-label pt-3" style="color: aliceblue;">Type  &nbsp;&nbsp;<i class="fa fa-question-circle"></i></label>
                                        <div class="form-check form-check-inline">
                                            <input required class="form-check-input" type="radio" name="itemType" id="gridRadios1" value="Goods">
                                            <label class="form-check-label text-white" for="gridRadios1">Goods</label>
                                        </div> &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;
                                        <div class="form-check form-check-inline ml-md-3">
                                            <input required class="form-check-input" type="radio" name="itemType" id="gridRadios2" value="Services">
                                            <label class="form-check-label text-white" for="gridRadios2">Services</label>
                                        </div>
                                    </div>
                                </div>
                            </fieldset>
                            <div class="form-group row mt-3">
                                <label  class="col-sm-2 col-form-label " style="color: aliceblue;">Name *</label>
                                <div class="col-sm-10 col-md-7 col-9" style="margin-left: -2.2rem;">
                                <input required type="text" class="form-control" name="name" id="nameInput" style="color: aliceblue;" placeholder="Enter Item Name">  
                                </div>
                            </div>
                            <div class="form-group row mt-3">
                                <label class="col-sm-2 col-form-label" style="color: aliceblue;">Unit <i class="fa fa-question-circle"></i></label>
                                <div class="col-sm-10 col-md-7 col-9" style="margin-left: -2.2rem;">
                                    <div class="d-flex align-items-center">
                                        <select name="unit" class="form-control bg-black text-white" id="selunit" >
                                        {% for i in units %}
                                            <option value={{i.id}}>{{i.unit_name}}</option>
                                        {% endfor %}
                                        </select>                      
                                        <a class="btn btn-outline-warning py-2 ms-1" style="cursor: pointer;" data-toggle="modal" data-target="#unitmodal" style="height: 38px;">+</a>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group row mt-3">
                                <label class="col-sm-2 col-form-label" style="color: aliceblue;">HSN Code</label>
                                <div class="col-sm-10 col-md-7 col-9" style="margin-left: -2.2rem;">
                                    <input required type="text" class="form-control" name="hsn" required id="myInputField" style="color: aliceblue;" placeholder="Enter six digit HSN code" oninput="validateInput()">
                                    <div id="validationResult"></div>
                                </div>
                            </div>
                            <fieldset class="form-group mt-3" >
                                <div class="row">
                            
                                    <div class="col-12 col-md-10">
                                    <label class="col-12 col-md-2 col-form-label pt-3" style="color: aliceblue;">Tax Preference: &nbsp;&nbsp;</label>
                                        <div class="form-check form-check-inline">
                                            <input required class="form-check-input" type="radio" name="radio" id="gridRadios3" onclick="showAllSelect()" value="taxable">
                                            <label class="form-check-label text-white" for="gridRadios3">Taxable</label>
                                        </div> &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp;
                                        <div class="form-check form-check-inline ml-md-3">
                                            <input required class="form-check-input" type="radio" name="radio" id="gridRadios4"  onclick="hideAllSelect()" value="None-Taxable">
                                            <label class="form-check-label text-white" for="gridRadios4"> None-Taxable</label>
                                        </div>
                                    </div>
                                </div>
                            </fieldset>

                            <div class="row mt-3">
                                <div class="col-md-3">
                                    <div id="select1_div" style="display: none;">
                                        <label for="select1">Intra-State TAX</label><br> <br>
                                        <select name="intra" class="form-control" id="intraStateTax" style="background-color: black; color: white;">
                                            <option value="0">GST0[0%]</option>
                                            <option value="3">GST3[3%]</option>
                                            <option value="5">GST5[5%]</option>
                                            <option value="12">GST12[12%]</option>
                                            <option value="18">GST18[18%]</option>
                                            <option value="28">GST28[28%]</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div id="select2_div" style="display: none;">
                                        <label for="select2">Inter-State TAX</label> <br><br>
                                        <select name="inter" class="form-control " id="interStateTax" style="background-color: black; color: white;">
                                            <option value="0">IGST0[0%]</option>
                                            <option value="3">IGST3[3%]</option>
                                            <option value="5">IGST5[5%]</option>
                                            <option value="12">IGST12[12%]</option>
                                            <option value="18">IGST18[18%]]</option>
                                            <option value="28">IGST28[28%]</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row mt-3">
                                <div class="col-md-6">
                                <input  type="checkbox" name="selling" checked> <label >selling  information</label><br><br>
                                <div class="form-group row mt-3">
                                    <label class="col-4 col-form-label" style="color: aliceblue;">Selling price </label>
                                    <div class="col-sm-8 col-md-8 col-8">
                                    <div class="input-group mb-2">
                                        <div class="input-group-prepend">
                                        <div class="input-group-text text-white" style="background-color: black;">INR</div>
                                        </div>
                                        <input required type="text" id="salesprice" name="sel_price" style="color: #ede4e4;" class="form-control">
                                    </div>
                                    </div>
                                </div>

                                <div class="form-group row mt-3">
                                    <label  class="col-4 col-form-label" style="color: aliceblue;">Account *</label>
                                    <div class="col-sm-18 col-md-8 col-8">
                                    <select name="sel_acc" class="form-control " id="salesAccount">
                                        <option value=" ">--Select Account--</option>
                                        <option value="General Income">General Income</option>
                                        <option value="Interest Income">Interest Income</option>
                                        <option value="Late Fee  Income">Late Fee  Income</option>  
                                        <option value="Discount Income">Discount Income</option>
                                        <option value="Other Charges">Other Charges</option>
                                        <option value="Shipping Charge">Shipping Charge</option>
                                    
                                    </select>                              
                                    </div>
                                </div>
                                <div class="form-group row mt-3">
                                    <label  class="col-4 col-form-label" style="color: aliceblue;">Description </label>
                                    <div class="col-sm-18 col-md-8 col-8">
                                    <input  type="text" id="salesDescription" style="color: #ede4e4;" name="sel_desc" class="form-control " placeholder="Enter Discription">
                                    </div>
                                </div>
                                                        
                                </div>
                                <div class="col-md-6">
                                <input type="checkbox" name="purchase" checked> <label for="">Purchase information</label><br><br>
                                <div class="form-group row mt-3">
                                    <label  class="col-4 col-form-label" style="color: aliceblue;">Cost Price*</label>
                                    <div class="col-sm-8 col-md-8 col-8">
                                    <div class="input-group mb-2">
                                        <div class="input-group-prepend">
                                        <div class="input-group-text text-white" style="background-color: black;">INR</div>
                                        </div>
                                        <input required type="text" id="purprice" style="color: #ede4e4;" class="form-control " name="cost_price" >
                                    </div>
                                    </div>
                                </div>
                                <div class="form-group row mt-3 in">
                        
                                    <label class="col-4 col-form-label" style="color: aliceblue;">Account*</label>
                                    <div class="col-sm-8 col-md-8 col-8">
                                        <div class="d-flex align-items-center">
                                            <select name="cost_acc" class="form-control text-white bg-black" id="myaccount" style="background-color: black; color: white;" required>
                                            <option value="">--Select Account--</option>
                                            <optgroup id="expensesel" label="Expense">
                                        
                                            {% for i in accounts %}
                
                                            {% if i.account_type == 'Expense' %}
                                            
                                                <option value="{{i.account_name}}">{{i.account_name}}</option>
                                        
                                            {% endif %}
                                            {% endfor %}
                                            </optgroup>
                                            <optgroup id="costofgoods" label="Cost Of Goods Sold">
                                            {% for i in accounts %}
                                            {% if i.account_type == 'Cost Of Goods Sold' %}
                                        
                                                <option value="{{i.account_name}}">{{i.account_name}}</option>
                                                
                                                {% endif %}
                                                {% endfor %}
                                            </optgroup>
                                            <optgroup id="otherexpensesel" label="Other Expense">
                                            {% for i in accounts %}
                                            {% if i.account_type == 'Other Expense' %}
                                        
                                                <option value="{{i.account_name}}">{{i.account_name}}</option>
                                                
                                                {% endif %}
                                                {% endfor %}
                                            </optgroup>
                                
                                            
                                        
                                            </select>                    
                                            <a class="btn btn-outline-warning py-2 ms-1" style="cursor: pointer;" data-toggle="modal" data-target="#newAccount" style="height: 38px;">+</a>
                    
                                        </div>
                                    
                                    </div>
                                </div>
                                <div class="form-group mt-3 row in">
                                    <label class="col-4 col-form-label" style="color: aliceblue;">Description</label>
                                    <div class="col-sm-8 col-md-8 col-8">
                                        <div class="d-flex align-items-center">
                                            <input  type="text" style="color: #ede4e4;" name="pur_desc" id="purchaseDescription" class="form-control " placeholder="Enter Discription">
                                        </div>
                                    </div>
                                </div>
                                </div>
                            </div>

                            <div class="form-group row mt-3">
                                <label class="col-sm-4 col-form-label" style="color: aliceblue;">Minimum Stock to maintain :</label>
                                <div class="col-sm-8 col-md-8 col-8 d-flex align-items-center">
                                <input type="number" style="color: #ede4e4;" id="minStock" name="minimum_stock" class="form-control mx-auto" placeholder="Enter Minimum Stock">
                                </div>
                            </div>

                            <div class="row mt-3" >
                                <div class="col-md-10">
                                {% comment %} <label style="color: aliceblue;"><input type="checkbox" value="trackstate" name="trackstate" onclick="toggleForm()" style="display: none;">
                                Track Inventory for this item</label> {% endcomment %}
                                <!-- {% comment %} <input type="checkbox" name="trackState" id="trackStateCheckbox">{% endcomment %} -->
                                <label style="color: aliceblue;">
                                
                                    <input type="checkbox" name="trackstate" class=" " id="trackInv"  onclick="toggleFormFields()">
                                    Track Inventory for this item
                                </label>   <br>   <br>
                                <div id="formFields" style="display: none;"> 
                                    <div class="form-group row" >
                                    <label class="col-sm-2 col-form-label" style="color: aliceblue;">Inventory Account *</label>
                                    <div class="col-sm-10 col-md-7 col-9" style="margin-left: -1rem;">
                                        <select class="form-select form-select-sm mt-3 " id="invAcc" name="invacc" style="background-color: black; color: white;">
                                        <option value="">Choose..</option>
                                        <option value="inventory assets">Inventory Asset</option>
                                        </select>
                                    </div>
                                    </div>
                                    <br>
                                    <div class="form-group row ">
                                    <label class="col-sm-2 col-form-label" style="color: aliceblue;">Opening Stock</label>
                                    <div class=" col-md-5">
                                        <input  type="number" style="color: #ede4e4;" class="form-control " id="stockOnHand" name="openstock" value="0">
                                    </div>
                                    </div>
                                    <br>
                                    <div class="form-group row ">
                                        <label class="col-sm-2 col-form-label" style="color: aliceblue;">Opening Stock Rate per Unit</label>
                                        <div class=" col-md-5">
                                            <input type="number" id="stockRate" style="color: #ede4e4;" class="form-control" name="rate"  value="0">
                                        </div>
                                        </div>
                
                                    </div>
                                </div>
                            </div>
                        
                        </form>
                        <div class="row mt-5">
                            <div class="col-lg-12 col-md-12 col-sm-12">
                            <div class="d-flex justify-content-center">
                                <button class="btn save_btn rounded-pill text-grey w-25 my-1 mx-1 btn-outline-warning" type="button" id="saveNewItem">Save</button>
                                <button type="button" class="close btn save_btn rounded-pill text-grey w-25 my-1 mx-1 btn-outline-warning close_item_modal" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">Cancel</span></button>
                            </div>
                            </div>
                        </div>
                    </div>
                    </div>
                </div>
                </div>  
            </div>












            <!-- New Customer Modal -->
<div class="modal fade" id="newCustomer">
    <div class="modal-dialog modal-xl">
      <div class="modal-content" style="background: rgb(32, 35, 37);border-radius: 20px;">
        <div class="modal-header px-3" style="background: rgb(32, 35, 37);">
            <h3 class="text-uppercase" style="color: white;">Add Customer</h3>
            <button type="button" class="close btn btn-danger" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <div class="modal-body" style="background: rgb(32, 35, 37);">
          <div class="card px-2 py-4" style="background-color: #000;">
            <form id="newCustomerForm">
              {% csrf_token %}
              <div class="form-group row mt-3">
                <label class="col-sm-12 col-md-3 col-lg-3 col-form-label" style="color: white;">Customer Type</label>
                
                <div class=" col-sm-12 col-md-3 col-lg-3">
                    <input type="radio"  value="Business" name="type" >
                    <label for="Business"> Business</label>
                    &nbsp;&nbsp;&nbsp;
                    <input  type="radio"  value="Individual" name="type" >
                    <label for="Business">Individual</label>
                </div>
              </div>
  
              <div class=" form-group row">
                <div class="col-sm-12 col-md-3 col-lg-3 col-form-label">
                    <label class="labels">Primary Contact</label>
                </div>
                <div class="col-sm-12 col-md-1 col-lg-1" >
                    <select id="select1"  name="salutation" class="form-control bg-light text-dark mt-2 " >
                    
                        <option value="Mr">Mr</option>
                        <option value="Mrs">Mrs</option>
                        <option value="Ms">Ms</option>
                        <option value="Dr">Dr</option>
  
                    </select> 
                </div>
                <div class="col-sm-12 col-md-2 col-lg-3" >
                    <input  type="text" class="form-control bg-light text-dark mt-2 change-disply " id="fname" name="first_name" placeholder="first name" required >
  
                </div>
                <div class="col-sm-12 col-md-2 col-lg-3" >
                    <input type="text" class="form-control bg-light text-dark mt-2 " id="lname" name="last_name" placeholder="last name" required >
                </div>
              </div>
              <div class="form-group row mt-4">
                <div class="col-sm-12 col-md-3 col-lg-3 col-form-label"><label class="labels">Customer Display Name</label></div>
                <div class="col-sm-12 col-md-6 col-lg-7">
                    <select class="form-control bg-light text-dark "  name="v_display_name" id="v_display_name">
                    </select> 
                </div>
            </div>
            <div class="form-group row mt-4">
                <div class="col-sm-12 col-md-3 col-lg-3 col-form-label">
                    <label class="labels">Company Name</label>
                </div>
                <div class="col-sm-12 col-md-6 col-lg-7">
                    <input  type="text" class="form-control bg-light text-dark " id="companyName" name="company_name" required>     
                    <div class="invalid-feedback">Please fill out this field.</div>   
                </div>
            </div>
            <div class="form-group row mt-4">
                <div class="col-sm-12 col-md-3 col-lg-3 col-form-label"><label class="labels">Customer Email</label></div>
                <div class="col-sm-12 col-md-6 col-lg-7">
                    <input  type="email" class="form-control bg-light text-dark" name="vendor_email"  id="vendor-email"  required> 
                    <span class=" text-danger mt-1" id="email-message-id" style="font-size: 10px;"></span>   
                </div>
            </div>
  
            <div class="form-group row mt-4">
                <div class="col-sm-12 col-md-3 col-lg-3 ">
                    <label class="col-form-label text-white">Customer phone</label>
                </div>
                <div class="col-sm-12 col-md-3 col-lg-3">
                    <input id="workphone"  type="text" class="form-control bg-light text-dark mt-2" pattern="[0-9]{7}"  name="w_phone" placeholder="work phone" required>
                    <span id="work-phone-message" class="mt-2 " style="font-size: 10px;"></span >
                    <span id="workphone_label" class="mt-2 text-danger" style="font-size: 10px;"></span >
                    <div class="invalid-feedback"></div>   
                </div>
                <div class=" col-sm-12 col-md-3 col-lg-4">
                    <input id="mphone"  type="text" pattern="[0-9]{10}" class="form-control bg-light text-dark mt-2"  name="m_phone" placeholder="mobile number" required>
                    <span id="phone-message" class="mt-2 " style="font-size: 10px;"></span >
                    <span id="mphone_label" class="mt-2 text-danger" style="font-size: 10px;"></span >
                    <div class="invalid-feedback"></div>
                </div>
  
                <hr style="border: none; height: 2px; background-color: #ffcc00; margin: 20px 0;">
  
                <div class="toggle1 section-toggle">
                    <a href="">Add More Details</a>
                </div>
              </div>
  
              <fieldset1 id="more_detail" class="more details" style="display: none;">
                <div class="form-group row mt-4">
                  <div class="col-sm-12 col-md-3 col-lg-3 col-form-label">
                      <label>Skype name/Number</label>
                  </div>
                  <div class="col-sm-12 col-md-6 col-lg-6">
                      <input  type="text" class="form-control bg-light text-dark" id="skypeNumber" name="skype_number">      
                  </div>
                </div>
  
                <div class="form-group row mt-4">
                    <div class="col-sm-12 col-md-3 col-lg-3 col-form-label">
                        <label>Designation</label>
                    </div>
                    <div class="col-sm-12 col-md-6 col-lg-6">
                        <input  type="text" id="design" class="form-control bg-light text-dark" name="designation">      
                    </div>
                </div>
  
                <div class="form-group row mt-4">
                    <div class="col-sm-12 col-md-3 col-lg-3 col-form-label">
                        <label>Department</label>
                    </div>
                    <div class="col-sm-12 col-md-6 col-lg-6">
                        <input  type="text" class="form-control bg-light text-dark" id="dept" name="department">      
                    </div>
                </div>
       
                <div class="form-group row mt-4">
                    <div class="col-sm-12 col-md-3 col-lg-3 col-form-label"><label>Website</label></div>
                    <div class="col-sm-12 col-md-6 col-lg-6">
                        <input id="web" type="text" class="form-control bg-light text-dark" onclick="mobile_phone()"    name="website">      
                    </div>
                </div>
              </fieldset1>
  
              <hr style="border: none; height: 2px; background-color: #ffcc00; margin: 20px 0;">
  
              <div class="section-3">
  
                  <div class="toggle2 section-toggle"> <a href="" >Other Details </a> </div>
                  <div class="toggle3 section-toggle" > <a href="">Address </a> </div>
                  <div class="toggle4 section-toggle"><a href="" >Contact Persons </a></div>
                  <div class="toggle7 section-toggle"><a href="">Remarks</a></div>
  
              </div>
  
              <fieldset2 class="other details">
                <div class="form-group row mt-2">
                    <label class="col-sm-12 col-md-3 col-lg-3 col-form-label text-white" > GST Treatment*</label>
                    <div class=" col-sm-12 col-md-3 col-lg-3">
                        <select name="gst" id="GSTT" class="form-control bg-light text-dark" onclick="gstPan_function()">
                            <option value="" selected>Select a Gst Treatment</option>
                            <option value="Registered Business-Regular Business that is registered under GST">Registered Business-Regular Business that is registered under GST</option>
                            <option value="Registered Business-Composition Business that is registered under the Composition scheme in GST">
                                Registered Business-Composition Business that is registered under the Composition schemen in GST
                            </option>
                            <option value="Unregistered Business-not Registered under GST">Unregistered Business-not Registered under GST</option>
                            <option value="Overseas- Persons with who you do import or exports of supplies outside india">Overseas- Persons with who you do import or exports of supplies outside india</option>
                            <option value="Special Economic Zone">Special Economic Zone</option>
                        </select><br>
                    </div>
                </div>
  
                <fieldset3 id="gst" style="display: none;">
                    <div class="row mt-4">
                        <label class="col-sm-12 col-md-3 col-lg-3 col-form-label text-white"  > GSTIN/UIN*</label>
                        
                        <div class=" col-sm-12 col-md-3 col-lg-3">
                            <input type="text" class="form-control bg-light text-dark" name="gst_number" id="gstInput" > 
                            <span id="gstMessage"></span>       
                        </div>
                    </div>
  
                </fieldset3>
  
                <fieldset4 id="pan" style="display: none;">
                  <div class=" row mt-4">
                      <label class="col-sm-12 col-md-3 col-lg-3 col-form-label text-white" > PAN</label>
                      
                      <div class=" col-sm-12 col-md-3 col-lg-3">
                          <input type="text" class="form-control bg-light text-dark"  id="panInput"  name="pan_number">  
                          <span id="panMessage"></span>    
                      </div>
                  </div>
                </fieldset4>
  
  
                <div class="form-group row mt-4">
                  <label class="col-sm-12 col-md-3 col-lg-3 col-form-label text-white" > Source of Supply*</label>
                  <div class=" col-sm-12 col-md-3 col-lg-3">
                      <select name="source_supply" id="PLACE" class="form-control bg-light text-dark">
                          <option value="value" selected></option>
                          <option value="[AN]-Andaman And Nicobar Islands">[AN]-Andaman And Nicobar Islands</option>
                          <option value="[AD]-Andhra Pradesh">[AD]-Andhra Pradesh</option>
                          <option value="[AR]-Arunachal Pradesh">[AR]-Arunachal Pradesh	</option> 
                          <option value="volvo">[AS]-Assam</option>
                          <option value="[BR]-Bihar">[BR]-Bihar</option> 
                          <option value="volvo">[CH]-	Chandhigarh</option>
                          <option value="[CG]-Chattisgarh">[CG]-Chattisgarh</option>
                          <option value="[DD]-Daman Diu">[DD]-Daman Diu</option>
                          <option value="volvo">[DL]-	Delhi</option>
                          <option value="[GA]-Goa">[GA]-Goa</option> 
                          <option value="[GJ]-Gujarat">[GJ]-Gujarat</option>
                          <option value="[HR]-Haryana">[HR]-Haryana</option> 
                          <option value="[HP]-Himachal Pradesh">[HP]-Himachal Pradesh</option>
                          <option value="[JK]-Jammu And Kashmir">[JK]-Jammu And Kashmir</option>
                          <option value="[JH]-Jharkand">[JH]-Jharkand</option>
                          <option value="[KA]-Karnataka">[KA]-Karnataka</option>
                          <option value="[KL]-Kerala">[KL]-Kerala</option>
                          <option value="[LA]-Ladakh">[LA]-Ladakh</option>
                          <option value="[LD]-Lakshadweep">[LD]-Lakshadweep</option>
                          <option value="[MP]-Madhyapradesh">[MP]-Madhyapradesh</option>
                          <option value="[MH]-Maharashtra">[MH]-Maharashtra</option>
                          <option value="[MN]-Manipur">[MN]-Manipur</option>  
                          <option value="[ML]-Meghalaya">[ML]-Meghalaya</option>
                          <option value="[MZ]-Mizoram">[MZ]-Mizoram</option>
                          <option value="[NL]-Nagaland">[NL]-Nagaland</option> 
                          <option value="[NL]-Nagaland">[NL]-Nagaland</option>
                          <option value="[OD]-Odisha">[OD]-Odisha</option>
                          <option value="[PY]-Puducherry">[PY]-Puducherry</option>
                          <option value="[PB]-Punjab">[PB]-Punjab.</option>
                          <option value="[RL]-Rajasthan">[RL]-Rajasthan</option>
                          <option value="[SK]-Sikkim">[SK]-Sikkim</option>
                          <option value="[TN]-Tamilnadu">[TN]-Tamilnadu</option>
                          <option value="[TS]-Telenghana">[TS]-Telenghana</option>
                          <option value="[TR]-Tripura">[TR]-Tripura</option>
                          <option value="[UP]-Uttar Pradesh">[UP]-Uttar Pradesh</option>
                          <option value="[UK]-Utharakhand">[UK]-Utharakhand</option>
                          <option value="[WB]-West Bengal">[WB]-West Bengal</option>
                          <option value="[OT]-Other Territory">[OT]-Other Territory</option>
                      </select>
                  </div>
                </div>
  
                <div class="form-group row mt-4">
                  <label class="col-sm-12 col-md-3 col-lg-3 col-form-label" style="color:rgb(214, 75, 75) ;">Tax Preference*</label>
                    
                  <div class="col-sm-12 col-md-3 col-lg-4 d-flex align-items-center">
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="tax1" id="Taxable" value="Taxable" required>
                        <label class="form-check-label text-white" for="vehicle1">Taxable</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="tax1" id="Tax_Exempt" value="Tax Exempt" required>
                        <label class="form-check-label text-white" for="vehicle2">Tax Exempt</label>
                    </div>
                  </div>
                </div>
                
                <div class="form-group row mt-4">
                    <label class="col-sm-12 col-md-3 col-lg-3 col-form-label text-white" > Currency*</label>
                    
                    <div class=" col-sm-12 col-md-3 col-lg-3">
                        <select name="currency" id="crncy" class="form-control bg-light text-dark">
                            <option value="Indian Rupee" selected>Indian Rupee</option>
                        </select>
                    </div>
                </div>
  
                <div class="form-group row mt-2">
                  <div class="col-sm-12 col-md-3 col-lg-3 ">
                      <label class="col-form-label text-white mb-3"> Opening Balance Type</label>
                  </div>
                  <div class="col-sm-12 col-md-3 col-lg-4 d-flex align-items-center">
                      <div class="form-check form-check-inline">
                          <input class="form-check-input" type="radio" name="op_type" id="debit" value="debit">
                          <label class="form-check-label text-white" for="debit">Debit</label>
                      </div>
                      <div class="form-check form-check-inline">
                          <input class="form-check-input" type="radio" name="op_type" id="credit" value="credit">
                          <label class="form-check-label text-white" for="credit">Credit</label>
                      </div>
                  </div>
                </div>
  
                <div class="form-group row mt-4">
                    <label class="col-sm-12 col-md-3 col-lg-3 col-form-label text-white" > Opening Balance Amount</label>                    
                    <div class=" col-sm-12 col-md-3 col-lg-3">
                        <input  type="number" class="form-control bg-light text-dark" name="opening_bal" id="opa" value="0.00">      
                    </div>
                </div>
  
                <div class="form-group row mt-4">
                    <label class="col-sm-12 col-md-3 col-lg-3 col-form-label text-white" >Credit Limit</label>                    
                    <div class=" col-sm-12 col-md-3 col-lg-3">
                        <input  type="number" class="form-control bg-light text-dark" name="credit_lm" id="cl" value="0.00">      
                    </div>
                </div>
            
                <div id="custom-alert" class="customalert">
                    <span class="close-btn">&times;</span>
                    <div class="custom-alert-content">
                      Credit limit should not exceed opening balance amount.
                    </div>
                </div>
                  <style>
                    .customalert {
                            display: none;
                            position: fixed;
                            top: 30%;
                            left: 50%;
                            transform: translate(-50%, -50%);
                            background-color: #f44336;
                            color: white;
                            padding: 15px;
                            border-radius: 5px;
                            }
  
                            .close-btn {
                            float: right;
                            cursor: pointer;
                            }
  
                            .custom-alert-content {
                            margin-bottom: 10px;
                            }
                  </style>
                <div class="form-group row mt-4">
                  <label class="col-sm-12 col-md-3 col-lg-3 col-form-label text-white" > Payment Terms</label>
                  
                  <div class=" col-sm-12 col-md-3 col-lg-3">
                      <select name="payment_terms" id="paytearm-select" class="form-control bg-light text-dark">
                          {% for term in comp_payment_terms %}
                          <option value="{{pay_terms.id}}" >{{term.term_name}}</option>
                          {% endfor %}
                      </select>
                  </div>
                  <div class="col-md-4 ">
                      <a href="#" class="btn btn-outline-warning py-2 my-1" data-target="#newpaymentcustomer" data-toggle="modal">+</a>
                  </div>
                </div>
  
                <div class="form-group row mt-4">
                  <label class="col-sm-12 col-md-3 col-lg-3 col-form-label text-white">Price List </label>
                    
                  <div class=" col-sm-12 col-md-3 col-lg-3">
                      <select name="plst" id="priceLs" class="form-control bg-light text-dark">
                          <option value="0">Not selected</option>
                          {% for price_list in priceListItems %}
                          <option value="{{price_list.id}}">{{price_list.name}}</option>    
                          {% endfor %}
                      </select>
                  </div>
                </div>
             
                <div class="form-group row mt-4">
                    <label class="col-sm-12 col-md-3 col-lg-3 col-form-label" style="color:white ;">
                        Portal Language</label>
                        <div class=" col-sm-12 col-md-3 col-lg-3">
                            <select name="plang" id="plang" style="width: 100%;" class="form-control bg-light text-dark">
                                <option selected value="0" >Choose..</option>
                                <option value="ENGLISH">ENGLISH</option>
                              </select>
                    </div>
                </div>   
                <div class="form-group row mt-4">
                    <label class="col-sm-12 col-md-3 col-lg-3 col-form-label" style="color:white ;">Facebook </label>
                      <div class=" col-sm-12 col-md-3 col-lg-3"> 
                        <input type="text" id="fbk" name="fbk" class="form-control bg-light text-dark" >    
                    </div>
                </div>
                <div class="form-group row mt-4">
                    <label class="col-sm-12 col-md-3 col-lg-3 col-form-label" style="color:white ;">Twitter</label>
                        <div class=" col-sm-12 col-md-3 col-lg-3">
                            <input type="text" id="twtr" name="twtr" class="form-control bg-light text-dark" >
                          
                    </div>
                </div>
              </fieldset2>
  
              <fieldset5 id="address" style="display: none;">
                <div>
                    <div class="row">
                        <div class="col-sm-12 col-md-6 col-lg-6">
                            <div class="row">
                                <div class="col-sm-12 col-md-6 col-lg-6">
                                    <label for="">BILLING ADDRESS</label>
                                </div>
                                <div class="col"></div>
                            </div>
                            <div class="form-group row mt-4">
                                <label class="col-sm-12 col-md-3 col-lg-3 col-form-label text-white" > Attention</label>                    
                                <div class=" col-sm-12 col-md-6 col-lg-6">
                                    <input  type="text" class="form-control bg-light text-dark" name="battention" id="batten">      
                                </div>
                            </div>
                            <div class="form-group row mt-4">
                                <label class="col-sm-12 col-md-3 col-lg-3 col-form-label text-white" > Country</label>                    
                                <div class=" col-sm-12 col-md-6 col-lg-6">
                                    <select name="bcountry" id="btry" class="form-control bg-light text-dark">
                                        <option value="India" selected>India</option>
                                    </select>      
                                </div>
                            </div>
                            <div class="form-group row mt-4">
                                <label class="col-sm-12 col-md-3 col-lg-3 col-form-label text-white" > Address</label>                    
                                <div class=" col-sm-12 col-md-6 col-lg-6">
                                    <textarea class="form-control bg-light " style="border: none;color: rgb(7, 7, 7);" cols="26" rows="4" name="baddress" id="badd1"></textarea>
                                </div>
                            </div>
                            <div class="form-group row mt-4">
                                <label class="col-sm-12 col-md-3 col-lg-3 col-form-label text-white" > City</label>                    
                                <div class=" col-sm-12 col-md-6 col-lg-6">
                                    <input  type="text" class="form-control bg-light text-dark" name="bcity" id="bcty">      
                                </div>
                            </div>
                            <div class="form-group row mt-4">
                                <label class="col-sm-12 col-md-3 col-lg-3 col-form-label text-white" > State</label>                    
                                <div class=" col-sm-12 col-md-6 col-lg-6">
                                    <input type="text" class="form-control bg-light text-dark" name="bstate" id="bste">      
                                </div>
                            </div>
                            <div class="form-group row mt-4">
                                <label class="col-sm-12 col-md-3 col-lg-3 col-form-label text-white" > Zip Code </label>                    
                                <div class=" col-sm-12 col-md-6 col-lg-6">
                                    <input  type="number" class="form-control bg-light text-dark" name="bzip" id="bzp">      
                                </div>
                            </div>
                        
                            <div class="form-group row mt-4">
                                <label class="col-sm-12 col-md-3 col-lg-3 col-form-label text-white" > Phone </label>                    
                                <div class=" col-sm-12 col-md-6 col-lg-6">
                                    <input id="bphone_num"  type="tel" pattern="[0-9]{10}" class="form-control bg-light text-dark" name="bphone" >
                                    <label for="" id="bphone_label"></label>      
                                </div>
                            </div>
                            <div class="form-group row mt-4">
                                <label class="col-sm-12 col-md-3 col-lg-3 col-form-label text-white" > Fax </label>                    
                                <div class=" col-sm-12 col-md-6 col-lg-6">
                                    <input  type="tel" class="form-control bg-light text-dark" pattern="[0-9]{7}" onmouseout="fax_number()"  onclick="bphone_number()" name="bfax" id="bfx">  
                                
                                    <label for="" id="fax_label"></label> 
                                </div>
                            </div>
  
                        </div>
                        <div class="col-sm-12 col-md-6 col-lg-6">
                            <div class="row">
                                <div class="col-sm-12 col-md-6 col-lg-6">
                                    <label for="">SHIPPING ADDRESS</label>
                                </div>
                                <div class="col-sm-12 col-md-6 col-lg-6">
                                    <input  type="checkbox" id="myCheckT" onclick="myCopyAddressFunction()">&nbsp;
                                    <label for="myCheck">Same as Billing Address:</label>
                                </div>
                            </div>
                            <div class="form-group row mt-4">
                                <label class="col-sm-12 col-md-3 col-lg-3 col-form-label text-white" > Attention</label>                    
                                <div class=" col-sm-12 col-md-6 col-lg-6">
                                    <input  type="text" class="form-control bg-light text-dark " style="color: white;" name="sattention" id="satten">      
                                </div>
                            </div>
                            <div class="form-group row mt-4">
                                <label class="col-sm-12 col-md-3 col-lg-3 col-form-label text-white" > Country</label>                    
                                <div class=" col-sm-12 col-md-6 col-lg-6">
                                    <select name="s_country" id="sctry" class="form-control bg-light text-dark">
                                        <option value="India" selected>India</option>
                                    </select>      
                                </div>
                            </div>
                            <div class="form-group row mt-4">
                                <label class="col-sm-12 col-md-3 col-lg-3 col-form-label text-white" > Address</label>                    
                                <div class=" col-sm-12 col-md-6 col-lg-6">
                                    <textarea class="form-control bg-light" style="border: none;color: rgb(10, 10, 10);" id="sadd1" cols="26" rows="4" name="saddress"></textarea>
                                </div>
                            </div>
                            <div class="form-group row mt-4">
                                <label class="col-sm-12 col-md-3 col-lg-3 col-form-label text-white" > City</label>                    
                                <div class=" col-sm-12 col-md-6 col-lg-6">
                                    <input  type="text" class="form-control bg-light text-dark" name="scity" id="scty">      
                                </div>
                            </div>
                            <div class="form-group row mt-4">
                                <label class="col-sm-12 col-md-3 col-lg-3 col-form-label text-white" > State</label>                    
                                <div class=" col-sm-12 col-md-6 col-lg-6">
                                    <input type="text" class="form-control bg-light text-dark" name="sstate" id="sste">      
                                </div>
                            </div>
                            <div class="form-group row mt-4">
                                <label class="col-sm-12 col-md-3 col-lg-3 col-form-label text-white" > Zip Code </label>                    
                                <div class=" col-sm-12 col-md-6 col-lg-6">
                                    <input  type="number" class="form-control bg-light text-dark" name="szip" id="szp">      
                                </div>
                            </div>
                        
  
                            <div class="form-group row mt-4">
                                <label class="col-sm-12 col-md-3 col-lg-3 col-form-label text-white" > Phone </label>                    
                                <div class=" col-sm-12 col-md-6 col-lg-6">
                                    <input  type="tel" class="form-control bg-light text-dark" pattern="[0-9]{10}" style="color: white;" name="sphone" id="sphone_num">  
                                    <label for="" id="sphone_label"></label>    
                                </div>
                            </div>
                            <div class="form-group row mt-4">
                                <label class="col-sm-12 col-md-3 col-lg-3 col-form-label text-white" > Fax </label>                    
                                <div class=" col-sm-12 col-md-6 col-lg-6">
                                    <input  type="tel" class="form-control bg-light text-dark" pattern="[0-9]{7}" style="color: white;" name="sfax" onclick="sphone_number()" onmouseout="sfax_number()" id="sfx"> 
                                    <label for="" id="sfax_label"></label>     
                                </div>
                            </div>
  
                        </div>
                    </div>
                </div>
              </fieldset5>
  
              <fieldset6 id="contact_person" style="display: none;" >
                <div class="row">
                    <div class="col-sm-12 ">
                        
                        <div class="table-responsive">
                        
                            <table id="tbl" class="table text-white" style="background-color: rgba(250, 227, 198, 0.5);">
                                <thead>
                                    <tr>
                                        
                                    <th>Salutation</th>
                                    <th>First Name</th>
                                    <th>Last Name</th>
                                    <th>Email Address</th>
                                    <th >Work Phone <br><span id="twph_label"></span></th>
                                    <th >Mobile <br><span id="tlabel"></span>    </th>
                                    <th >Skype Name/No</th>
                                    <th >Designation</th>
                                    <th >Department</th>
                                    <th>Action</th>
  
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                <td><select name="salutation[]" class="salutation form-control bg-transparent border-1 text-white" >
                                  <option value="" class="text-dark">Select</option>
                                    <option class="text-dark" value="Mr">Mr.</option>
                                    <option class="text-dark" value="Mrs">Mrs.</option>
                                    <option class="text-dark" value="Ms">Ms.</option>
                                    <option class="text-dark" value="Miss">Miss.</option>
                                    <option class="text-dark" value="Dr">Dr.</option>
                                    </select></td>
                                <td><input type="text" class="first_name form-control border-1 bg-transparent text-white"    name="first_name[]"  ></td>
                                <td><input type="text"class="last_name form-control border-1 bg-transparent text-white"  name="last_name[]" /></td>
                                <td>
                                    <input type="text" class="email form-control border-1 bg-transparent text-white" name="email[]" />
                                    
                                    
                                </td>
                                
                                <td>
                                    <input type="tel" pattern="[0-9]{7}" class="work_phone form-control border-1 bg-transparent text-white"  id="twphone" name="wphone[]"/>
                                   
                                </td>
                                <td>
                                    <input type="tel" pattern="[0-9]{10}"  class="mobile_phone form-control border-1 bg-transparent text-white"  id="tmobile" onclick="sample1()"   name="mobile[]" />
                                    
                                </td>
                                <td><input type="number" class="skype_number form-control border-1 bg-transparent text-white"  onclick="sample()" name="skype[]" /></td>
                                <td><input type="text" class="designation form-control border-1 bg-transparent text-white"  name="designation[]" /></td>
                                <td><input type="text" class="department form-control border-1 bg-transparent text-white"  name="department[]" /></td>
                                <td><button type="button" class="btn btn-danger" onclick="deleteContact(this)">Delete</button></td>
                                </tr>
                            </tbody>
                            </table>
                            
                        </div>
                        
                        <div class="button add_another mt-3 ">
                            <i class="fa fa-user-plus" aria-hidden="true"></i> 
                            <span class="text-small" style="margin-left: 0.30rem;">
                                Add Contact Person
                            </span>
                        </div>
                           
                        
                    </div>
                    
                </div>
  
              </fieldset6>
  
  
  
              <fieldset7 class="remarks" style="display: none;">
                  <div class="row">
                      <div class="col-sm-12 col-md-8 col-lg-8">
                          <div class="form-group row mt-4">
                              <div class=" col-sm-12 col-md-6 col-lg-6">
                                  <textarea class="bg-light w-100" style="border: none;color: rgb(5, 5, 5);" id="rmrk"  rows="5" name="remark"></textarea>
                              </div>
                          </div>
                      </div>
                      <div class="col-sm-12 col-md-2 col-lg-2"></div>
                  </div>
  
              </fieldset7>
            
            
          </form>
          <div class="row mt-5">
            <div class="col-lg-12 col-md-12 col-sm-12">
              <div class="d-flex justify-content-center">
                <button class="btn save_btn rounded-pill text-grey w-25 my-1 mx-1 btn-outline-warning" type="button" id="newCustomerSave">Save</button>
                <button type="button" class="close btn save_btn rounded-pill text-grey w-25 my-1 mx-1 btn-outline-warning close_customer_modal" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">Cancel</span></button>
              </div>
            </div>
          </div>
          </div>
        </div>
      </div>
    </div>  
  </div>

 

    <!--------------- Payments Term Customer ----------------->

    <div class="modal fade" id="newpaymentcustomer">
        <div class="modal-dialog modal-md">
        <div class="modal-content" style="background: rgb(32, 35, 37);border-radius: 20px;">
            <div class="modal-header " style="background: rgb(32, 35, 37);">
                <h3 class="m-3 text-uppercase" style="color: white;">Add Payment Term</h3>
                <button type="button" class="close btn btn-danger" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body" style="background: rgb(32, 35, 37);">
            <div class="card p-3 m-3" style="background-color: black;">
                <form class="needs-validation" novalidate autocomplete="off" id="modalPayment_terms">
                
    
    
                <div class="row mt-2">
    
                    <div class="col-lg-12 col-md-12 col-sm-12 mt-2">
                        <label for="termname" style="color: white">Term Name *</label>

                    <input type="text " class="form-control mt-2" id="tname" name="term_name" autocapitalize="characters" required> 
                    <span id="message-id" class="mt-1 text-danger" style="font-size: 10px;"></span> 
                    <span id="success-message-id" class=" mt-1 text-success" style="font-size: 10px;"></span>    
                    </div>
    
                    <div class="col-lg-12 col-md-12 col-sm-12 mt-2">
                        <label for="termdays" style="color: white">Number of Days *</label>

                    <input type="number" class="form-control mt-2" id="tdays" name="term_days" autocapitalize="characters" required>
                    </div>
                    <div class="col-md-2 mt-2"></div>
    
                </div>
                
                <div class="row mt-5">
                    <div class="col-lg-12 col-md-12 col-sm-12">
                    <div class="d-flex">
                        <button class="btn save_btn rounded-pill text-grey w-50 my-1 mx-1 btn-outline-warning "
                        type="submit" data-dismiss="modal" id="termSave">Save
                        </button> 
                        
    
                        <button type="button" class="close btn save_btn rounded-pill text-grey w-50 my-1 mx-1 btn-outline-warning" 
                        data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">Cancel</span>
                        </button>
                    </div>
                    </div>
                </div>
                </form>
            </div>
            </div>
        </div>
        </div>  
    </div> 

    <!------------------- Payments  Section End -------------->






    <!-- New Unit Modal-->     

<div class="modal fade" id="unitmodal">
    <div class="modal-dialog">
        <div class="modal-content" style="background: rgb(32, 35, 37);border-radius: 20px;">
        <div class="modal-header" style="background: rgb(32, 35, 37);">
            <h5 class="m-3 text-uppercase" id="shareBillEmailLabel" style="color: #eeeaea;">Add Unit</h5>
            <button type="button" class="close btn btn-danger" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <div class="modal-body" style="background: rgb(32, 35, 37);">
            <div class="card p-3 m-3" style="background-color: #000;">
            
                <div id="error-message-container" style="color: chocolate;"></div>
                    <form class="needs-validation" novalidate autocomplete="off" id="unitform">
                        {% csrf_token %}
                        <label class="text-dark" for="unit"><b>Unit Name</b></label>
                        <input type="text" class="form-control text-white"  placeholder="Enter unit" id="unitName" name="unit_name" required>
                        <p class="text-white">eg:KL,PCS,BOX,LTR</p>

                        <div class="row mt-5">
                            <div class="col-lg-12 col-md-12 col-sm-12">
                            <div class="d-flex justify-content-center">
                                <button class="btn save_btn rounded-pill text-grey w-25 my-1 mx-1 btn-outline-warning" type="button" id="newUnitSave">Save</button>
                                <button type="button" class="close btn save_btn rounded-pill text-grey w-25 my-1 mx-1 btn-outline-warning close_unit_modal" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">Cancel</span></button>
                            </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>


<!-- New Account Modal -->

<div class="modal fade" id="newAccount">
    <div class="modal-dialog modal-xl">
      <div class="modal-content" style="background: rgb(32, 35, 37);border-radius: 20px;">
        <div class="modal-header" style="background: rgb(32, 35, 37);">
          <h5 class="m-3 text-uppercase" id="shareBillEmailLabel" style="color: #eeeaea;"><b>New Account</b></h5>
          <button type="button" class="close" style="width: 30px;" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        </div>
        <div class="modal-body" style="background: rgb(32, 35, 37);">
          <div class="card p-3 m-3" style="background-color: #000;">
          
           
              <form method="post"  style="color: #000000;" id="newAccountForm">
                {% csrf_token %}
                {% for m in messages %}
                <p style="color: chocolate;">{{m}}</p>
                {% endfor %}
                  <div class="d-flex align-items-center">
                      <h5 style="font-size: 25px;color: aliceblue;">Create Account</h5>
                    
                  </div>
                  <div id="error-message-container2" style="color: chocolate;"></div>
                  <hr>
                  <div class="row ">
                      <div class="col">
                          <div class="row">
                              <div class="col-sm-4">
                                  <label for="">Account Type:</label>
                              </div>
                              <div class="col-sm-8">
                                  <div class="select-box1" onclick="message()">
                                      <div class="select-option1">
                                          <input type="text" placeholder="select" style="width: 100%;"  id="soValue1" name="account_type"readonly>
                                      </div>
                                      <div class="content1" id="myDropdown1">
                                          <div class="search1">
                                              <input type="text" placeholder="search" id="myInput1" onkeyup="filterFunction1()">
                                          </div>
                                          <ul class="options1" style="color: #000000;">
                                              <div class="opt" style="color: #000000;">
                                                  <span style="font-weight: bold;color: #000;">Assets</span>
                                                  <li style="color: #000000;">Other Assets</li>
                                                  <li>Other Current Assets</li>
                                                  <li>Cash</li>
                                                  <li>Bank</li>
                                                  <li>Fixed Asset</li>
                                                  <li>Stock</li>
                                                  <li>Payment Clearing</li>
                                              </div>
          
                                              <div class="opt">
                                                  <span style="font-weight: bold;color: #000;">Liability</span>
                                                  <li>Other Liability</li>
                                                  <li>Other Current Liability</li>
                                                  <li>Credit Card</li>
                                                  <li>Long Term Liability</li>
                                                  <li>Overseas Tax Payable</li>
                                              </div>
          
                                              <div class="opt">
                                                  <span style="font-weight: bold;color: #000;">Equity</span>
                                                  <li>Equity</li>
                                              </div>
          
                                              <div class="opt">
                                                  <span style="font-weight: bold;color: #000;">Income</span>
                                                  <li>Income</li>
                                                  <li>Other Income</li>
                                              </div>
          
                                              <div class="opt">
                                                  <span style="font-weight: bold;color: #000;">Expense</span>
                                                  <li>Expense</li>
                                                  <li>Cost Of Goods Sold</li>
                                                  <li>Other Expense</li>
                                              </div>
                                          </ul>
          
          
          
                                      </div>
                                  </div>
          
                              </div>
          
                              <script>
                                  const selectBox1 = document.querySelector('.select-box1');
                                  const selectOption1 = document.querySelector('.select-option1');
                                  const optionsList1 = document.querySelectorAll('.options1 li');
                                  const soValue1 = document.querySelector('#soValue1');
          
                                  selectOption1.addEventListener('click', function () {
                                      selectBox1.classList.toggle('active')
                                  })
          
                                  optionsList1.forEach(function (optionsListSingle) {
                                      optionsListSingle.addEventListener('click', function () {
                                          text = this.textContent;
                                          soValue1.value = text;
                                          selectBox1.classList.remove('active')
          
                                      })
                                  })
                              </script>
                          </div>
                          <div id="name" style="display: block;">
                              <div class="row mt-3">
                                  <div class="col-sm-4">
                                      <label for="">Account Name:</label>
                                  </div>
                                  <div class="col-sm-8">
                                      <input type="text" class="form-control text-dark bg-light" name="account_name"
                                          id="account_name" style="width: 100%;" required>
                                  </div>
                              </div>
                          </div>
          
                          <div id="credit" style="display: none;">
                              <div class="row mt-3">
                                  <div class="col-sm-4">
                                      <label for="">Credit Card Name:</label>
                                  </div>
                                  <div class="col-sm-8">
                                      <input type="text" class="form-control text-dark bg-light" style="width: 70%;" name="credit_number"
                                          id="credit_number">
                                  </div>
                              </div>
                          </div>
          
                          <div id="sub_div" style="display: none;">

                            <div class="row mt-3">
                                <div class="col-sm-4">
                                    <label for=""></label>
                                </div>
                        
                                <div class="col-sm-8">
                        
                                    <input type="checkbox" class=" text-dark bg-light" onclick="show_parent()"
                                        name="sub_account" id="sub_account">
                        
                                    <label for="">Make this a sub-account</label>
                        
                                </div>
                            </div>
                        </div>

                        <div id="sub_div22" style="display: none;">

                            <div class="row mt-3">
                                <div class="col-sm-4">
                                    <label for=""></label>
                                </div>
                        
                                <div class="col-sm-8">
                        
                                    <input type="checkbox" class=" text-dark bg-light" onclick="show_parent22()"
                                        name="sub_account22" id="sub_account22">
                        
                                    <label for="">Make this a sub-account</label>
                        
                                </div>
                            </div>
                        </div>
                        
                        <div id="sub_div33" style="display: none;">
                        
                            <div class="row mt-3">
                                <div class="col-sm-4">
                                    <label for=""></label>
                                </div>
                        
                                <div class="col-sm-8">
                        
                                    <input type="checkbox" class=" text-dark bg-light" onclick="show_parent33()"
                                        name="sub_account33" id="sub_account33">
                        
                                    <label for="">Make this a sub-account</label>
                        
                                </div>
                            </div>
                        </div>
                        
                        <div id="sub_div44" style="display: none;">
                        
                            <div class="row mt-3">
                                <div class="col-sm-4">
                                    <label for=""></label>
                                </div>
                        
                                <div class="col-sm-8">
                        
                                    <input type="checkbox" class=" text-dark bg-light" onclick="show_parent44()"
                                        name="sub_account44" id="sub_account44">
                        
                                    <label for="">Make this a sub-account</label>
                        
                                </div>
                            </div>
                        </div>
                        
                        <div id="sub_div55" style="display: none;">
                        
                            <div class="row mt-3">
                                <div class="col-sm-4">
                                    <label for=""></label>
                                </div>
                        
                                <div class="col-sm-8">
                        
                                    <input type="checkbox" class=" text-dark bg-light" onclick="show_parent55()"
                                        name="sub_account55" id="sub_account55">
                        
                                    <label for="">Make this a sub-account</label>
                        
                                </div>
                            </div>
                        </div>
                        
                        
                        <div id="sub_div66" style="display: none;">
                            <div class="row mt-3">
                                <div class="col-sm-4">
                                    <label for=""></label>
                                </div>
                                <div class="col-sm-8">
                                    <input type="checkbox" class=" text-dark bg-light" onclick="show_parent66()"
                                        name="sub_account66" id="sub_account66">
                                    <label for="">Make this a sub-account</label>
                                </div>
                            </div>
                        </div>
                        
                        
                        
                        <div id="sub_div77" style="display: none;">
                            <div class="row mt-3">
                                <div class="col-sm-4">
                                    <label for=""></label>
                                </div>
                                <div class="col-sm-8">
                                    <input type="checkbox" class=" text-dark bg-light" onclick="show_parent77()"
                                        name="sub_account77" id="sub_account77">
                                    <label for="">Make this a sub-account</label>
                                </div>
                            </div>
                        </div>
                        
                        
                        
                        <div id="sub_div88" style="display: none;">
                            <div class="row mt-3">
                                <div class="col-sm-4">
                                    <label for=""></label>
                                </div>
                                <div class="col-sm-8">
                                    <input type="checkbox" class=" text-dark bg-light" onclick="show_parent88()"
                                        name="sub_account88" id="sub_account88">
                                    <label for="">Make this a sub-account</label>
                                </div>
                            </div>
                        </div>
                        
                        <div id="sub_div99" style="display: none;">
                            <div class="row mt-3">
                                <div class="col-sm-4">
                                    <label for=""></label>
                                </div>
                                <div class="col-sm-8">
                                    <input type="checkbox" class=" text-dark bg-light" onclick="show_parent99()"
                                        name="sub_account99" id="sub_account99">
                                    <label for="">Make this a sub-account</label>
                                </div>
                            </div>
                        </div>
                        
                        <div id="sub_div100" style="display: none;">
                            <div class="row mt-3">
                                <div class="col-sm-4">
                                    <label for=""></label>
                                </div>
                                <div class="col-sm-8">
                                    <input type="checkbox" class=" text-dark bg-light" onclick="show_parent100()"
                                        name="sub_account100" id="sub_account100">
                                    <label for="">Make this a sub-account</label>
                                </div>
                            </div>
                        </div>
                        
                        <div id="sub_div111" style="display: none;">
                            <div class="row mt-3">
                                <div class="col-sm-4">
                                    <label for=""></label>
                                </div>
                                <div class="col-sm-8">
                                    <input type="checkbox" class=" text-dark bg-light" onclick="show_parent111()"
                                        name="sub_account111" id="sub_account111">
                                    <label for="">Make this a sub-account</label>
                                </div>
                            </div>
                        </div>
                        
                        <div id="sub_div222" style="display: none;">
                            <div class="row mt-3">
                                <div class="col-sm-4">
                                    <label for=""></label>
                                </div>
                                <div class="col-sm-8">
                                    <input type="checkbox" class=" text-dark bg-light" onclick="show_parent222()"
                                        name="sub_account222" id="sub_account222">
                                    <label for="">Make this a sub-account</label>
                                </div>
                            </div>
                        </div>


                        <div id="parent_div" style="display: none;">
                            <div class="row mt-3">
                                <div class="col-sm-4">
                                    <label for="">Parent Account:</label>
                                </div>
                                <div class="col-sm-8">
                        
                                    <select class="form-control text-dark bg-light" style="width: 70%;" name="parent_account" id="parent_account">
                                        <option value="" class="bg-dark text-light text-center"  disabled>Other Current
                                            Assets
                                        </option>
                                        <option value="" selected></option>
                                        <option value="Advance Tax">Advance Tax</option>
                                        <option value="Employee Advance">Employee Advance</option>
                                        <option value="Prepaid Expenses">Prepaid Expenses</option>
                                        <option value="GST TCS Receivable">GST TCS Receivable</option>
                                        <option value="GST TDS Receivable">GST TCS Receivable</option>
                                        <option value="Input Tax Credits">Input Tax Credits</option>
                                        <option value="Input CGST">&nbsp; &nbsp;&nbsp;Input CGST</option>
                                        <option value="Input IGST"> &nbsp; &nbsp;&nbsp;Input IGST</option>
                                        <option value="Input SGST">&nbsp; &nbsp;&nbsp;Input SGST</option>
                        
                        
                                        <option value="Reverse Charge Tax Input but no due">Reverse Charge Tax Input but no
                                            due
                                        </option>
                                        <option value="Sales to Customers(Cash)">Sales to Customers(Cash)</option>
                        
                        
                                        <option value="TDS Receivable">TDS Receivable</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        
                        <div id="parent_div22" style="display: none;">
                            <div class="row mt-3">
                                <div class="col-sm-4">
                                    <label for="">Parent Account:</label>
                                </div>
                                <div class="col-sm-8">
                        
                                    <select class="form-control text-dark bg-light" style="width: 70%;" name="parent_account22"
                                        id="parent_account22">
                                        <option value="" class="bg-dark text-light text-center" disabled>Cash</option>
                                        <option value="" class="bg-dark text-light text-center" selected></option>
                        
                                        <option value="Petty Cash">Petty Cash</option>
                                        <option value="Undeposited Fund">Undeposited Fund</option>
                                        <option value="Cash Account">Cash Account</option>
                        
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div id="parent_div33" style="display:none;">
                            <div class="row mt-3">
                                <div class="col-sm-4">
                                    <label for="">Parent Account:</label>
                                </div>
                                <div class="col-sm-8">
                        
                                    <select class="form-control text-dark bg-light" style="width: 70%;" name="parent_account33"
                                        id="parent_account33">
                                        <option value="" class="bg-dark text-light text-center" disabled>Fixed Asset
                                        </option>
                                        <option value="" class="bg-dark text-light text-center" selected></option>
                        
                                        <option value="Furniture and Equipment">Furniture and Equipment</option>
                        
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        
                        
                        <div id="parent_div44" style="display:none;">
                            <div class="row mt-3">
                                <div class="col-sm-4">
                                    <label for="">Parent Account:</label>
                                </div>
                                <div class="col-sm-8">
                        
                                    <select class="form-control text-dark bg-light" style="width: 70%;" name="parent_account44"
                                        id="parent_account44">
                                        <option value="" class="bg-dark text-light text-center" disabled>Stock</option>
                                        <option value="" class="bg-dark text-light text-center" selected></option>
                        
                                        <option value="Inventory Asset">Inventory Asset</option>
                        
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        
                        <div id="parent_div55" style="display: none;">
                            <div class="row mt-3">
                                <div class="col-sm-4">
                                    <label for="">Parent Account:</label>
                                </div>
                                <div class="col-sm-8">
                        
                                    <select class="form-control text-dark bg-light" style="width: 70%;" name="parent_account55"
                                        id="parent_account55">
                                        <option value="" class="bg-dark text-light text-center" disabled>Other Current
                                            Liability
                                        </option>
                                        <option value="" class="bg-dark text-light text-center" selected></option>
                        
                                        <option value="Employee Reimbursements">Employee Reimbursements</option>
                                        <option value="Opening Balance Adjustments">Opening Balance Adjustments</option>
                                        <option value="Tax Payable">Tax Payable</option>
                                        <option value="Unearned Revenue">Unearned Revenue</option>
                                        <option value="GST Payable">GST Payable</option>
                                        <option value="Output CGST">&nbsp;&nbsp;&nbsp;Output CGST</option>
                                        <option value="Output IGST">&nbsp;&nbsp;&nbsp;Output IGST</option>
                                        <option value="Output SGST">&nbsp;&nbsp;&nbsp;Output SGST</option>
                                        <option value="TDS Payable">TDS Payable</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        
                        <div id="parent_div66" style="display: none;">
                            <div class="row mt-3">
                                <div class="col-sm-4">
                                    <label for="">Parent Account:</label>
                                </div>
                                <div class="col-sm-8">
                                    <select class="form-control text-dark bg-light" style="width: 70%;" name="parent_account66"
                                        id="parent_account66">
                                        <option value="" class="bg-dark text-light text-center" disabled>Long Term Liability
                                        </option>
                                        <option value="" selected></option>
                                        <option value="Construction Loans">Construction Loans</option>
                                        <option value="Mortgages">Mortgages</option>
                        
                        
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        
                        <div id="parent_div77" style="display: none;">
                            <div class="row mt-3">
                                <div class="col-sm-4">
                                    <label for="">Parent Account:</label>
                                </div>
                                <div class="col-sm-8">
                                    <select class="form-control text-dark bg-light" style="width: 70%;" name="parent_account77"
                                        id="parent_account77">
                                        <option value="" class="bg-dark text-light text-center" disabled>Other Liability
                                        </option>
                                        <option value="" selected></option>
                                        <option value="Tag Adjustments">Tag Adjustments</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        
                        <div id="parent_div88" style="display: none;">
                            <div class="row mt-3">
                                <div class="col-sm-4">
                                    <label for="">Parent Account:</label>
                                </div>
                                <div class="col-sm-8">
                        
                                    <select class="form-control text-dark bg-light" style="width: 70%;" name="parent_account88"
                                        id="parent_account88">
                                        <option value="" class="bg-dark text-light text-center" disabled>Equity</option>
                                        <option value="" selected></option>
                                        <option value="Drawings">Drawings</option>
                                        <option value="Opening Balance Offset">Opening Balance Offset</option>
                                        <option value="Owner's Equity">Owner's Equity</option>
                                        <option value="Retained Earnings">Retained Earnings</option>
                                        <option value="Capital Stock">Capital Stock</option>
                                        <option value="Distributions">Distributions</option>
                                        <option value="Dividends Paid">Dividends Paid</option>
                                        <option value="Investments">Investments</option>
                        
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        
                        <div id="parent_div99" style="display: none;">
                            <div class="row mt-3">
                                <div class="col-sm-4">
                                    <label for="">Parent Account:</label>
                                </div>
                                <div class="col-sm-8">
                                    <select class="form-control text-dark bg-light" style="width: 70%;" name="parent_account99"
                                        id="parent_account99">
                                        <option value="" class="bg-dark text-light text-center" disabled>Income</option>
                                        <option value="" selected></option>
                                        <option value="Discount">Discount</option>
                                        <option value="General Income">General Income</option>
                                        <option value="Interest Income">Interest Income</option>
                                        <option value="Late Fee Income">Late Fee Income</option>
                                        <option value="Other Charges">Other Charges</option>
                                        <option value="sales">sales</option>
                                        <option value="Shipping Charge">Shipping Charge</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        
                        
                        <div id="parent_div100" style="display: none;">
                            <div class="row mt-3">
                                <div class="col-sm-4">
                                    <label for="">Parent Account:</label>
                                </div>
                                <div class="col-sm-8">
                                    <select class="form-control text-dark bg-light" style="width: 70%;" name="parent_account100"
                                        id="parent_account100">
                                        <option value="" class="bg-dark text-light text-center" disabled>Expense</option>
                                        <option value="" selected></option>
                                        <option value="Discount">Discount</option>
                                        <option value="Advertising and Marketing">Advertising and Marketing</option>
                                        <option value="Automobile Expense">Automobile Expense</option>
                                        <option value="Bad Debt">Bad Debt</option>
                                        <option value="Bank Fees and Charges">Bank Fees and Charges</option>
                                        <option value="Consultant Expense">Consultant Expense</option>
                                        <option value="Credit Card Charges">Credit Card Charges</option>
                                        <option value="Depreciation Expense">Depreciation Expense</option>
                                        <option value="IT and Internet Expenses">IT and Internet Expenses</option>
                                        <option value="Ganitorial Expense">Ganitorial Expense</option>
                                        <option value="Lodging">Lodging</option>
                                        <option value="Meals and Entertainment">Meals and Entertainment</option>
                                        <option value="Office Supplies">Office Supplies</option>
                                        <option value="Other Expenses">Other Expenses</option>
                                        <option value="Postage">Postage</option>
                                        <option value="Printing and Stationery">Printing and Stationery</option>
                                        <option value="Rent Expense">Rent Expense</option>
                                        <option value="Repairs and Maintenance">Repairs and Maintenance</option>
                                        <option value="Salaries and Employee Wages">Salaries and Employee Wages</option>
                                        <option value="Telephone Expense">Telephone Expense</option>
                                        <option value="Travel Expense">Travel Expense</option>
                                        <option value="Uncategorized">Uncategorized</option>
                                        <option value="Contract Assets">Contract Assets</option>
                                        <option value="Depreciation And Amortisation">Depreciation And Amortisation</option>
                                        <option value="Merchandise">Merchandise</option>
                                        <option value="Raw Materials And Consumables">Raw Materials And Consumables</option>
                                        <option value="Transportation Expense">Uncategorized</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        
                        
                        <div id="parent_div111" style="display: none;">
                            <div class="row mt-3">
                                <div class="col-sm-4">
                                    <label for="">Parent Account:</label>
                                </div>
                                <div class="col-sm-8">
                        
                                    <select class="form-control text-dark bg-light" style="width: 70%;" name="parent_account111"
                                        id="parent_account111">
                                        <option value="" class="bg-dark text-light text-center" disabled>Cost Of Goods Sold
                                        </option>
                                        <option value="" selected></option>
                                        <option value="Cost Of Goods Sold">Cost Of Goods Sold</option>
                                        <option value="Job Costing">Job Costing</option>
                                        <option value="Labor">Labor</option>
                                        <option value="Materials">Materials</option>
                                        <option value="Subcontractor">Subcontractor</option>
                        
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        
                        <div id="parent_div222" style="display: none;">
                            <div class="row mt-3">
                                <div class="col-sm-4">
                                    <label for="">Parent Account:</label>
                                </div>
                                <div class="col-sm-8">
                        
                                    <select class="form-control text-dark bg-light" style="width: 70%;" name="parent_account222"
                                        id="parent_account222">
                                        <option value="" class="bg-dark text-light text-center" disabled>Other Expense
                                        </option>
                                        <option value="" selected></option>
                                        <option value="Cost Of Goods Sold">Exchange Gain or Loss</option>
                        
                                    </select>
                                </div>
                            </div>
                        </div>
          
          
          
                          <div class="row mt-3">
                              <div class="col-sm-4">
                                  <label for="">Account Code:</label>
                              </div>
                              <div class="col-sm-8">
                                  <input type="text" class="form-control text-dark bg-light" name="account_code"
                                      id="account_code" style="width: 100%;">
                              </div>
                          </div>
                          <div style="display: none;" id="acc_bo_div">
                              <div class="row mt-3">
                                  <div class="col-sm-4">
                                      <label for="">Account Number:</label>
                                  </div>
                                  <div class="col-sm-8">
                                      <input type="text" class="form-control text-dark bg-light" name="account_number"
                                          id="account_number" style="width: 100%;">
                                  </div>
                              </div>
                          </div>
          
                          <div style="display: none;" id="cr_div">
                              <div class="row mt-3">
                                  <div class="col-sm-4">
                                      <label for="">Currency:</label>
                                  </div>
                                  <div class="col-sm-8">
                                      <input type="text" class="form-control text-dark bg-light" name="currency" id="currency" style="width: 100%;">
                                  </div>
                              </div>
                          </div>
                          <div class="row mt-3">
                              <div class="col-sm-4">
                                  <label for="">Description:</label>
                              </div>
                              <div class="col-sm-8">
                                  <textarea name="description" class="form-control text-dark bg-light" id="description"
                                      placeholder="Max. 500 characters" style="width: 100%;"></textarea>
                              </div>
                          </div>
          
                      </div>
          
                      <div class="col-sm">
                          <div class="alert alert-warning alert-dismissible fade show" style="width: 50%;" >
                              <span id="message_hd" style="color: #000000;">Assets</span> <br>
                              <span id="message" style="color: #000000;">Track special assets like goodwill and other intangible assets</span>
                              <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                          </div>
                      </div>
                  </div>
                  <div class="row mt-5">
                    <div class="col-lg-12 col-md-12 col-sm-12">
                    <div class="d-flex justify-content-center">
                        <button class="btn save_btn rounded-pill text-grey w-25 my-1 mx-1 btn-outline-warning" type="button" id="newAccountSave">Save</button>
                        <button type="button" class="close btn save_btn rounded-pill text-grey w-25 my-1 mx-1 btn-outline-warning close_account_modal" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">Cancel</span></button>
                    </div>
                    </div>
                </div>
        </div>
      </div>
    </div>
  </div>
</div>









    







    






    







    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js" ></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js" ></script>
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>


<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
    function deleteContact(button) {
        var row = button.parentNode.parentNode;
        row.parentNode.removeChild(row);
    }

    document.querySelector('.add_another').addEventListener('click', function() {
        var table = document.getElementById('tbl').getElementsByTagName('tbody')[1];
        var newRow = table.insertRow(table.rows.length);

        for (var i = 1; i < 9; i++) {
            var cell = newRow.insertCell(i);
            cell.innerHTML = '<input type="text" class="form-control border-1 bg-transparent text-white" name="dynamic[]">';
        }

        var deleteCell = newRow.insertCell(9);
        deleteCell.innerHTML = '<button type="button" class="btn btn-danger" onclick="deleteContact(this)">Delete</button>';
    });
</script>

<!-- jQuery script to compare values and show alert -->
<script>
   

    $(document).ready(function() {
    // Attach event listener to input fields
    $('#opa, #cl').on('input', function() {
        // Get values of the input fields
        var openingBal = parseFloat($('#opa').val());
        var creditLimit = parseFloat($('#cl').val());

        // Check if credit limit is greater than opening balance amount
        if (creditLimit > openingBal) {
            // Show custom alert
            $('#custom-alert').fadeIn();

            // Clear the value of #cl
            $('#cl').val('');
        }
    });

    // Close custom alert when close button is clicked
    $('.close-btn').on('click', function() {
        $('#custom-alert').fadeOut();
    });
});
</script>

<script>

    $(document).ready(function(){

    // Get the CSRF token from the cookie
        function getCookie(name) {
        var cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            var cookies = document.cookie.split(';');
            for (var i = 0; i < cookies.length; i++) {
                var cookie = cookies[i].trim();
                // Does this cookie string begin with the name we want?
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
        }
        var csrftoken = getCookie('csrftoken');

        // Pan Number Check

        $('#panInput').on('input', function(){
        var panNumber = $(this).val();
        var regex = /[A-Z]{5}[0-9]{4}[A-Z]{1}$/;
        if(regex.test(panNumber)) {
            $('#panMessage').text('PAN number is valid.').css('color', 'green');
            // PAN number is valid, call AJAX to check if it exists
            $.ajax({
            url: "{% url 'customer_check_pan' %}",
            headers: {'X-CSRFToken': csrftoken}, 
            type: 'POST',
            data: {panNumber: panNumber},
            success: function(response) {
                if (response.status == 'exists') {
                    $('#panMessage').text('PAN number already exists.').css({
                        'color': 'red',
                        'font-size': '12px'
                    });
                    
                }
            }
            });
        } else {
            $('#panMessage').text('Please enter a valid PAN number.').css({
                'color': 'red',
                'font-size': '12px'
            });
        }
        });

        // Pna Number Check End 


        // GST Number Check 

        $('#gstInput').on('input', function(){
            var gstNumber = $(this).val();
            var regex = /^[0-9]{2}[A-Z]{5}[0-9]{4}[A-Z]{1}[1-9A-Z]{1}Z[0-9A-Z]{1}$/;
            if(regex.test(gstNumber)) {
                $('#gstMessage').text('GST number is valid.').css('color', 'green');
                // GST number is valid, call AJAX to check if it exists
                $.ajax({
                    url: "{% url 'customer_check_gst' %}",
                    headers: {'X-CSRFToken': csrftoken}, 
                    type: 'POST',
                    data: {gstNumber: gstNumber},
                    success: function(response) {
                        if (response.status == 'exists') {
                            $('#gstMessage').text('GST number already exists.').css({
                                'color': 'red',
                                'font-size': '12px'
                            });
                            
                        }
                    }
                    });
            } 
            else {
                $('#gstMessage').text('Please enter a valid GST number.').css({
                    'color': 'red',
                    'font-size': '12px'
                });
            }
            });
    
        // GST Number Check End 

    });

      // Name display 

        
      const Title = document.getElementById('select1');
const fname = document.getElementById('fname');
const laname = document.getElementById('lname');
const vDisplayName = document.getElementById('v_display_name');

// Listen for input events on the initial input fields
Title.addEventListener('input', updateOutputFields);
fname.addEventListener('input', updateOutputFields);
laname.addEventListener('input', updateOutputFields);

// Function to update the output fields
function updateOutputFields() {
    const selectedTitle = Title.value;
    const selectedFname = fname.value;
    const selectedLname = laname.value;

    // Clear existing options
    vDisplayName.innerHTML = '';
 // Add new options based on input field values
 const option1 = document.createElement('option');
    option1.text = selectedTitle + ' ' + selectedFname + ' ' + selectedLname;
    vDisplayName.add(option1);

   

    const option2 = document.createElement('option');
    option2.text = selectedFname + ' ' + selectedLname;
    vDisplayName.add(option2);

    const option3 = document.createElement('option');
    option3.text = selectedLname + ' ' + selectedFname;
    vDisplayName.add(option3);
}

</script>






<script>
    function gstPan_function(){
        var x=document.getElementById('GSTT').value
        if(x=="Unregistered Business-not Registered under GST")
        {
            document.getElementById("pan").style.display="block";
            document.getElementById("gst").style.display="none";

            
        }
        else if((x=="Registered Business-Regular Business that is registered under GST") || (x=="Registered Business-Composition Business that is registered under the Composition scheme in GST") || (x=="Overseas- Persons with who you do import or exports of supplies outside india") || (x=="Special Economic Zone"))
        {
            document.getElementById("gst").style.display="block";
            document.getElementById("pan").style.display="block";


        }
    
    }
  


    $(document).ready(function () {
        $(".toggle1").click(function (e) {
          e.preventDefault();
          $("fieldset1").toggle();
        })
      })
      $(document).ready(function () {
        $(".toggle2").click(function (e) {
          e.preventDefault();
         
          $("fieldset2").toggle(); 
          $("fieldset5").hide();
          $("fieldset6").hide();
          $("fieldset7").hide();


      
        })
      })

      $(document).ready(function () {
        $(".toggle3").click(function (e) {
          e.preventDefault();
          $("fieldset5").toggle();
          $("fieldset2").hide();
          $("fieldset6").hide();
          $("fieldset7").hide();

        })
      })
      $(document).ready(function () {
        $(".toggle4").click(function (e) {
          e.preventDefault();
          $("fieldset6").toggle();
          $("fieldset2").hide();
          $("fieldset5").hide();
          $("fieldset7").hide();
                
        })
      })
      $(document).ready(function () {
        $(".toggle7").click(function (e) {
          e.preventDefault();
          $("fieldset7").toggle();
          $("fieldset2").hide();
          $("fieldset6").hide();
          $("fieldset5").hide();
         

         
        })
      })

 
 
    $('document').ready(function () {
        $('.add_another').click(function () {
          $("#tbl").append(`<tr>
            <td>
                <select name="salutation[]" id="PLACE" class="form-control bg-transparent border-1 text-white">
                    <option value="Mr" class="text-dark" selected>Mr.</option>
                    <option class="text-dark" value=""Mrs">Mrs.</option>
                    <option class="text-dark" value="Ms">Ms.</option>
                    <option class="text-dark" value="Miss">Miss.</option>
                    <option class="text-dark" value="Dr">Dr.</option>
                </select>  
            </td>
            <td>
                <input type="text" name="first_name[]" class="form-control border-1 bg-transparent text-white"  value="" />
            </td>
            <td>
                <input type="text" name="last_name[]" class="form-control border-1 bg-transparent text-white"   value="" />
            </td>
            <td>
                <input type="email" name="email[]" class="form-control border-1 bg-transparent text-white" value="" />
            </td>
            <td>
                <input type="tel" pattern="[0-9]{7}" id="twphone" name="wphone[]" class="form-control border-1 bg-transparent text-white"  value="" />
            </td>
            <td>
                <input type="tel" pattern="[0-9]{10}" id="tmobile" onclick="sample1()" name="mobile[]" class="form-control border-1 bg-transparent text-white"  value="" />
            </td>
            <td>
                <input type="number" onclick="sample()" name="skype[]" class="form-control border-1 bg-transparent text-white"  value="" />
            </td>
            <td>
                <input type="text" name="designation[]" class="form-control border-1 bg-transparent text-white" value="" />
            </td>
            <td>
                <input type="text" name="department[]" class="form-control border-1 bg-transparent text-white" value="" />
            </td>
            <td><button type="button" class="btn btn-danger" onclick="deleteContact(this)">Delete</button></td>
        </tr>`);
        });
      })

      function fieldset5_function()
      {
        document.getElementById("address").style.display="block";
      }

    

    function myCopyAddressFunction() {
        var checkBox = document.getElementById("myCheckT");
        var textatn = document.getElementById("batten");
        var txtcry = document.getElementById("bctry");
        var txtadrs11 = document.getElementById("badd1");
        var txtcty = document.getElementById("bcty");
        var txtstat = document.getElementById("bste");
        var txtzip = document.getElementById("bzp");
        var txtphone = document.getElementById("bphone_num");
        var txtfx = document.getElementById("bfx");
  
        var textatn1 = document.getElementById("satten");
        var txtcry1 = document.getElementById("sctry");
        var txtadrs21 = document.getElementById("sadd1");
        var txtcty1 = document.getElementById("scty");
        var txtstat1 = document.getElementById("sste");
        var txtzip1 = document.getElementById("szp");
        var txtphone1 = document.getElementById("sphone_num");
        var txtfx1 = document.getElementById("sfx");
        if (checkBox.checked == true) {
          textatn1.value = textatn.value;
          txtadrs21.value = txtadrs11.value;
          txtcty1.value = txtcty.value;
          txtstat1.value = txtstat.value;
          txtzip1.value = txtzip.value; 
          txtphone1.value = txtphone.value;
          txtfx1.value = txtfx.value;
          



          
  
        } else {
          txtadrs21.value = "";
          txtcty1.value = "";
          txtstat1.value = "";
          txtzip1.value = "";
          txtphone1.value = "";
          txtfx1.value = "";
          txtcry1.value = "";
          textatn1.value = "";

  
        }
      }


      function open_table()
      {
        document.getElementById("hid").style.display="block";
        
      }



    

      function bphone_number()
      {
        var a1=document.getElementById("bphone_num").value;
        var b1=document.getElementById("bphone_label");
        var expr=/^[0-9]{10}$/;
        if (!expr.test(a1)) {
            b1.style.color="red";
            b1.style.fontSize="0.750rem";
            b1.innerHTML = "Invalid Phone Number. Please Enter 10 digit Number";
        }
        else{
            b1.style.color="green";
            b1.style.fontSize="0.750rem";
            b1.innerHTML = "Valid Phone Number.";

        }
      }

      function sphone_number()
      {
        var a1=document.getElementById("sphone_num").value;
        var b1=document.getElementById("sphone_label");
        var expr=/^[0-9]{10}$/;
        if (!expr.test(a1)) {
            b1.style.color="red";
            b1.style.fontSize="0.750rem";
            b1.innerHTML = "Invalid Phone Number.";
        }
        else{
            b1.style.color="green";
            b1.style.fontSize="0.750rem";
            b1.innerHTML = "Valid Phone Number.";

        }
      }

      function fax_number()
      {
        var a1=document.getElementById("bfx").value;
        var b1=document.getElementById("fax_label");
        var expr=/^[0-9]{7}$/;
        if (!expr.test(a1)) {
            b1.style.color="red";
            b1.style.fontSize="0.750rem";
            b1.innerHTML = "Invalid Fax Number.Please Enter 7 digit Number";
        }
        else{
            b1.style.color="green";
            b1.style.fontSize="0.750rem";
            b1.innerHTML = "Valid Fax Number.";

        }
      }

      function sfax_number()
      {
        var a1=document.getElementById("sfx").value;
        var b1=document.getElementById("sfax_label");
        var expr=/^[0-9]{7}$/;
        if (!expr.test(a1)) {
            b1.style.color="red";
            b1.style.fontSize="0.750rem";
            b1.innerHTML = "Invalid Fax Number.";
        }
        else{
            b1.style.color="green";
            b1.style.fontSize="0.750rem";
            b1.innerHTML = "Valid Fax Number.";

        }
      }

    
      function sample()
      {

        var tbldata = document.getElementById("tbl");
        var total_rows = tbldata.rows.length;
        x=document.getElementById("tbl");
        var a1=x.rows[total_rows-1].cells[5].getElementsByTagName('input')[0].value;

        var b1=document.getElementById("tlabel");

        b1.innerHTML = "";

        var expr=/^[0-9]{10}$/;
        if (!expr.test(a1)) {
            b1.style.color="red";
            b1.innerHTML = "Invalid";
            b1.style.fontSize="0.750rem";
        }
        else{
            b1.style.color="green";
            b1.innerHTML = "Valid";
            b1.style.fontSize="0.750rem";

        }

       

      }

      function sample1()
      {

        var tbldata = document.getElementById("tbl");
        var total_rows = tbldata.rows.length;
        x=document.getElementById("tbl");
        var a1=x.rows[total_rows-1].cells[4].getElementsByTagName('input')[0].value;

        var b1=document.getElementById("twph_label");

        b1.innerHTML = "";

        var expr=/^[0-9]{7}$/;
        if (!expr.test(a1)) {
            b1.style.color="red";
            b1.innerHTML = "Invalid";
            b1.style.fontSize="0.750rem";
        }
        else{
            b1.style.color="green";
            b1.innerHTML = "valid";
            b1.style.fontSize="0.750rem";

        }


      }


</script>

<script type="text/javascript">
    function vendor_display()
    {
        var x=document.getElementById("select1").value;
        var y=document.getElementById("fname").value;
        var z=document.getElementById("lname").value;

        document.getElementById("select2").innerHTML=x+" "+y+" "+z
    
        
    }
</script>

<script>

// customer pay tearm
$(document).on("click","#termSave",function(){
        var trm = $('#tname').val();
        var dys = $("#tdays").val();
        if (trm !="" && dys !=""){
            $.ajax({
                type : 'POST',
                url:"{% url 'newselPaymentTermEst' %}",
                data:{
                    'term' : trm,
                    'days' : dys,
                    csrfmiddlewaretoken: '{{ csrf_token }}'
                },
                
                success: function(response) {
                    if(response.status){
                        document.getElementById("modalPayment_terms").reset();
                        
                        var dropdown = $('#paytearm-select');
                        
                        // dropdown.empty();
                        // dropdown.append(`<option value="" selected>Choose</option>`);
                        $.each(response, function(key, value) {
                            for(let i=0; i<value.length; i++){
                                if(value[i].name == trm){
                                    dropdown.append($('<option selected ></option>').attr('text',value[i].days).text(value[i].name).val(value[i].id))
                                }
                                // else{
                                //     dropdown.append($('<option></option>').attr('text',value[i].days).text(value[i].name).val(value[i].id))
                                // }   
                            }
                        });

                        // findDueDate();

                    }else{
                        alert("Something went wrong.!")
                    }
                },         
            });
        }
        else{
            alert('Invalid')
        }
    });










//     $(document).on("click","#termSave",function(){
   
//     var trm = $("#tname").val();
//     var dys = $("#tdays").val();

//   $.ajax({
//     type : 'POST',
//     url:"",

//     data:{
//         'term' : trm,
//         'days' : dys,
        
//         csrfmiddlewaretoken: '{{ csrf_token }}'
        
//       },
    
//       success: function(response) {
//         // $("#tname").val('')
//         // $("#tdays").val('')
//         // var paytearmSelect = $('#paytearm-select'); 
//         //   paytearmSelect.empty();  // Clear existing options
          

//         //   // Add "Select" option
//         //   paytearmSelect.append('<option value="Due on Receipt" selected>Due on Receipt</option>');

//         //   // Add new options based on the Ajax response
//         //   $.each(response.payment_list, function(index, pay_terms) {
//         //     paytearmSelect.append('<option value="' + pay_terms.id + '">' + pay_terms.name + '</option>');
//         //   });
//         // // reloadPayment();


//         if(response.status){
//                         document.getElementById("modalPayment_terms").reset();
                        
//                         var dropdown = $('#paytearm-select');
//                         dropdown.empty();
//                         dropdown.append(`<option value="" selected>Choose</option>`);
//                         $.each(response, function(key, value) {
//                             for(let i=0; i<value.length; i++){
//                                 if(value[i].name == trm){
//                                     dropdown.append($('<option selected></option>').text(value[i].name).val(value[i].id))
//                                 }else{
//                                     dropdown.append($('<option></option>').text(value[i].name).val(value[i].id))
//                                 }   
//                             }
//                         });

//                     }else{
//                         alert("Something went wrong.!")
//                     }




//       },
//   });        
// });



$(document).on("click","#termSave1",function(){
        var trm = $('#tname1').val();
        var dys = $("#tdays1").val();
        if (trm !="" && dys !=""){
            $.ajax({
                type : 'POST',
                url:"{% url 'newselPaymentTermEst' %}",
                data:{
                    'term' : trm,
                    'days' : dys,
                    csrfmiddlewaretoken: '{{ csrf_token }}'
                },
                
                success: function(response) {
                    if(response.status){

                    

                        document.getElementById("modalPayment_terms1").reset();
                        // JavaScript to click the close button
                        document.querySelector('.close-button').click();
                        // document.getElementById('newpaymentTerm').style.display = 'none';
                        // $('#newpaymentTerm').fadeOut();
                        
                        var dropdown = $('#paytearm-select1');
                        // dropdown.empty();
                        // dropdown.append(`<option value="" selected>Choose</option>`);
                        $.each(response, function(key, value) {
                            for(let i=0; i<value.length; i++){
                                if(value[i].name == trm){
                                    dropdown.append($('<option selected></option>').attr('text',value[i].days).text(value[i].name).val(value[i].id))
                                }
                                // else{
                                //     dropdown.append($('<option></option>').attr('text',value[i].days).text(value[i].name).val(value[i].id))
                                // }   
                            }
                        });

                        findDueDate();

                    }else{
                        alert("Something went wrong.!")
                    }
                },         
            });
        }
        else{
            alert('Invalid')
        }
    });




//     $(document).on("click","#termSave1",function(){
//     var trm = $("#tname1").val();
//     var dys = $("#tdays1").val();
   

//   $.ajax({
//     type : 'POST',
//     url:"{% url 'customer_payment_terms_add' %}",

//     data:{
//         name : trm,
//         days : dys,
        
//         csrfmiddlewaretoken: '{{ csrf_token }}'
        
//       },
    
//       success: function(response) {
//         console.log(response)
//         $("#tname1").val('')
//         $("#tdays1").val('')
//         var paytearmSelect = $('#paytearm-select'); 
//           paytearmSelect.empty();  // Clear existing options
          

//           // Add "Select" option
//           paytearmSelect.append('<option value="Due on Receipt" selected>Due on Receipt</option>');

//           // Add new options based on the Ajax response data-days="{{pay_terms.days}}"
//           $.each(response.payment_list, function(index, pay_terms) {
//             paytearmSelect.append('<option value="' + pay_terms.id + '">' + pay_terms.name + '</option>');
//           });
//         // reloadPayment();

//         var paytearmSelect = $('#paytearm-select1'); 
//           paytearmSelect.empty();  // Clear existing options
          

//           // Add "Select" option
//           paytearmSelect.append('<option value="Due on Receipt" selected>Due on Receipt</option>');

//           // Add new options based on the Ajax response data-days="{{pay_terms.days}}"
//           $.each(response.payment_list, function(index, pay_terms) {
//             paytearmSelect.append('<option value="' + pay_terms.id + '">' + pay_terms.name + '</option>');
//           });
//         // reloadPayment();



//         // if(response.status){
//         //                 document.getElementById("modalPayment_terms").reset();
                        
//         //                 var dropdown = $('#paytearm-select1');
//         //                 dropdown.empty();
//         //                 dropdown.append(`<option value="" selected>Choose</option>`);
//         //                 $.each(response, function(key, value) {
//         //                     for(let i=0; i<value.length; i++){
//         //                         if(value[i].name == trm){
//         //                             dropdown.append($('<option selected></option>').text(value[i].name).val(value[i].id))
//         //                         }else{
//         //                             dropdown.append($('<option></option>').text(value[i].name).val(value[i].id))
//         //                         }   
//         //                     }
//         //                 });

//         //             }else{
//         //                 alert("Something went wrong.!")
//         //             }


                    
//       },
//   });        
// });


</script>





<script>
    // Get the input element
    const inputElement = document.getElementById("tname");

    // Add event listener for input event
    inputElement.addEventListener("input", function() {
        // Convert the input value to uppercase
        this.value = this.value.toUpperCase();
    });
</script>

<script>

$(document).ready(function() {
    $('#tname').on('input', function() {
        
        var termName = $(this).val();
       
        $.ajax({
            type: 'GET',
            url:'{% url "check_customer_term_exist" %}',
            data: {
                term_name: termName
            },
            success: function(response) {
                if (response.exists) {
                    $('#message-id').text('Term already exists !');
                    $('#success-message-id').text('');
                  
                    $('#tname').val('');
                } else {
                    $('#success-message-id').text('Term name available !');
                    $('#message-id').text('');
                }
                
            },
            error: function(xhr, status, error) {
                console.error('Error:', error);
            }
        });
    });
});

$('#vendor-email').on('input', function() {
        
    var vendorEmail = $(this).val();
    console.log(vendorEmail)
    $.ajax({
        type: 'GET',
        url:'{% url "check_customer_email_exist" %}',
        data: {
            vendor_email: vendorEmail
        },
        success: function(response) {
            if (response.exists) {
                $('#email-message-id').text('Email id already exists !');
                $('#vendor-email').val('');
            }
            else{
                $('#email-message-id').text('');
            }
            
        },
        error: function(xhr, status, error) {
            console.error('Error:', error);
        }
    });
});

$('#workphone').on('input', function() {
        
    var wPhone = $(this).val();
    
    $.ajax({
        type: 'GET',
        url:'{% url "check_customer_work_phone_exist" %}',
        data: {
            w_Phone: wPhone
        },
        success: function(response) {
            if (response.exists) {
                $('#workphone_label').text('Work phone number already exists !');
                $('#workphone').val('');
            }
            else{
                $('#workphone_label').text('');
            }
            
        },
        error: function(xhr, status, error) {
            console.error('Error:', error);
        }
    });
});


$('#mphone').on('input', function() {
        
    var mPhone = $(this).val();
    
    $.ajax({
        type: 'GET',
        url:'{% url "check_customer_phonenumber_exist" %}',
        data: {
            m_Phone: mPhone
        },
        success: function(response) {
            if (response.exists) {
                $('#mphone_label').text('Phone number already exists !');
                $('#mphone').val('');
            }
            else{
                $('#mphone_label').text('');
            }
            
        },
        error: function(xhr, status, error) {
            console.error('Error:', error);
        }
    });
});

</script>



<script>
    // Work Phone Number Validation 
    $(document).ready(function () {
        $('#workphone').on('input', function () {
            var inputVal = $(this).val();
            var expr = /^[0-9]{7}$/;
            if (expr.test(inputVal)) {
                $('#work-phone-message').text('Valid work phone number').css('color', 'green');
            } else {
                $('#work-phone-message').text('Invalid work phone number').css('color', 'red');
            }
        });
    });

    // Phone Number Validation
    $(document).ready(function () {
        $('#mphone').on('input', function () {
            var inputVal = $(this).val();
            var expr=/^[0-9]{10}$/;
            if (expr.test(inputVal)) {
                $('#phone-message').text('Valid  phone number').css('color', 'green');
            } else {
                $('#phone-message').text('Invalid  phone number').css('color', 'red');
            }
        });
    });
</script>







    <script>





function refreshTax(){
        var cmpState = $('#cmpstate').val();
        var plc = $('#placeOfSupply').val();
        if(cmpState == plc){
            $('.tax_ref').css('display','none');
            $('.tax_ref_gst').css('display','block');
            document.getElementById('taxamountCGST').style.display = 'flex';
            document.getElementById('taxamountSGST').style.display = 'flex';
            document.getElementById('taxamountIGST').style.display = 'none';
        }else{
            $('.tax_ref').css('display','none');
            $('.tax_ref_igst').css('display','block');
            document.getElementById('taxamountCGST').style.display = 'none';
            document.getElementById('taxamountSGST').style.display = 'none';
            document.getElementById('taxamountIGST').style.display = 'flex';
        }
    }







        function filterCustomers(){
            var options = $('#cust_drop').children();
            var search_text = $("#customer").val().toLowerCase();
            options.each(function(){
                if($(this).text().toLowerCase().includes(search_text)){
                    $(this).show()
                }else{
                    $(this).hide()
                }
            })
        }



        function getCustomerDetails(custId, name){
            $('#customer').val(name)
            console.log('name',name);
            if($('#customer').val() != ""){
                $('#custErr').text('');
                $.ajax({
                    type : 'POST',
                    url: "{% url 'get_customer_detailsAjax' %}",
                    data: {
                        id: custId,
                        csrfmiddlewaretoken: '{{ csrf_token }}',
                    },
                    
                    success: function(data){
                        console.log('AJAX-Response-->',data);
                        document.getElementById('customerId').value = data.id;
                        document.getElementById('customerEmail').value = data.email;
                        document.getElementById('placeOfSupply').value = data.shipState;
                        document.getElementById('customerGstType').value = data.gstType;
                        if(data.street == "" && data.city == "" && data.state == ""){
                            $("#billAddressSection").hide();
                        }else{
                            $('#billAddressSection').show();
                            document.getElementById('billAddress').value = data.street + ',' + data.city + '\n' + data.state + '\n' + data.country  + '\n' + data.pincode ;
                        }
                        if(data.gstin){
                            document.getElementById('customerGstInDisplay').style.display = 'flex';
                            document.getElementById('customerGSTIN').value = data.gstNo;
                        }else{
                            document.getElementById('customerGstInDisplay').style.display = 'none';
                            document.getElementById('customerGSTIN').value = '';
                        }
                        $('#applyPriceList').prop('checked') ? $('#applyPriceList').prop('checked', false) : $('#applyPriceList').prop('checked',false);
                        refreshTax();
                        checkPriceList();
                    }
                });
            }else{
                document.getElementById('customerEmail').value = "";
                document.getElementById('placeOfSupply').value = "";
                document.getElementById('customerGstType').value = "";
                document.getElementById('billAddress').value ="";
                document.getElementById('customerGSTIN').value = "";
                $('#custErr').text('Select a customer..');
            }
        }












    // function update_expiryDate(select) {
    //     var selectedOption = select.options[select.selectedIndex];
    //     var days = selectedOption.getAttribute('data-days');
    //     var est_date = document.getElementById('est_date').value;


    //     // Convert estimate date string to Date object
    //     var estimateDate = new Date(est_date);

    //     // Calculate expiration date by adding payment term days to estimate date
    //     var expirationDate = new Date(estimateDate.getTime() + (days * 24 * 60 * 60 * 1000));

    //     // Format expiration date as YYYY-MM-DD
    //     var formattedExpirationDate = expirationDate.toISOString().slice(0, 10);

    //     // Update the expiration date input field
    //     document.getElementById('exp_date').value = formattedExpirationDate;
    // }





    function filterFunction(){
        var options = $('#menu1').children();
        var search_text = $("#item").val().toLowerCase();
        options.each(function(){
            if($(this).text().toLowerCase().includes(search_text)){
                $(this).show()
            }else{
                $(this).hide()
            }
        })
    }







    function get_item_details(inpId, value, itemId){
     
      var itm = value;
      var exists = false;
      var plc = $('#placeOfSupply').val();

      $('#items-table-body tr').each(function () {
          var html = $(this).html();
          if (html != '') {
              var itemName = $(this).find('.item-display').val();
              console.log(itm,itemName);
              if(itemName == itm){
                  exists = true;
                  console.log('exists',exists);
              }
          }
      });
      $('#item').val(value);

      if(!exists){
          if(plc != ""){
                  var n = inpId.slice(4);
                  $.ajax({
                      url: "{% url 'get_item_detailsAjax' %}",
                      type : 'GET',
                      data:{
                          id : itemId,
                          csrfmiddlewaretoken: '{{ csrf_token }}'
                          },
                      
                      success: function(data) {
                          if (data.status){
                            //   $('#'+n).val(value);
                              console.log('AJAX-Response-->',data);
                              document.getElementById('item'+n).value = value;
                              document.getElementById('itemId'+n).value = data.id;
                              document.getElementById('hsn'+n).value = data.hsn;
                              document.getElementById('qtyspan'+n).innerHTML = data.avl;
                              document.getElementById('avl'+n).innerHTML = data.avl;
                              document.getElementById('price'+n).value = data.sales_rate;
                            //   document.getElementById('priceListPrice'+n).value = response.PLPrice;
                              document.getElementById('taxGST'+n).value = data.gst;
                              document.getElementById('taxIGST'+n).value = data.igst;
                              refreshTax();
                              calc();
                          }
                      },
                  });
              
          }else{
              alert('Select Place of Supply.!')
          }
      }else{
          alert('Item already exists in the Estimate, choose another or change quantity.!')
      }

    }






      
  </script>

    <script>

        // $(document).on("click","#addItem",function(){
        //     var name = $("#nameInput").val();
        //     var type = $("input[name='itemType']:checked").val();
        //     var unit = $("#selunit").val();
        //     var hsn = $("#myInputField").val();
        //     var purAccount = $("#myaccount").val();
        //     var trck;
        //     if($('#trackInv').prop('checked')){
        //         trck = 1
        //     }else{
        //         trck = 0
        //     }
        //     if(type == undefined){
        //         alert('Please select item type')
        //         return
        //     }
        //     if($('#gridRadios3').prop('checked') || $('#gridRadios4').prop('checked')){
        //         if($('#gridRadios3').prop('checked')){
        //             var tax = 'taxable'
        //         }else{
        //             var tax = 'None-Taxable'
        //         }
        //     }else{
        //         alert("Should select any of tax reference")
        //         return
        //     }

        //     if (name !="" && type !="" && unit != "" && hsn != "" && tax != "" && purAccount != ""){
        //         $.ajax({
        //             type : 'POST',
        //             url:,
        //             data:{
        //                 'name' : name,
        //                 'type' : type,
        //                 'unit' : unit,
        //                 'hsn' : hsn,
        //                 'taxref' : tax,
        //                 'intra_st' : $("#intraStateTax").val(),
        //                 'inter_st' : $("#interStateTax").val(),
        //                 'pcost' : $("#purprice").val(),
        //                 'pur_account' : purAccount,
        //                 'pur_desc' : $("#purchaseDescription").val(),
        //                 'salesprice' : $("#salesprice").val(),
        //                 'sale_account' : $("#salesAccount").val(),
        //                 'sale_desc' : $("#salesDescription").val(),
        //                 'invacc' : $("#invAcc").val(),
        //                 'stock' : $("#stockOnHand").val(),
        //                 'stock_rate' : $("#stockRate").val(),
        //                 'min_stock' : $("#minStock").val(),
        //                 'trackInv' : trck,
        //                 csrfmiddlewaretoken: '{{ csrf_token }}'
        //             },
                    
        //             success: function(response) {
        //                 if(response.status){
        //                     console.log("AJAX Success",response)
        //                     document.getElementById("newItemForm").reset();

        //                     if($('#newItem').hasClass('show')){
        //                         $('#newItem .close_item_modal').click()
        //                     }
        //                     reloadItems();
        //                 }else{
        //                     alert(response.message)
        //                 }
        //             },         
        //         });
        //     }
        //     else{
        //         alert('Fill all required fields.!')
        //         return;
        //     }
        // });










        $(document).on("click", "#addItemNew", function() {
        $.ajax({
        type: 'POST',
        url: "{% url 'sales_estimate_new_item' %}",
        data: {
            type: $("input[name='type']").val(),
            name: $("input[name='name']").val(),
            unit: $("select[name='unit']").val(), // Corrected to select element
            hsn: $("input[name='hsn']").val(),
            radio: $("input[name='radio']:checked").val(), // Corrected to select checked radio button
            intra: $("select[name='intra']").val(), // Corrected to select element
            inter: $("select[name='inter']").val(), // Corrected to select element
            sel_price: $("input[name='sel_price']").val(),
            sel_acc: $("select[name='sel_acc']").val(), // Corrected to select element
            sel_desc: $("input[name='sel_desc']").val(),
            cost_price: $("input[name='cost_price']").val(),
            cost_acc: $("select[name='cost_acc']").val(), // Corrected to select element
            pur_desc: $("input[name='pur_desc']").val(),
            trackstate: $("input[name='trackstate']").prop('checked'), // Corrected to get checked state
            minimum_stock: $("input[name='minimum_stock']").val(),
            invacc: $("select[name='invacc']").val(), // Corrected to select element
            openstock: $("input[name='openstock']").val(),
            rate: $("input[name='rate']").val(),
            csrfmiddlewaretoken: '{{ csrf_token }}'
        },
        success: function(response) {
            // Clear input fields
            $("input[name='type']").val('');
            $("input[name='name']").val('');
            $("select[name='unit']").val(''); // Corrected to select element
            $("input[name='hsn']").val('');
            $("input[name='radio']").val('');
            $("select[name='intra']").val(''); // Corrected to select element
            $("select[name='inter']").val(''); // Corrected to select element
            $("input[name='sel_price']").val('');
            $("select[name='sel_acc']").val(''); // Corrected to select element
            $("input[name='sel_desc']").val('');
            $("input[name='cost_price']").val('');
            $("select[name='cost_acc']").val(''); // Corrected to select element
            $("input[name='pur_desc']").val('');
            $("input[name='trackstate']").prop('checked', false); // Corrected to uncheck checkbox
            $("input[name='minimum_stock']").val('');
            $("select[name='invacc']").val(''); // Corrected to select element
            $("input[name='openstock']").val('');
            $("input[name='rate']").val('');

            // Update select element options
            var itemSelect = $('#nameSelect'); // Corrected variable name
            itemSelect.empty(); // Clear existing options
            itemSelect.append('<option selected>Select a item</option>'); // Add "Select" option

            // Add new options based on the Ajax response data
            $.each(response.item_list, function(index, item) {
                itemSelect.append('<option value="' + item.id + '" ' +
                    'data-hsn="' + item.hsn_code + '" ' +
                    'data-price="' + item.selling_price + '" ' +
                    'data-tax="' + item.taxreference + '" ' +
                    'data-tax-intrastate="' + item.intrastate_tax + '" ' +
                    'data-tax-interstate="' + item.interstate_tax + '">' +
                    item.item_name +
                    '</option>');
            });
        },
    });
});



$(document).on("click","#addItemNew1",function(){
    var name = $("#nameInput").val();
    var type = $("input[name='type']:checked").val();
    var unit = $("#selunit").val();
    var hsn = $("#hsn").val();
    var purAccount = $("#myaccount").val();
    var trck;
    if($('#trackInv').prop('checked')){
        trck = 1
    }else{
        trck = 0
    }
    if(type == undefined){
        alert('Please select item type')
        return
    }
    if($('#gridRadios1').prop('checked') || $('#gridRadios2').prop('checked')){
        if($('#gridRadios1').prop('checked')){
            var tax = 'taxable'
        }else{
            var tax = 'None-Taxable'
        }
    }else{
        alert("Should select any of tax reference")
        return
    }

    if (name !="" && type !="" && unit != "" && hsn != "" && tax != "" && purAccount != ""){
        $.ajax({
            type : 'POST',
            url:"{% url 'sales_estimate_new_item' %}",
            data:{
                'name' : name,
                'type' : type,
                'unit' : unit,
                'hsn' : hsn,
                'taxref' : tax,
                'intra_st' : $("#intraStateTax").val(),
                'inter_st' : $("#interStateTax").val(),
                'pcost' : $("#purprice").val(),
                'pur_account' : purAccount,
                'pur_desc' : $("#purchaseDescription").val(),
                'salesprice' : $("#salesprice").val(),
                'sale_account' : $("#salesAccount").val(),
                'sale_desc' : $("#salesDescription").val(),
                'invacc' : $("#invAcc").val(),
                'stock' : $("#stockOnHand").val(),
                'stock_rate' : $("#stockRate").val(),
                'min_stock' : $("#minStock").val(),
                'trackInv' : trck,
                csrfmiddlewaretoken: '{{ csrf_token }}'
            },
            
            success: function(response) {
                if(response.status){
                    console.log("AJAX Success",response)
                    document.getElementById("newItemForm").reset();

                    if($('#newItem').hasClass('show')){
                        $('#newItem .close_item_modal').click()
                    }
                    // reloadItems();
                }else{
                    alert(response.message)
                }
            },         
        });
    }
    else{
        alert('Fill all required fields.!')
        return;
    }
});




function reloadItems() {
    $.ajax({
        url: "",
        type: "GET",
        dataType: "json",
        data: {},
        csrfmiddlewaretoken: '{{ csrf_token }}',

        success: function(data) {
            $('#items-table-body tr').each(function () {
                var currentRow = $(this);
                var html = currentRow.html();
                
                if (html !== '') {
                    currentRow.find(".items-available").find("li").remove();

                    $.each(data, function(key, value) {
                        console.log(value[1]);
                        currentRow.find(".items-available").append(`<li class="dropdown-item items-options text-white" onclick="getItemDetails($(this).parent().prev().attr('id'),'${value[1]}')">${value[1]}</li>`);
                    });
                }
            });
        },
        error: function(xhr, status, error) {
            console.error(xhr.responseText);
        }

    });
    if ($('#newAccount').hasClass('show')){
        $('#newAccount .close_account_modal').click();
    }

    if ($('#unitmodal').hasClass('show')){
        $('#unitmodal .close_unit_modal').click();
    }
}









    
    </script>












<!-- TAXABLE SCRIPT0 -->
<script>
    function showAllSelect() {
    var select1_div = document.getElementById("select1_div");
    var select2_div = document.getElementById("select2_div");
    select1_div.style.display = "block";
    select2_div.style.display = "block";
    }

    function hideAllSelect() {
    var select1_div = document.getElementById("select1_div");
    var select2_div = document.getElementById("select2_div");
    select1_div.style.display = "none";
    select2_div.style.display = "none";
    }
    </script>

<!-- TAXABLE SCRIPT0  end-->


<!-- TRACK INVENTORY SCRIPT -->
<script>
    function toggleFormFields() {
      var formFields = document.getElementById("formFields");
      var checkbox = document.querySelector("input[name=trackstate]");

      if (checkbox.checked) {
        formFields.style.display = "block";
      } else {
        formFields.style.display = "none";
      }
    }
  </script>

      <!-- TRACK INVENTORY SCRIPT END -->



<script>



$(document).on('click','.remove_row',function(){
    var row_id = $(this).attr("id");
    $('#tab_row'+row_id+'').remove();
    refreshIndex();
    calc();
});






$(document).ready(function(){
      $('#add').click(function(){
        var roinc = $("#items-table-body tr").length;
        roinc++
        $('#items-table-body').append(
            `
            <tr id='tab_row${roinc}'>
              <td class="nnum  bg-black text-white" style="text-align: center;">${roinc}</td>
              <td>
                  <input type="hidden" name="itemId[]" id="itemId${roinc}" value="">
                  <div class="d-flex">
                      <div class="w-100">
                          <div class="p-0 border-0 bg-none position-relative drop-box" style="display: block;">
                              <input required type="text" id="item${roinc}" value="" name="item_name[]" class="dropdown-toggle form-control text-white item-display" onkeyup="filterFunction()"  data-bs-toggle="dropdown" aria-expanded="false" placeholder="Items.." autocomplete="off">
                              <ul class="dropdown-menu w-100 items-available position-absolute bg-black text-white" id="menu${roinc}"  style="overflow-y: auto; height: fit-content;max-height: 40vh; border: 1px solid gray;"> 
                                  {% for i in items %}
                                  <li class="dropdown-item items-options text-white" onclick="get_item_details($(this).parent().prev().attr('id'),'{{i.item_name}}','{{i.id}}')">{{i.item_name}}</li>
                                  {% endfor %}
                              </ul>
                              
                          </div>
                      </div>
                      <a href="#">
                          <button type="button" class="btn btn-outline-warning ms-1" data-target="#newItem" data-toggle="modal"><i class="fa fa-plus text-yellow"></i></button>
                      </a>
                  </div>
              
              </td>
              <td>
                  <input type="hidden" name="item_id[]" id="itemId${roinc}">
                  <input type="hidden" name="id[]">
                  <input type="text" name='hsn[]' id="hsn${roinc}" placeholder='HSN' class="form-control bg-black text-white HSNCODE" readonly />
              </td>
              <td >
                  <input type="number" name='qty[]' id="qty${roinc}"  class="form-control bg-black text-white qty mb-1" step=0 min=1 value=0 onchange="changeItemQty(this.id)" required/>
                  <input type="text" id="avl${roinc}" style="display: none;">
                  <div class="d-flex text-white" style="font-size: 0.7rem;"><span>Available Qty:</span><span id="qtyspan${roinc}" class=''></span></div>
              </td>
              <td>
                  <input type="number" name='price[]' id="price${roinc}" class="form-control bg-black text-white price" step="0.00" min="0" style="display: block;" value=0 readonly />
                  <input type="number" name='priceListPrice[]' id="priceListPrice${roinc}" class="form-control bg-black text-white priceListPrice" step="0.00" min="0" style="display: none;" value=0 readonly />
              </td>
              
              <td>
                  <select name='taxGST[]' id="taxGST${roinc}" class="form-control bg-black text-white tax_ref tax_ref_gst" style="display: block;" onchange="taxchange(this.id)">
                      <option selected disabled hidden>Select GST</option>
                      <option value=28 >28.0% GST</option>
                      <option value=18 >18.0% GST</option>
                      <option value=12 >12.0% GST</option>
                      <option value=5 >05.0% GST</option>
                      <option value=3 >03.0% GST</option>
                      <option value=0 >0.0% GST</option>
                  </select>
                  <select name='taxIGST[]' id="taxIGST${roinc}" class="form-control bg-black text-white tax_ref tax_ref_igst" style="display: none;" onchange="taxchange(this.id)">
                      <option selected disabled hidden >Select IGST</option>
                      <option value=28 >28.0% IGST</option>
                      <option value=18 >18.0% IGST</option>
                      <option value=12 >12.0% IGST</option>
                      <option value=5 >05.0% IGST</option>
                      <option value=3 >03.0% IGST</option>
                      <option value=0 >0.0% IGST</option>
                  </select>
                  <div class="mt-1" style=" text-align: center;color: red;" ><span id="invalidtax${roinc}" style="display: none;"> Invalid Tax %</span> </div>    
              </td>
              <td >
                  <input type="number" name='discount[]'  placeholder='Enter Discount' id="disc${roinc}" value=0 class="form-control bg-black text-white disc" step='any' min=0  />
              </td>

              <td><input type="number" name='total[]' id="total${roinc}" class="form-control bg-black text-white total" value=0 readonly /></td>
              <td style="display: none;"><input type="hidden" id="taxamount${roinc}" class="form-control itemTaxAmount" /></td>
              <td>
                <i class="fa fa-trash text-danger remove_row" style="cursor: pointer;" title="Remove Row" id="${roinc}"></i>
              </td>
          </tr>
            `);
            reloadItems();
            checkPriceList();
        });
    });


    function changeItemQty(id){
        id_val = id.slice(3)
        var qty = document.getElementById(id).value;
        var avl_val = document.getElementById(`avl${id_val}`).innerText;
    
        if( parseInt(qty) > parseInt(avl_val) ){
            alert("Quantity Greater than Available Quantity")
            document.getElementById(id).value = avl_val;
            calc();
        }else{
            document.getElementById(`qtyspan${id_val}`).textContent = parseInt(avl_val) - parseInt(qty);
            calc();
        }
    }


    $(document).ready(function(){
        $('#items-table-body').on('keyup change', function () {
            refreshTax();
            calc();
        });
    });



    function calc() {
      $('#estimateItemsTable tbody tr').each(function () {
        var html = $(this).html();
        if (html != '') {
          var qty = $(this).find('.qty').val();
          if($('#applyPriceList').prop('checked') && $('#priceListIds').val() != ""){
              var price = $(this).find('.priceListPrice').val();
          }else{
              var price = $(this).find('.price').val();
          }
          var dis = $(this).find('.disc').val();
          var bc = $("#placeOfSupply").val();
          var compstate = $("#cmpstate").val();

          if(bc==compstate){
              var tax = $(this).find('.tax_ref_gst').val();
          }
          else{
              var tax = $(this).find('.tax_ref_igst').val();
          }
          $(this).find('.total').val((parseFloat(qty) * parseFloat(price)) - parseFloat(dis));
          $(this).find('.itemTaxAmount').val(((qty * price)-dis) * (tax / 100));
          calc_total();
        }
      });
    }





    function calc_total() { 
      total = 0;
      $('.total').each(function () {
          total += parseFloat($(this).val());
      });
      taxamount = 0;
      $('.itemTaxAmount').each(function () {
          taxamount += parseFloat($(this).val());
      });
      $('#sub_total').val(total.toFixed(2));
      $('#tax_amount').val(taxamount.toFixed(2));
      var ship = parseFloat($("#ship").val());
      var adj_val = parseFloat($('#adj').val())
      var gtot = taxamount + total + ship + adj_val;

      $('#grandtotal').val(gtot.toFixed(2));
      
      var adv_val = parseFloat($('#advance').val())
      var bal = gtot - adv_val
      $('#balance').val(bal.toFixed(2));
      splitTax();
    }

    

    function splitTax(){
    var bc = $("#placeOfSupply").val();
    var compstate = $("#cmpstate").val();
    d=0
    if (bc == compstate  ) {
        var gst = taxamount/2
        $('#cgstAmount').val(parseFloat(gst.toFixed(2)));
        $('#sgstAmount').val(parseFloat(gst.toFixed(2)));
        $('#igstAmount').val(parseFloat(d.toFixed(2)));
    }else{
        $('#igstAmount').val(taxamount.toFixed(2));
        $('#cgstAmount').val(d.toFixed(2));
        $('#sgstAmount').val(d.toFixed(2));
    }   
  }

  $(document).on('change','#placeOfSupply',function()   {
        refreshTax();
        calc();
    });






//     $(document).on("click", "#newCustomerSave1", function(){
//         console.log("Button clicked!");
//       var type = $('input[name="type"]:checked').val();
//       var title = $('#select1').val();
//       var fName = $('#fname').val();
//       var lName = $('#lname').val();
//       var placeSupply = $('#PLACE').val();
//       var gstType = $("#GSTT").val();
//       var gstIN = $("#gstInput").val();
//       var panNo = $("#panInput").val();
//       var Email = $("#vendor-email").val();
//       var Mob = $("#mphone").val();
//       var street = $("#badd1").val();
//       var city = $("#bcty").val();
//       var state = $("#bste").val();
//       var pin = $("#bzp").val();
//       var country = $("#btry").val();
//       var tax_ref = $('input[name="tax1"]:checked').val();
//       var tSalutation = []
//       var tFirstName = []
//       var tLastName = []
//       var tEmail = []
//       var tWork = []
//       var tMobile = []
//       var tSkype = []
//       var tDesignation = []
//       var tDepartment = []

//       console.log(gstIN, Email)

//       if(gstType != "" && gstType != "Unregistered Business-not Registered under GST" && gstType != 'Overseas- Persons with who you do import or exports of supplies outside india' && gstIN == ""){
//           alert('Fill Enter GSTIN..!')
//           return
//       }

//       $('#tbl tbody tr').each(function(){
//         var row = $(this)
//         if(row != ""){
//             var sal = row.find('.salutation').val();
//             var fn = row.find('.first_name').val();
//             var ln = row.find('.last_name').val();
//             var eml = row.find('.email').val();
//             var wrk = row.find('.work_phone').val();
//             var mob = row.find('.mobile_phone').val();
//             var sky = row.find('.skype_number').val();
//             var dep = row.find('.department').val();
//             var des = row.find('.designation').val();
//             console.log(sal,fn,ln, eml,wrk, mob, sky, dep, des)
//             // if(sal == "" && fn == "" && ln == "" && eml == "" && wrk == "" && mob == "" && sky == "" && dep == "" && des == ""){
//             //     console.log('No table data')
//             // }else{
//             //     if(sal == "" || fn == "" || ln == "" || eml == "" || wrk == "" || mob == "" || sky == "" || dep == "" || des == ""){
//             //         // alert('Fill All Fields of Contact persons table')
//             //         // return
//             //     }
//             // }
//             tSalutation.push(sal);
//             tFirstName.push(fn);
//             tLastName.push(ln);
//             tEmail.push(eml);
//             tWork.push(wrk);
//             tMobile.push(mob);
//             tSkype.push(sky);
//             tDesignation.push(des);
//             tDepartment.push(dep);
//         }
//     })
//     var cols = [tSalutation,tFirstName,tLastName,tEmail,tWork,tMobile,tSkype,tDesignation,tDepartment]
//     var cntactTableLength = $('#tbl tbody tr').length
//     var nullExists = false
//     if(cntactTableLength == 1 && tSalutation[0] == "" && tFirstName[0] == "" && tLastName[0] == "" && tEmail[0] == "" && tWork[0] == "" && tMobile[0] == "" && tSkype[0] == "" && tDesignation[0] == "" && tDepartment[0] == ""){
//         console.log('No table data')
//     }else{
//         for(i=0; i<cols.length; i++){
//             for(j=0; j<cols[i].length; j++){
//                 if(cols[i][j] == ''){
//                     nullExists = true
//                 }
//             }
//         }
//         // if(sal == "" || fn == "" || ln == "" || eml == "" || wrk == "" || mob == "" || sky == "" || dep == "" || des == ""){
//         //     // alert('Fill All Fields of Contact persons table')
//         //     // return
//         // }
//     }
//     if(nullExists){
//         alert('Fill All Fields of Contact persons table')
//         return
//     }

//       if(fName != "" && lName != "" && placeSupply != "" && gstType != "" && panNo != "" && Email != "" && Mob != "" && tax_ref != undefined){
//           $.ajax({
//               type : 'POST',
//               url:"",
//               data:{
//                 'type': type,
//                 'salutation' : title,
//                 'first_name' : fName,
//                 'last_name' : lName,
//                 'company_name' : $('#companyName').val(),
//                 'v_display_name' : $('#v_display_name').val(),
//                 'vendor_email' : Email,
//                 'w_phone' : $('#workphone').val(),
//                 'm_phone' : Mob,
//                 'skype_number' : $('#skypeNumber').val(),
//                 'designation' : $('#design').val(),
//                 'department' : $('#dept').val(),
//                 'website' : $('#web').val(),
//                 'gst' : gstType,
//                 'remark' : $('#rmrk').val(),
//                 'pan_number' : panNo,
//                 'gst_number' : gstIN,
//                 'source_supply' : placeSupply,
//                 'currency' : $('#crncy').val(),
//                 'op_type' : $('input[name="op_type"]:checked').val(),
//                 'opening_bal' : $('#opa').val(),
//                 'payment_terms' : $('#paytearm-select').val(),
//                 'plst' : $('#priceLs').val(),
//                 'plang' : $('#plang').val(),
//                 'fbk' : $('#fbk').val(),
//                 'twtr' : $('#twtr').val(),
//                 'tax1' : tax_ref,
//                 'battention' : $('#batten').val(),
//                 'bcountry' : country,
//                 'baddress' : street,
//                 'bcity' : city,
//                 'bstate' : state,
//                 'bzip' : pin,
//                 'bphone' : $('#bphone_num').val(),
//                 'bfax' : $('#bfx').val(),
//                 'sattention' : $('#satten').val(),
//                 's_country' : $('#sctry').val(),
//                 'saddress' : $('#sadd1').val(),
//                 'scity' : $('#scty').val(),
//                 'sstate' : $('#sste').val(),
//                 'szip' : $('#szp').val(),
//                 'sphone' : $('#sphone_num').val(),
//                 'sfax' : $('#sfx').val(),
//                 'tsalutation[]' : tSalutation,
//                 'tfirstName[]' : tFirstName,
//                 'tlastName[]' : tLastName,
//                 'tEmail[]' : tEmail,
//                 'tWorkPhone[]' : tWork,
//                 'tMobilePhone[]' : tMobile,
//                 'tSkype[]' : tSkype,
//                 'tDesignation[]' : tDesignation,
//                 'tDepartment[]' : tDepartment,
//                 csrfmiddlewaretoken: '{{ csrf_token }}',
//               },

//               success: function(response) {
//                 if(response.status){
//                     console.log("AJAX Success",response)
//                     document.getElementById("newCustomerForm").reset();
//                     if($('#newCustomer').hasClass('show')){
//                         $("#newCustomer .close_customer_modal").click()
//                     }
//                     reloadCustomer(title, fName, lName);
//                 }else{
//                     alert(response.message)
//                 }
//               },
//           });
//       }else{
//           alert('Fill all required fields..!')
//           return
//       }
//   });



$(document).on("click", "#newCustomerSave", function(){
      var type = $('input[name="type"]:checked').val();
      var title = $('#select1').val();
      var fName = $('#fname').val();
      var lName = $('#lname').val();
      var placeSupply = $('#PLACE').val();
      var gstType = $("#GSTT").val();
      var gstIN = $("#gstInput").val();
      var panNo = $("#panInput").val();
      var Email = $("#vendor-email").val();
      var Mob = $("#mphone").val();
      var street = $("#badd1").val();
      var city = $("#bcty").val();
      var state = $("#bste").val();
      var pin = $("#bzp").val();
      var country = $("#btry").val();
      var tax_ref = $('input[name="tax1"]:checked').val();
      var tSalutation = []
      var tFirstName = []
      var tLastName = []
      var tEmail = []
      var tWork = []
      var tMobile = []
      var tSkype = []
      var tDesignation = []
      var tDepartment = []

      if(gstType != "" && gstType != "Unregistered Business-not Registered under GST" && gstType != 'Overseas- Persons with who you do import or exports of supplies outside india' && gstIN == ""){
          alert('Fill Enter GSTIN..!')
          return
      }

      $('#tbl tbody tr').each(function(){
        var row = $(this)
        if(row != ""){
            var sal = row.find('.salutation').val();
            var fn = row.find('.first_name').val();
            var ln = row.find('.last_name').val();
            var eml = row.find('.email').val();
            var wrk = row.find('.work_phone').val();
            var mob = row.find('.mobile_phone').val();
            var sky = row.find('.skype_number').val();
            var dep = row.find('.department').val();
            var des = row.find('.designation').val();
            console.log(sal,fn,ln, eml,wrk, mob, sky, dep, des)
            //if(sal == "" && fn == "" && ln == "" && eml == "" && wrk == "" && mob == "" && sky == "" && dep == "" && des == ""){
             //   console.log('No table data')
            //}else{
             //   if(sal == "" || fn == "" || ln == "" || eml == "" || wrk == "" || mob == "" || sky == "" || dep == "" || des == ""){
             //       // alert('Fill All Fields of Contact persons table')
                    // return
             //   }
            //}
            tSalutation.push(sal);
            tFirstName.push(fn);
            tLastName.push(ln);
            tEmail.push(eml);
            tWork.push(wrk);
            tMobile.push(mob);
            tSkype.push(sky);
            tDesignation.push(des);
            tDepartment.push(dep);
        }
    })
  

    if(fName != "" && lName != "" && placeSupply != "" && gstType != "" && panNo != "" && Email != "" && Mob != "" ){
          $.ajax({
              type : 'POST',
              url:"{% url 'newEstimateCustomerAjax' %}",
              data:{
                'type': type,
                'salutation' : title,
                'first_name' : fName,
                'last_name' : lName,
                'company_name' : $('#companyName').val(),
                'v_display_name' : $('#v_display_name').val(),
                'vendor_email' : Email,
                'w_phone' : $('#workphone').val(),
                'm_phone' : Mob,
                'skype_number' : $('#skypeNumber').val(),
                'designation' : $('#design').val(),
                'department' : $('#dept').val(),
                'website' : $('#web').val(),
                'gst' : gstType,
                'remark' : $('#rmrk').val(),
                'pan_number' : panNo,
                'gst_number' : gstIN,
                'source_supply' : placeSupply,
                'currency' : $('#crncy').val(),
                'op_type' : $('input[name="op_type"]:checked').val(),
                'opening_bal' : $('#opa').val(),
                'payment_terms' : $('#paytearm-select').val(),
                'plst' : $('#priceLs').val(),
                'plang' : $('#plang').val(),
                'fbk' : $('#fbk').val(),
                'twtr' : $('#twtr').val(),
                'tax1' : tax_ref,
                'battention' : $('#batten').val(),
                'bcountry' : country,
                'baddress' : street,
                'bcity' : city,
                'bstate' : state,
                'bzip' : pin,
                'bphone' : $('#bphone_num').val(),
                'bfax' : $('#bfx').val(),
                'sattention' : $('#satten').val(),
                's_country' : $('#sctry').val(),
                'saddress' : $('#sadd1').val(),
                'scity' : $('#scty').val(),
                'sstate' : $('#sste').val(),
                'szip' : $('#szp').val(),
                'sphone' : $('#sphone_num').val(),
                'sfax' : $('#sfx').val(),
                'tsalutation[]' : tSalutation,
                'tfirstName[]' : tFirstName,
                'tlastName[]' : tLastName,
                'tEmail[]' : tEmail,
                'tWorkPhone[]' : tWork,
                'tMobilePhone[]' : tMobile,
                'tSkype[]' : tSkype,
                'tDesignation[]' : tDesignation,
                'tDepartment[]' : tDepartment,
                csrfmiddlewaretoken: '{{ csrf_token }}',
              },

              success: function(response) {
                if(response.status){
                    console.log("AJAX Success",response)
                    document.getElementById("newCustomerForm").reset();
                    if($('#newCustomer').hasClass('show')){
                        $("#newCustomer .close_customer_modal").click()
                    }
                    reloadCustomer(title, fName, lName);
                }else{
                    alert(response.message)
                }
              },
          });
    }else{
          alert('Fill all required fields..!')
          return
      }
  });






  function reloadCustomer(title,fName,lName) {
      const fullName = title+' '+fName+' '+lName
      $.ajax({
          url: "{% url 'getEstCustomersAjax' %}",
          type: "GET",
          dataType: "json",
          data: {},

          success: function(data) {
              console.log('Ajax Response ->',data);
              var custDrpDwn = $('#cust_drop');
              custDrpDwn.empty();
              custDrpDwn.append(`<li class="dropdown-item customers-options text-white" onclick="getCustomerDetails('','')">Select Customer</li>`);

              $.each(data, function (key, value) {
                  const customerDetails = `${value[1]} ${value[2]} ${value[3]}`;
                  const ID = `${value[0]}`

                  if(customerDetails == fullName){
                      getCustomerDetails(value[0], customerDetails)
                  }
                  const listItem = $(`
                      <li class="dropdown-item customers-options text-white" onclick="getCustomerDetails('${ID}', '${customerDetails}')">${customerDetails}</li>`
                  );
                  custDrpDwn.append(listItem);
              });
              console.log('Customers RELOADED');

          },
          error: function(xhr, status, error) {
              console.error(xhr.responseText);
          }

      });
      // refreshCustomerDetails();

      if ($('#newpayment').hasClass('show')){
          $('#newpayment .cust_payment_modal_close').click();
      }
  }








  $(document).on("click","#saveNewItem",function(){
    var name = $("#nameInput").val();
    var type = $("input[name='itemType']:checked").val();
    var unit = $("#selunit").val();
    var hsn = $("#myInputField").val();
    var purAccount = $("#myaccount").val();
    var trck;
    if($('#trackInv').prop('checked')){
        trck = 1
    }else{
        trck = 0
    }
    if(type == undefined){
        alert('Please select item type')
        return
    }
    if($('#gridRadios3').prop('checked') || $('#gridRadios4').prop('checked')){
        if($('#gridRadios3').prop('checked')){
            var tax = 'taxable'
        }else{
            var tax = 'None-Taxable'
        }
    }else{
        alert("Should select any of tax reference")
        return
    }

    if (name !="" && type !="" && unit != "" && hsn != "" && tax != "" && purAccount != ""){
        $.ajax({
            type : 'POST',
            url:"{% url 'createNewItemAjaxEst' %}",
            data:{
                'name' : name,
                'type' : type,
                'unit' : unit,
                'hsn' : hsn,
                'taxref' : tax,
                'intra_st' : $("#intraStateTax").val(),
                'inter_st' : $("#interStateTax").val(),
                'pcost' : $("#purprice").val(),
                'pur_account' : purAccount,
                'pur_desc' : $("#purchaseDescription").val(),
                'salesprice' : $("#salesprice").val(),
                'sale_account' : $("#salesAccount").val(),
                'sale_desc' : $("#salesDescription").val(),
                'invacc' : $("#invAcc").val(),
                'stock' : $("#stockOnHand").val(),
                'stock_rate' : $("#stockRate").val(),
                'min_stock' : $("#minStock").val(),
                'trackInv' : trck,
                csrfmiddlewaretoken: '{{ csrf_token }}'
            },
            
            success: function(response) {
                if(response.status){
                    console.log("AJAX Success",response)
                    document.getElementById("newItemForm").reset();

                    if($('#newItem').hasClass('show')){
                        $('#newItem .close_item_modal').click()
                    }
                    reloadItems();
                }else{
                    alert(response.message)
                }
            },         
        });
    }
    else{
        alert('Fill all required fields.!')
        return;
    }
});

function reloadItems() {
    $.ajax({
        url: "{% url 'getAllItemsAjaxEst' %}",
        type: "GET",
        dataType: "json",
        data: {},
        csrfmiddlewaretoken: '{{ csrf_token }}',

        success: function(data) {
            $('#items-table-body tr').each(function () {
                var currentRow = $(this);
                var html = currentRow.html();
                
                if (html !== '') {
                    currentRow.find(".items-available").find("li").remove();

                    $.each(data, function(key, value) {
                        console.log(value[1]);
                        currentRow.find(".items-available").append(`<li class="dropdown-item items-options text-white" onclick="get_item_details($(this).parent().prev().attr('id'),'${value[1]}','${value[0]}')">${value[1]}</li>`);
                    });
                }
            });
        },
        error: function(xhr, status, error) {
            console.error(xhr.responseText);
        }

    });
    if ($('#newAccount').hasClass('show')){
        $('#newAccount .close_account_modal').click();
    }

    if ($('#unitmodal').hasClass('show')){
        $('#unitmodal .close_unit_modal').click();
    }

}



$(document).ready(function() {
    // Close modal when close button is clicked
    $('.modal-header .close').click(function() {
        $('#newpaymentTerm').modal('hide');
    });
});


$(document).ready(function() {
    // Close modal when close button is clicked
    $('.modal-header .close').click(function() {
        $('#newpaymentcustomer').modal('hide');
    });
});




<!-- New Item scripts -->

    $(document).ready(function() {
        $('#myaccount').selectize();
    });
    $(document).ready(function() {
        $('#selunit').selectize();
    });

    $(document).on("click", "#newUnitSave", function(event) {
        event.preventDefault(); // Prevent the default form submission
        var uName = $("#unitName").val();
        $.ajax({
          type: 'POST',
          url: "{% url 'addest_unit' %}",
          data: {
            units: uName,
            csrfmiddlewaretoken: '{{ csrf_token }}'
          },
          success: function(response) {
            if (response.message === 'success') {
              document.getElementById("unitform").reset();
              if($('#unitmodal').hasClass('show')){
                    $("#unitmodal .close_unit_modal").click()
                }
              reloadUnit(uName);
            } else {
              $("#error-message-container").text("Unit with the same name exists");
            }
          },
        });
      });

      function reloadUnit(unit) {
      
        $.ajax({
                url: "{% url 'show_unit_dropdownest' %}",
                type: "GET",
                dataType: "json",
                data: $(this).serialize(),
                csrfmiddlewaretoken: '{{ csrf_token }}',
            
                success: function(data) {
                    var setVal = "";
                    var $select = $(document.getElementById('selunit'));
                    var selectize = $select[0].selectize;
                    $.each(data, function(key, value) {
                        if(unit == value[1]){
                            setVal = value[0]
                        }
                        selectize.addOption({value:value[0],text:value[1]});
                        selectize.addItem(value[0]); 
                    });

                    if(setVal != ""){
                        selectize.setValue(setVal);
                    }
            
                },
        
        });
      }

    function showAllSelect() {
        var select1_div = document.getElementById("select1_div");
        var select2_div = document.getElementById("select2_div");
        select1_div.style.display = "block";
        select2_div.style.display = "block";
    }

    function hideAllSelect() {
        var select1_div = document.getElementById("select1_div");
        var select2_div = document.getElementById("select2_div");
        select1_div.style.display = "none";
        select2_div.style.display = "none";
    }

      function toggleFormFields() {
        var formFields = document.getElementById("formFields");
        var checkbox = document.querySelector("input[name=trackstate]");
    
        if (checkbox.checked) {
            formFields.style.display = "block";
        } else {
            formFields.style.display = "none";
        }
        }

        function validateSixDigits(field) {
              // Define the regular expression pattern for exactly six digits
              var pattern = /^\d{6}$/;
      
              // Check if the field matches the pattern
              return pattern.test(field);
          }
      
          function validateInput() {
              var inputField = document.getElementById("myInputField");
              var inputValue = inputField.value;
      
              var validationResultDiv = document.getElementById("validationResult");
      
              if (validateSixDigits(inputValue)) {
                  validationResultDiv.textContent = "Valid";
              } else {
                  validationResultDiv.textContent = "Invalid: The field does not contain six digits.";
              }
          }




          $(document).on('change','#estNumber', function() {
            $('#estNoErr').text('');
            var est_num = $(this).val();
            if(est_num != ""){
                console.log(est_num);
                $.ajax({
                    type: "GET",
                    url: "{% url 'checkEstimateNumber' %}",
                    data: {
                        EstNum : est_num,
                    },
                    success: function (response) {
                        console.log(response)
                        if (response.status){
                            $('#estNoErr').text('');
                        }else{
                            $('#estNoErr').text(response.message);
                        }
                    }
                })
            }
        });



        $(document).ready(function(){
      $(document).on('keyup',"#ship",function(){
          var subtot = $('#sub_total').val();
          var tax = $('#tax_amount').val();
          var sh = $("#ship").val();
          var adj = $("#adj").val();
          $('#grandtotal').val((parseFloat(subtot)+parseFloat(tax)+parseFloat(sh)+parseFloat(adj)).toFixed(2));
          $('#balance').val((parseFloat($("#grandtotal").val())-parseFloat($("#advance").val())).toFixed(2))
          
      });

      $(document).on("blur", "#ship", function(){
          if($(this).val() != ""){
          }else{
          $(this).val(0);
          calc_total();
          }
      }); 
    });

    $(document).ready(function(){
      $(document).on("keyup", "#adj", function(){
          var subtot = $('#sub_total').val();
          var tax = $('#tax_amount').val();
          var sh = $("#ship").val();
          var adj = $("#adj").val();
          $('#grandtotal').val((parseFloat(subtot)+parseFloat(tax)+parseFloat(sh)+parseFloat(adj)).toFixed(2));
          $('#balance').val((parseFloat($("#grandtotal").val())-parseFloat($("#advance").val())).toFixed(2))
      });

      $(document).on("blur", "#adj", function(){
          if($(this).val() != ""){
          }else{
          $(this).val(0);
          calc_total();
          }
      }); 
    });



    function findDueDate(){
        var days = parseInt($('#paytearm-select1').find(":selected").attr('text'))
        start_date =new Date($('#est_date').val())

        if (!isNaN(start_date.getTime())) {

            const endDate = new Date(start_date);
            endDate.setDate(endDate.getDate() + days);
            console.log(endDate);

            const isoString = endDate.toISOString(); 
            const day = isoString.slice(8, 10);
            const month = isoString.slice(5, 7);
            const year = isoString.slice(0, 4);

            const formattedDate = `${year}-${month}-${day}`;

            document.getElementById("exp_date").value = formattedDate;
            console.log("done")
        } else {
                alert("Please enter a valid date.");
                $('#paytearm-select1').val('')
        }
    }

    $('#est_date').on('change', function() {
        findDueDate();
    });

    $('#paytearm-select1').on('change', function () {
        findDueDate();
    });



    function closePaymodal(){
        // JavaScript to click the close button
        document.querySelector('.close-button').click();
    }













      </script>









</body>





{% endblock %}