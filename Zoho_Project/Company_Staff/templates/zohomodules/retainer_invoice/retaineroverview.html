{% extends 'base.html' %}
{% load static %}
{% block content %}
{% load social_share %}

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
<script src="https://unpkg.com/@popperjs/core@2/dist/umd/popper.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/print-js/1.6.0/print.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.3.2/html2canvas.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>


<style>

  
  .hidden-option {
    display: none;
  }

  a {
    list-style: none;
    color: azure;
  }

  a:hover {
    color: rgb(218, 164, 48);
    text-decoration: none;
  }

  .tab {
    overflow: hidden;
    background-color: transparent;
    width: 300px;
  }

  .tab a {
    font-family: inherit;
    background-color: inherit;
    float: left;
    outline: none;
    cursor: pointer;
    padding: 10px 5px;
    transition: 0.3s;
    color: azure;
    border: none;
  }

  .tab a:hover {
    background-color: #ddd;
    color: rgb(56, 54, 54);
  }

  .tab a.active {
    background-color: #ccc;
    color: rgb(56, 54, 54);
  }

  .tabcontent {
    display: none;
    border-top: none;
  }

  .page {
    background: white;
    display: block;
    box-shadow: 0 0 0.5cm rgba(0, 0, 0, 0.5);
  }

  .print-only {
    /* display: none; */
    height: auto;
    width: auto;
    overflow-y: auto;
    border: none;
    /* box-shadow: inset 2px 2px 5px 2px rgba(0, 0, 0, 0.3),
          inset -2px -2px 5px 2px rgba(0, 0, 0, 0.3),
          inset 2px -2px 5px 2px rgba(0, 0, 0, 0.3),
          inset -2px 2px 5px 2px rgba(0, 0, 0, 0.3); */
  }

  .card-custom {
    background-color: rgba(255, 255, 255, 0.5);
  }

  .card-text {
    margin-bottom: 0.5rem;
  }

  .info-container {
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  .info-item {
    display: flex;
    align-items: center;
  }

  .label {
    margin: 0;
    width: 130px; 
  }

  .value {
    margin: 0;
    flex: 1;
  }

  .info-container {
    display: flex;
    justify-content: space-between;
  }

  .info-item {
    display: flex;
    align-items: center;
    margin-bottom: 10px;
  }

 .info-item h6.label {
    margin-left: 10px;
    display: inline-block;
  } 

  .info-item p.value {
    margin-left: 10px;
  }

  .bank-info {
    margin-bottom: 10px;
  }

  .bank-info span {
    padding: 5px; 
  }

  .modal{
    z-index: 9999;
    overflow: scroll;
  }

  .btn-outline-warning:hover{
    color: black;
    font-weight:bolder;
  }


  #Overview tbody tr td{
    border: none;
  }

  .medium_btn{
    font-size: 12px; 
    padding: 10px 20px;
    margin-left: 1px;
  }

  #overview_btn{
    background-color: #ffae1f; 
    color: black; 
    font-weight: bold;
  }

  .modal .btn-outline-warning:hover{
    color: black !important;
  }

  .modal{
    margin-top: 3.5%;
  }
  
  .dropdown-item:hover{
    cursor: pointer;
  }

  .info-label {
    flex: 0 0 50%;
  }

  .info-value {
    flex: 1;
  }

  ::-webkit-scrollbar{
    display: none;
  }

  .page[size="A4"] {
    overflow: hidden;
  }
  
  @media print {
    body * {
      visibility: visible;
    }

    header {
      display: none;
    }

    .print-only * {
      visibility: visible;
    }

    .print-only {
      visibility: visible;
        position: fixed;
        left: 0;
        top: 0;
        right: 0;
        height:auto;
        page-break-before: always;
        page-break-inside: avoid;
    }
  }

  .small_btn{
    padding: 5px 9px;
    height: 50%;
    margin-top: 1%;
  }

  .xsmall_btn{
    padding: 6px;
    margin-top: 1%;
  }

  .comments-table-container {
    max-height: 30vh;
    overflow-y: scroll;
  }

  .history-table-container {
    max-height: 50vh;
    overflow-y: scroll;
  }

  .comments-table-container table, .history-table-container table {
    width: 100%;
    /* border-collapse: collapse; */
  }

.comments-table-container td, .history-table-container td {
    /* border: 1px solid #ddd; */
    padding: 8px;
    color: white;
    text-align: center;
  }

  .comments-table-container th, .history-table-container th {
    border-bottom: 1px solid #ddd;
    padding: 8px;
    color: white;
    text-align: center;
  }

  @media print {
    body{
        visibility: hidden !important;

        background-color: white;
    }

    #slip{
        margin-left: 2vh;
        margin-right: 2vh;
    }

    .printContainer {
                                                          visibility: visible !important; /* Override the rule above to only show the printables*/
                                                          position: absolute;
                                                          z-index: 99999;
                                                          top: 0;
                                                          left: 0;
                                                          width: 100%;
                                                          height: 100%;
                                                          font-size: large;
                                                      } 
                                                

}

  /* SLIP VIEW STYLINGS */
  .slip h5{
        font-family: serif;
    }
    p {
        font-size: 1.2em;
    }
    .address{
        display: flex;
        flex-direction: column;
    }
    .address p,.slip-footer p{
        font-size: 1rem;
        margin: 0;
    }
    .slip-container{
        width: 105mm;
        margin: 2rem auto;
        padding: 2rem;
        border: 1px dotted black;
        box-shadow: rgba(60, 64, 67, 0.5) 0px 1px 2px 0px, rgba(60, 64, 67, 0.35) 0px 2px 6px 2px;
    }
    .divider{
        margin: 1rem 0;
        border-bottom: 3px dotted black;
    }
    .trns-id p,.datetime p, .createdby p{
        font-size: 0.85rem;
        margin: 0;
    }
    .equal-length-container {
        display: flex;
        align-items: center;
        justify-content: space-between;
        height: 100%;
        margin-left: 2vh;
        margin-right: 2vh;
    }

    .equal-length-item {
        flex: 1;
        text-align: center;
    }

    .fw-bold{
      font-weight: 600 !important;
    }
    .extra-info p span {
        font-weight: 400;
    }

    /* Balance Info Section */
    .balance-info .table td,
    .balance-info .table th {
        padding: 0;
        border: 0;
    }

    .balance-info tr td:first-child {
        font-weight: 600;
    }

    .whatsapp-this a {
      color: black;
      padding-left: 15px;
    }
</style>

<div class="body-wrapper" id="body_wrapper">
  <div class="container-fluid">
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{% url 'company_dashboard' %}" class="text-warning-emphasis">Dashboard</a></li>
        <li class="breadcrumb-item"><a class="text-warning-emphasis">Sales</a></li>
        <li class="breadcrumb-item"><a href="{% url 'retainer_list' %}" class="text-warning-emphasis">Retainer Invoice</a></li>
        <li class="breadcrumb-item" aria-current="page" id="overviewBtn">Overview</li>
        <li class="breadcrumb-item" aria-current="page" id="attachmentDropdown" style="display: none;">Templates</li>
        <li class="breadcrumb-item" aria-current="page" id="slipBtn" style="display: none;">Slip</li>
      </ol>
    </nav>
    <div class="row pt-3">
      <div class="col-md-12">
        <div class="card mb-5">
          <div class="row" style="background-color: #252525;" >
            <!-- Left Side: Table -->
            <div class="col-md-12 col-lg-4" style="background-color: black; border-radius: 1vh;">
              <div class="p-4"> 
                <h6 class="pt-3" style="font-size: 1.8rem; color: white;">All Retainer Invoice</h6>
                <div class="d-flex justify-content-between gap-1 mt-2 mr-4">
                  <input class="form-control text-black bg-light mt-4" type="text" id="search" placeholder="Search..." style="margin-right: 10%;">

                  <a class="btn btn-outline-warning small_btn mt-4" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false" role="button">
                  <i class="fa fa-sort mt-1" style="font-size: small;"></i>
                  </a>
                  <div class="dropdown-menu ">
                      <a class="dropdown-item text-black" href="{% url 'retaineroverview' pk=invoice.pk %}" >All</a>
                      <a class="dropdown-item text-black" onclick="sortTable()">Name</a>
                      <a class="dropdown-item text-black" onclick="sortTablebybillno()">Retainer Invoice Number</a>
                  </div>
  
                  <a class="btn btn-outline-warning small_btn mt-4" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false" role="button">
                    <i class="fa fa-filter" style="font-size: small;"></i>
                  </a>
                  <div class="dropdown-menu">
                    <a class="dropdown-item text-black"  href="{% url 'retaineroverview' pk=invoice.pk %}" >All</a>
                    <a class="dropdown-item text-black" href="{% url 'retaineroverview' pk=invoice.pk %}?status=sent">Saved</a>
                    <a class="dropdown-item text-black" href="{% url 'retaineroverview' pk=invoice.pk %}?status=draft">Draft</a>
                  </div>
                  <a class="btn btn-outline-warning small_btn mt-4" role="button" href="{% url 'new_retainer'%}">
                    <i class="fa fa-plus"></i>
                  </a>
                </div>
      
                <div class="row">
                  <div class="col-md-12 mt-2">
                    <div class="table-responsive">
                      <table class="table text-white" id="sidetable">
                        <tbody>
                          {% for invoice in invoices %}
                          <tr class="clickable" id="{{invoice.id}}"style="cursor: pointer;">
                            <td>
                              
                              <span class="name"><b><a class="text-white"  href="{% url 'retaineroverview' pk=invoice.id %}">{{invoice.retainer_invoice_number}} </a></b></span><br><br>
                              <span class="invNo"><a class="text-white"  href="{% url 'retaineroverview' pk=invoice.id %}">{{ invoice.customer_name.customer_display_name }}</a></span>
                            </td>
                            <td>
                              {% if invoice.is_sent == False %}
                              <span style="float: right;" >&#8377;Draft</span><br><br>
                              {% else %}
                              <span style="float: right;" >&#8377;Send</span><br><br>
                              {% endif %}
                              <span style="float: right;">₹{{ invoice.total_amount }}</span>
                            </td>
                          </tr>
                          {% endfor %}
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="col-md-12 col-lg-8">
              <div style="background-color: black; border-radius: 1vh;">
                <div class="card-header p-4">
                  <h6 class="mt-3" style="font-size: 1.8rem; color: white;">Retainer Invoice</h6><br>
                  {% for message in messages %}
                  <h5>
                    <div class="alert alert-danger message text-center" style="color: black;" id="alert_danger">
                      {{ message }}
                      <a type="button" id="alert_close" class="close" data-dismiss="alert" aria-label="Close" style="float: right;">
                        <span aria-hidden="true" style="font-size: large; color: #68020F;">&times;</span>
                      </a>
                    </div>
                  </h5>
                  {% endfor %}
                  <div class="row">
                    <div class="col-md-6">
                      <a class="btn btn-outline-warning xsmall_btn" onclick="overview_function()" id="overviewBtn">
                        <i class="fa fa-eye" style="font-weight: bold; font-size: small;" ></i> 
                        <span style="font-size: small;">Overview</span>
                      </a>
                      <a class="btn btn-outline-warning xsmall_btn ms-1" onclick="template_function()"  id="attachmentDropdown" aria-haspopup="true" aria-expanded="false">
                        <span class="fa fa-file-invoice" style="font-weight: bold;  font-size: small;" ></span> 
                        <span style="font-size: small;">Templates</span>
                      </a>
                      <a class="btn btn-outline-warning xsmall_btn ms-1"  onclick="show_slip()" id="slipBtn">
                        <i class="fa fa-receipt" style="font-weight: bold;  font-size: small;" id="slip_icon"></i>
                        <span style="font-size: small;">Slip</span> 
                      </a>
                    </div>
                    <div class="col-md-6">
                      <div class="d-sm-flex" style="float: right;">


                        <div id="overview_buttons">
                          <!-- Overview buttons -->
                          <!-- Place the buttons you want to show for Overview here -->
                     
                        <div class="col-sm-1 " >
                          <div class="col-md-6 d-flex justify-content-between align-items-center">
                
                            {% if invoice.is_sent == False %}
                            <a class="btn btn-outline-warning btn-sm mt-2 ms-1" onclick="convertToSaved({{ invoice.id }})" title="CONVERT" id="convert_btn">
                                <i style="height:5px;" class="fa fa-exchange"></i>
                            </a>
                        {% endif %}
                        
                
                      
                              <!-- Edit Button -->
                              <a href="{% url 'retainer_edit_page' retainer_id=retainer_id %}" class="btn btn-outline-warning mt-2 ms-1 btn-sm"  title="Save this draft">
                                  <i style="height:5px;" class="fas fa-pencil-alt"></i>
                              </a>
                      
                              
                      
                              <!-- Delete Button -->
                              <a href="{% url 'delete_retainer' retainer_id=invoice.id %}" class="delete fa fa-trash btn btn-outline-warning mt-2 ms-1 btn-sm" data-toggle="tooltip" title="DELETE" onclick="return confirm('Do you want to Delete this Item?');" style="margin-left: 4px; padding-top: 8px; padding-bottom: 8px;"></a>
                
                              <!-- Attach button Button -->
                              <a class="btn btn-outline-warning small_btn mt-2 ms-1 btn-sm" id="attach_btn" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="fas fa-paperclip" ></i> 
                            </a>
                          
                                      
                            <div class="dropdown-menu" aria-labelledby="attach_btn">
                              <a class="dropdown-item text-black" data-toggle="modal" data-target="#retainer_files">Add Document</a>
                              {% if invoice.document and invoice.document.url %} 
                                  <a class="dropdown-item text-black" download href="{{ invoice.document.url }}">Download Document</a>
                              {% endif %}
                          </div>
                          
                           
                              <a class="btn btn-outline-warning btn-sm" style="margin-left: 4px; margin-top: 5px;" id="comment_btn"  href="#commentsModal" data-toggle="modal"   title="COMMENTS">
                                <i class="fa fa-comment" style="padding-top: 3px; padding-bottom: 3px; "></i>
                              </a>
                
                
                              
                
                
                              <a class="btn btn-outline-warning btn-sm" style="margin-left: 4px; margin-top: 5px;" id="history_btn"  href="#historyModal" data-toggle="modal"   title="HISTORY">
                                <i class="fa-solid fa-clock-rotate-left"></i>
                              </a>
                
                
                              
                              
                          </div>
                      </div>
                    </div>

                    <div id="template_buttons" style="display: none;">
                      <div class="col-sm-1 " >
                        <div class="col-md-6 d-flex justify-content-between align-items-center">
                      <!-- Template buttons -->
                       <a class="btn btn-outline-warning small_btn mt-2 ms-1" style="font-size: 10px;margin-left: 4px; margin-top: 5px;"  title="SHARE" id="share_btn" data-bs-toggle="dropdown" aria-expanded="false">
                                          <i class="fas fa-share" style="font-size: 10px;"></i>
                                      </a>
                                        <div class="dropdown-menu" aria-labelledby="share_btn">
                                            <li class="text-black">{% post_to_whatsapp object_or_url "WhatsApp" %}</li>
                                            
                                            <a class="dropdown-item text-black" data-toggle="modal" data-target="#shareToEmail">Email</a>
                                        </div>
                                   
                                        <button href="" class="btn btn-outline-warning small_btn mt-2 ms-1 btn_print" style="font-size: 10px;margin-left: 4px; margin-top: 5px;" data-toggle="tooltip"
                                        title="PDF" id="pdf-button">
                                        <i class="fa fa-file-pdf"></i></button>
                
                                    <button class="btn btn-outline-warning small_btn mt-2 ms-1 print-button" style="font-size: 10px;margin-left: 4px; margin-top: 5px;" data-toggle="tooltip" title="Print"
                                        id="print-button">
                                        <i class="fa fa-print"></i></button>
                                        
                                        <a class="btn btn-outline-warning btn-sm" style="margin-left: 4px; margin-top: 5px;" id="comment_btn"  href="#commentsModal" data-toggle="modal"   title="COMMENTS">
                                          <i class="fa fa-comment" style="padding-top: 3px; padding-bottom: 3px; "></i>
                                        </a>
                          
                      <a class="btn btn-outline-warning btn-sm" style="margin-left: 4px; margin-top: 5px;" id="history_btn"  href="#historyModal" data-toggle="modal"   title="HISTORY">
                        <i class="fa-solid fa-clock-rotate-left"></i>
                      </a>
                      </a>
                      </div>
                      </div>
                
                      <!-- Place the buttons you want to show for Templates here -->
                  </div>




                  <div id="slip_buttons" style="display: none;">
                    <div class="col-sm-1 " >
                      <div class="col-md-6 d-flex justify-content-between align-items-center">
                        <button href="" class="btn btn-outline-warning small_btn mt-2 ms-1 btn_print" style="font-size: 10px;margin-left: 4px; margin-top: 5px;" data-toggle="tooltip"
                                        title="PDF" id="pdfslip-button">
                                        <i class="fa fa-file-pdf"></i></button>
                
                                    <button class="btn btn-outline-warning small_btn mt-2 ms-1 print-button" style="font-size: 10px;margin-left: 4px; margin-top: 5px;" data-toggle="tooltip" title="Print"
                                        id="printslip-button">
                                        <i class="fa fa-print"></i></button>
                    <!-- Slip buttons -->
                    <a class="btn btn-outline-warning btn-sm" style="margin-left: 4px; margin-top: 5px;" id="comment_btn"  href="#commentsModal" data-toggle="modal"   title="COMMENTS">
                      <i class="fa fa-comment" style="padding-top: 3px; padding-bottom: 3px; "></i>
                    </a>
      
                    <a class="btn btn-outline-warning btn-sm" style="margin-left: 4px; margin-top: 5px;" id="history_btn"  href="#historyModal" data-toggle="modal"   title="HISTORY">
                      <i class="fa-solid fa-clock-rotate-left"></i>
                    </a>
                    </div>
                    </div>
                
                    <!-- Place the buttons you want to show for Slip here -->
                </div>



                      </div>
                    </div>
                  </div><br>

                </div>

                <div id="Overview" style="background-color: #aba9a9;">
                  <div class="history_highlight pt-3 px-2 d-flex">
                    <div class="col-12 d-flex justify-content-start align-items-center">
                        
                        {% if modified_by_details %}
    <p class="m-0" style="font-size: 1.07rem; font-weight: 500; color: #E91E63;">Last Edited by: {{ modified_by_details.first_name }} {{ modified_by_details.last_name }}</p>
    <span class="ms-5" style="color: #383838;">{{ modified_by_details.modified_at }}</span>
{% elif created_by_details %}
    <p class="m-0" style="font-size: 1.07rem; font-weight: 500; color: #017500;">Created by: {{ created_by_details.first_name }} {{ created_by_details.last_name }}</p>
    <span class="ms-5" style="color: #383838;">{{ created_by_details.created_at }}</span>
{% endif %}



                    </div>
                  </div>
                  <div class="row" id="div-to-pdf">
                    <h1  class="text-black mt-3 ps-5" style="text-align: left;">#{{invoice.retainer_invoice_number}}</h1>
                    <hr class="text-black" style="margin-left: 5%; margin-right: 5%">
                    <div class="col-md-6 p-4">
                      <div class="row">
                        <div class="col-md-8">
                          <h5 class="fw-bold" style="border-bottom: 1px solid rgba(128, 128, 128, 0.6); width: fit-content;">Company Details</h5>
                        </div>
                        <div class="col-md-4"></div>
                      </div>
                      <div class="d-flex px-3 justify-content-between text-black mb-2">
                        <h6 class="mb-0">Company</h6>
                        <p class="mb-0 text-right">{{ company.company_name }}</p>
                      </div>
                      <div class="d-flex px-3 justify-content-between text-black mb-2">
                        <h6 class="mb-0">Mobile</h6>
                        <p class="mb-0 text-right">{{ company.contact }}</p>
                      </div>
                      <div class="d-flex px-3 justify-content-between text-black mb-2">
                        <h6 class="mb-0">Address</h6>
                        <p class="mb-0" style="margin-left: 75px;">
                          {{ company.address }}, {{ company.city }}<br>
                          {{company.state}} - {{ company.pincode}} 
                        </p>
                      </div>

                      <div class="row mt-4">
                        <div class="col-md-8">
                          <h5 class="fw-bold" style="border-bottom: 1px solid rgba(128, 128, 128, 0.6); width: fit-content;">Customer Details</h5>
                        </div>
                        <div class="col-md-4"></div>
                      </div>
                      <div class="d-flex px-3 justify-content-between text-black mb-2">
                        <h6 class="mb-0">Customer Name</h6>
                        <p class="mb-0 text-right fw-bold">{{ customer_name }}</p>
                      </div>
                      <div class="d-flex px-3 justify-content-between text-black mb-2">
                        <h6 class="mb-0">Customer Mail ID</h6>
                        <p class="mb-0 text-right">{{ invoice.customer_mailid }}</p>
                      </div>

                      <div class="d-flex px-3 justify-content-between text-black mb-2">
                        <h6 class="mb-0">GST Treatment</h6>
                        <p class="mb-0 text-right " style="margin-left: 55px;">{{ gst_treatment }}</p>
                      </div>

                      <div class="d-flex px-3 justify-content-between text-black mb-2">
                        <h6 class="mb-0">GST Number</h6>
                        <p class="mb-0 text-right">{{ gst_number }}</p>
                      </div>
                      <div class="d-flex px-3 justify-content-between text-black mb-2">
                        <h6 class="mb-0">Place Of Supply:</h6>
                        <p class="mb-0 text-right">{{ place_of_supply }}</p>
                      </div>
                      
                     
                     
                      <div class="row mt-4">
                        <div class="col-md-8">
                          <h5 class="fw-bold" style="border-bottom: 1px solid rgba(128, 128, 128, 0.6); width: fit-content;">Retainer Invoice Details</h5>
                        </div>
                        <div class="col-md-4"></div>
                      </div>
                      <div class="d-flex px-3 justify-content-between text-black mb-2">
                        <h6 class="mb-0">Retainer Invoice No</h6>
                        <p class="mb-0 text-right fw-bold">{{invoice.retainer_invoice_number}}</p>
                      </div>
                      <div class="d-flex px-3 justify-content-between text-black mb-2">
                        <h6 class="mb-0">Retainer Invoice Date</h6>
                        <p class="mb-0 text-right">{{invoice.retainer_invoice_date}}</p>
                      </div>

                      <div class="d-flex px-3 justify-content-between text-black mb-2">
                        <h6 class="mb-0">Address</h6>
                        <p class="mb-0 text-right fw-bold">{{ billing_address }}</p>
                      </div>

                      <div class="d-flex px-3 justify-content-between text-black mb-2">
                        <h6 class="mb-0">Payment Method</h6>
                        {% if ret_payments.payment_opt %}
                        <p class="mb-0 text-right">{{ ret_payments.payment_opt }}</p>
                        {% if ret_payments.acc_no %}
                        <p class="mb-0 text-right">Ac/No</p>
                        <p class="mb-0 text-right">{{ ret_payments.acc_no}}</p>
                        {% endif %}
                        {% if ret_payments.upi_id %}
                        <p class="mb-0 text-right">{{ ret_payments.upi_id }}</p>
                        {% endif %}
                        {% if ret_payments.cheque_no %}
                        <p class="mb-0 text-right">{{ ret_payments.cheque_no }}</p>
                        {% endif %}
                        {% endif %}
                      </div>
                      
                     
                      







                    </div>

                    <div class="col-md-6 px-3">
                      <div class="px-3 py-3 mb-3" style="background-color: #0a0a0a; border-radius: 6px;">
                        <h4 class="text-white my-3" style="text-align: center;">Ret.Invoice Amount Details</h4>
                        <hr class="text-white" style="margin-left: 5%; margin-right: 5%">
                        <div class="d-flex justify-content-between mb-4">
                            <h6 class="text-white" style="font-weight: 600;">Retainer Invoice Status</h6>
                            {% if invoice.is_sent == False %} <span class="text-info h5" style="font-weight: 600;">DRAFT</span> {% else %} <span class="text-warning h5"  style="font-weight: 600;">SAVED</span> {% endif %}
                        </div>
                        <div class="d-flex justify-content-between mb-4 text-white">
                            <h6 class="text-white">Sub Total</h6>
                            {{ subtotal }}
                        </div>
                        <div class="d-flex justify-content-between mb-4 text-white">
                            <h6 class="text-white">Adjustment</h6>
                            {{adjustment }}
                        </div>
                        <hr class="my-4 text-white">
                        <div class="d-flex justify-content-between mb-4 text-white">
                            <h6 class="text-white">Grand Total</h6>
                            {{invoice.total_amount }}
                        </div>
                        <hr class="my-4 text-white">
                        <div class="d-flex justify-content-between mb-4 text-white">
                            <h6 class="text-white">Paid</h6>
                            {{ invoice.paid }}
                        </div>
                        
                      
                        <div class="d-flex justify-content-between mb-4 text-white">
                            <h6 class="text-white">Balance</h6>
                            {{  balance }}
                        </div>
                        
                        
                        
                      </div>
                    </div>
                  </div>
                  <hr class="mx-3">
                  <div class="row mt-1">
                    <div class="row px-4">
                      <div class="col-md-8">
                        <h5 class="fw-bold" style="border-bottom: 1px solid rgba(128, 128, 128, 0.6); width: fit-content;">Item Details</h5>
                      </div>
                      <div class="col-md-4"></div>
                    </div>
                    <div class="row">
                      {% if items %}
   
                      {% for item in items %}
                      <div class="col-6">
                        <div class="d-flex px-3 justify-content-between text-black mb-2">
                          <h6 class="mb-0">Item</h6>
                          <p class="mb-0 text-right">{{item.itemname }}</p>
                        </div>
                        {% if item.description %}
                        <div class="d-flex px-3 justify-content-between text-black mb-2">
                          <h6 class="mb-0">Description</h6>
                          <p class="mb-0 text-right">{{item.description}}</p>
                        </div>
                        {% endif %}
                        <div class="d-flex px-3 justify-content-between text-black mb-2">
                          <h6 class="mb-0">HSN</h6>
                          <p class="mb-0 text-right">{{item.hsn}}</p>
                        </div>
                        <div class="d-flex px-3 justify-content-between text-black mb-2">
                          <h6 class="mb-0">quantity</h6>
                          <p class="mb-0 text-right">{{item.quantity}}</p>
                        </div>
                        <div class="d-flex px-3 justify-content-between text-black mb-2">
                          <h6 class="mb-0">Amount</h6>
                          <p class="mb-0 text-right">{{item.amount}}</p>
                        </div>
                       
                        <hr class="mx-2">
                      </div>
                      {% endfor %}
                      {% else %}
 
{% endif %}
                    </div>

                  </div>
                </div>

                <div id="est_slip" class=" py-3" style="display: none;" >
                  <div class="slip-container bg-white" id="printslip">
                    <div class="slip text-dark">
                        <h5 class="text-center text-dark" style="font-weight: bold;">{{cmp.company_name}}</h5>
                        <div class="address text-center ">
                            <p> {{details.company.address}}</p>
                            <p>{{details.company.state}}, {{details.company.country}}</p>
                            <p>{{details.company.contact}}</p>
                        </div>

                        <div class="divider"></div>

                        <div class="ml-4 mt-2" style="color: black;">
                            <div class="row">
                                <div class="col-md-6 text-left">Retainer Invoice No:</div>
                                <div class="col-md-5 text-right">{{invoice.retainer_invoice_number}}</div>
                            </div>
                           
                            <div class="row">
                                <div class="col-md-6 text-left">Customer Name:</div>
                                <div class="col-md-5 text-right">{{cust.customerName}} </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6 text-left">Retainer Invoie Date :</div>
                                <div class="col-md-5 text-right">{{invoice.retainer_invoice_date |date:'d-m-Y'}}</div>
                            </div>
                           
                        </div>

                        <div class="divider"></div>

                        <div class="equal-length-container" style="color: black; font-weight: bold;">
                            <div class="equal-length-item" style=" text-align: center;">
                                Item
                                <hr style="border-bottom: 1px solid black; margin-top:1vh; width:95%">
                            </div>
                            <div class="equal-length-item ml-2"  style=" text-align:center;">
                                HSN
                                <hr style="border-bottom: 1px solid black; margin-top:1vh; width:63%; margin-left: 10px;">
                            </div>
                            <div class="equal-length-item"  style=" text-align: center; ">
                                Qty
                                <hr style="border-bottom: 1px solid black; margin-top:1vh; width:60%;  margin-left: 10px;">
                            </div>
                            <div class="equal-length-item"  style=" text-align: center; ">
                                Rate
                                <hr style="border-bottom: 1px solid black; margin-top:1vh; width:65%;  margin-left: 10px;">
                            </div>
                            <div class="equal-length-item"  style=" text-align: center; ">
                              Description
                              <hr style="border-bottom: 1px solid black; margin-top:1vh; width:65%;  margin-left: 10px;">
                          </div>
                            
                            <div class="equal-length-item" style=" text-align: center; ">
                              Amount
                                <hr style="border-bottom: 1px solid black; margin-top:1vh; width:65%;  margin-left: 10px;">
                            </div>
                        </div>
                        {% for j in items %}
                        <div class="equal-length-container" style="color: black; font-size: small; word-wrap: break-word; margin-bottom: 1vh;">
                            <div class="equal-length-item"  style="text-align: center; margin-left: 2px;">
                              {{j.itemname}}
                            </div>
                            <div class="equal-length-item" style="text-align: right;">
                                {{j.hsn}}
                            </div>
                            <div class="equal-length-item" style="text-align: center; ">
                                {{j.quantity}}
                            </div>
                            <div class="equal-length-item" style="text-align: center; ">
                                {{j.rate}}
                            </div>
                            <div class="equal-length-item" id="tax{{ forloop.counter }}">
                                {{ j.description  }}
                            </div>
                            <div class="equal-length-item" style="text-align: center; ">
                                {{j.amount}}
                            </div>
                        </div>
                        {% endfor %}

                        <div class="subtot mt-5">
                            <div class="subtot-item d-flex justify-content-between">
                                <span>Subtotal</span>
                                <span><span>&#8377; </span>{{subtotal}}</span>
                            </div>
                            
                            
                            {% if adjustment != 0 %}
                            <div class="subtot-item d-flex justify-content-between">
                                <span>Adjustment</span>
                                <span><span>&#8377; </span>{{adjustment}}</span>
                            </div>
                            {% endif %}
                        </div>
                        <div class="divider"></div>
                        <div class="grandtot fw-bold d-flex justify-content-between">
                            <span><strong>TOTAL</strong></span>
                            <span><strong><span>&#8377; </span>{{total}}</strong></span>
                        </div>
                        <div class="divider"></div>
                        
                        <div class="createdby d-flex justify-content-between">
                          {% if modified_by_details %}
                              <p class="">Last Edited By:</p>
                              <span>{{ modified_by_details.first_name }} {{ modified_by_details.last_name }}</span>
                          {% elif created_by_details %}
                              <p class="">Created By:</p>
                              <span>{{ created_by_details.first_name }} {{ created_by_details.last_name }}</span>
                          {% endif %}
                      </div>
                      
                        <div class="datetime d-flex justify-content-between">
                            <p class="">Printed On:</p>
                            <span id="dateTimeDisplay"></span>
                        </div>
                        <div class="trns-id d-flex justify-content-between">
                            <span>Transaction ID:</span>
                            <span>XXXXXXXXX</span>
                            <!-- <div>
                                <p class="float-start">
                                    <span>Vendor ID:</span>
                                    <span>XXXXXXXXXX</span>
                                </p>
                            </div> -->
                        </div>
                        <div class="slip-footer mt-4 text-center">
                            <p>Thank you for supporting Local business!</p>
                        </div>
                    </div>
                  </div>
                </div>

                
            
                    <!-- template1 -->
                    <div id="template1" style="display: none;" class="print-only">
                      <div class="page" size="A4" id="selected-area">
                        <div class="p-4">
                          <div  class="tooltip-container ember-view ribbon text-ellipsis">
                            <section>
                              <div class="row py-3 bg-warning align-items-center">
                                <div class="col-3">
                                  {% if invoice.is_sent == False %}
                                  <span class="bg-white text-black px-4 py-2" style="border-radius: 3px;">Draft</span>
                                  {% else %}
                                  <span class="bg-white text-black px-4 py-2" style="border-radius: 3px;">Saved</span>
                                  {% endif %}
                                </div>
                                <div class="col-6">
                                  <h4 class="text-white p-2 fw-bold">RETAINER INVOICE</h4>
                                </div>
                                <div class="col-3">
                                  <span class="fw-bold me-2 h5 text-white float-end">#{{invoice.retainer_invoice_number }}</span>
                                </div>
                              </div>
                            </section>
                            <br>
                            <section class="store-user mt-2">
                              <div class="col-12">
                                <div class="row pb-3">
                                  <div class="col-7">
                                    <p><b class="text-black">From</b>,</p>
                                    <div style="margin-left: 10%;">
                                      <h3>{{company.company_name  }}</h3>
                                      <p class="text-black"> 
                                        {{ company.contact }} <br>
                                        {{ company.address }} <br>
                                        {{ company.city }} <br>
                                        {{ company.state|slice:'5:' }},
                                        {{ company.country }} <br>
                                        {{ company.pincode }}
                                      </p>
                                    </div>
                                  </div>
                                  <div class="col-5">
                                    <p><b class="text-black">To</b>,</p>
                                    <div style="margin-left: 10%;">
                                      <h3>{{ customer_name }}</h3>
                                      <p class="text-black"> 
                                        {{ billing_address|linebreaksbr }}
                                      </p>
                                    </div>
                                  </div>
                                </div>
                                <hr class="mx-3">
                                <div class="row extra-info pb-3 text-black fw-bold">
                                  <div class="col-6">
                                      <p>Retainer Invoice Date: <span>{{invoice.retainer_invoice_date | date:'d-m-Y'}}</span></p>
                                  </div>
                                  <div class="col-6">
                                      

                                  

                                      <p>Payment Method : {% if ret_payments.payment_opt %}<span>{{ ret_payments.payment_opt}}</span>{% endif %}</p>
                                  </div>
                                </div>
                                <hr class="mx-3">
                              </div>
                            </section>
    
                            <section class="table-responsive mt-4">
                              <table class=" table table-hover table-bordered border-dark" id="templateTable1">
                                <thead class="bg-warning">
                                  <tr class="text-center text-black" style="font-weight: bold;">
                                    <td>Items</td>
                                    <td>HSN</td>
                                    <td>Rate</td>
                                    <td>Quantity</td>
                                    <td>Description</td>            
                                    <td>Total</td>
                                  </tr>
                                </thead>
                                <tbody>
                                  {% for i in items %}
                                  <tr class="text-black text-center">
                                    <td style="color:black; text-align: center;">{{i.itemname}}</td>
                                    <td style="color:black">{{i.hsn}}</td>
                                    <td style="color:black">{{i.rate}}</td>
                                    <td style="color:black">{{i.quantity}}</td>
                                    
                                    <td style="color:black">{{i.description}} </td>
                                    <td style="color:black">{{i.amount}}</td>
                                  </tr>
                                  {%endfor%}
                                </tbody>
                              </table>
                            </section>

                            <section class="balance-info">
                              <div class="row">
                                  <div class="col-md-7"></div>
                                  <div class="col-md-5">
                                      <table class="table table-borderless">
                                          <tbody>
                                              <tr >
                                                  <td style="color: #000;">Sub Total</td>
                                                  <td style="color: #000;">:</td>
                                                  <td class="text-right" style="color: #000;">{{subtotal}}</td>
                                              </tr>
                                              
                                              
                                              
                                             
                                              
                                          </tbody>
      
                                      </table>
                                      <hr style="background-color: #000000;">
                                      <table class="table table-borderless">
                                          <tbody>
                                              <tr >
                                                  <th style="color: #000;">Grand Total</th>
                                                  <th style="color: #000;">:</th>
                                                  <th class="text-right" style="color: #000;">{{total}} /-</th>
                                              </tr>
                                          </tbody>
                                      </table>
                                  </div>
                              </div>
                          </section>

                          </div>
                        </div>
                      </div>
                      <div id="templateToggle" class="templateToggleSegment mt-3 mb-0 w-100 d-flex justify-content-center">
                        <button id="toggleTemplate1" onclick="template_function()" class="btn btn-outline-warning btn-sm m-2 active templateToggleButtons">1</button>
                        <button id="toggleTemplate2" onclick="show_template2()" class="btn btn-outline-warning btn-sm m-2 templateToggleButtons">2</button>
                        <button id="toggleTemplate3" onclick="show_template3()" class="btn btn-outline-warning btn-sm m-2 templateToggleButtons">3</button>
                      </div>
                    </div>

                    <!-- template2 -->
                    <div id="template2"   style="display: none;">
                      <div class="page" size="A4" id="selected-area2">
                        <div class="p-4">
                          <div  class="tooltip-container ember-view ribbon text-ellipsis">
                            <section>
                              <div class="row py-3 align-items-center">
                                <div class="col-3">
                                  <span class="bg-warning text-black px-4 py-2" style="border-radius: 3px;">{{invoice.status}}</span>
                                </div>
                                <div class="col-6">
                                  <h4 class="text-black p-2 fw-bold">RETAINER INVOICE</h4>
                                </div>
                                <div class="col-3">
                                  <span class="fw-bold me-2 h5 text-black float-end"><span class="fw-normal">Ret. Invoice No.</span><br>#{{invoice.retainer_invoice_number}}</span>
                                </div>
                              </div>
                            </section>
                            <hr>
                            <section class="store-user mt-2">
                              <div class="col-12">
                                <div class="row pb-3">
                                  <div class="col-7">
                                    <p class="bg-warning" style="border-top-right-radius: 4vh; border-bottom-right-radius: 4vh; width: fit-content; padding: 5px 60px 5px 10px;"><b class="text-black">COMPANY ADDRESS</b>,</p>
                                    <div style="margin-left: 10%;">
                                      <h3>{{ company.company_name }}</h3>
                                      <p class="text-black"> 
                                        {{company.contact }} <br>
                                        {{ company.address }} <br>
                                        {{ company.city }} <br>
                                        {{ company.state|slice:'5:' }},
                                        {{ company.country }} <br>
                                        {{ company.pincode }}
                                      </p>
                                    </div>
                                  </div>
                                  <div class="col-5">
                                    <p class="bg-warning" style="border-top-right-radius: 4vh; border-bottom-right-radius: 4vh; width: fit-content; padding: 5px 60px 5px 10px;"><b class="text-black">BILLING ADDRESS</b>,</p>
                                    <div style="margin-left: 10%;">
                                      <h3>{{ customer_name }}</h3>
                                      <p class="text-black"> 
                                        {{ billing_address|linebreaksbr }}
                                      </p>
                                    </div>
                                  </div>
                                </div>
                                <hr class="mx-3">
                                <div class="row extra-info pb-3 text-black fw-bold">
                                  <div class="col-6">
                                      <p>Rec. Invoice Date: <span>{{invoice.retainer_invoice_date  | date:'d-m-Y'}}</span></p>
                                      
                                  </div>
                                  <div class="col-6">
                                      
                                      <p>Payment Method : {% if ret_payments.payment_opt %}<span>{{ ret_payments.payment_opt}}</span>{% endif %}</p>
                                  </div>
                                </div>
                                <hr class="mx-3">
                              </div>
                            </section>
    
                            <section class="table-responsive mt-4">
                              <table class=" table table-hover table-bordered border-dark" id="templateTable2">
                                <thead class="bg-warning">
                                  <tr class="text-center text-black" style="font-weight: bold;">
                                    <td>Items</td>
                                    <td>HSN</td>
                                    <td>Rate</td>
                                    <td>Quantity</td>
                                   
                                    <td>Description</td>
                                    <td>Amount</td>
                                  </tr>
                                </thead>
                                <tbody>
                                  {% for i in items  %}
                                  <tr class="text-black text-center">
                                    <td style="color:black; text-align: center;">{{i.itemname}}</td>
                                    <td style="color:black">{{i.hsn}}</td>
                                    <td style="color:black">{{i.rate}}</td>
                                    <td style="color:black">{{i.quantity}}</td>
                                    <td style="color:black">{{i.description}} </td>
                                   
                                    <td style="color:black">{{i.amount}}</td>
                                  </tr>
                                  {%endfor%}
                                </tbody>
                              </table>
                            </section>

                            <section class="balance-info">
                              <div class="row">
                                  <div class="col-md-7"></div>
                                  <div class="col-md-5">
                                      <table class="table table-borderless">
                                          <tbody>
                                              <tr >
                                                  <td style="color: #000;">Sub Total</td>
                                                  <td style="color: #000;">:</td>
                                                  <td class="text-right" style="color: #000;">{{subtotal}}</td>
                                              </tr>
                                         
                                          </tbody>
      
                                      </table>
                                      <hr style="background-color: #000000;">
                                      <table class="table table-borderless">
                                          <tbody>
                                              <tr >
                                                  <th style="color: #000;">Grand Total</th>
                                                  <th style="color: #000;">:</th>
                                                  <th class="text-right" style="color: #000;">{{total}} /-</th>
                                              </tr>
                                          </tbody>
                                      </table>
                                  </div>
                              </div>
                          </section>

                          </div>
                        </div>
                      </div>
                      <div id="templateToggle" class="templateToggleSegment mt-3 mb-0 w-100 d-flex justify-content-center">
                        <button id="toggleTemplate1" onclick="template_function()" class="btn btn-outline-warning btn-sm m-2  templateToggleButtons">1</button>
                        <button id="toggleTemplate2" onclick="show_template2()" class="btn btn-outline-warning btn-sm m-2 active templateToggleButtons">2</button>
                        <button id="toggleTemplate3" onclick="show_template3()" class="btn btn-outline-warning btn-sm m-2 templateToggleButtons">3</button>
                      </div>
                    </div>

                    <!-- template3 -->
                    <div id="template3" class=" template3" style="display: none;">
                      <div class="page"  size="A4" id="selected-area3" >
                          <div class="" i>
                              <div class="row">
                                  <div class="col-sm-12 py-3" style="background-image: linear-gradient(#ffae1f, black); color: white;">
                                      <p style="font-size: 4vh; text-align: center;">RETAINER INVOICE</p>
                                      <p style=" text-align: center;"> {{company.company_name}} <br>
                                          {{company.address}} <br>
                                          {{company.city}},
                                          {{company.state}}<br>
                                          {{details.login_details.email}}
                                          <br>
                                      </p>
                                  </div>
                                  
                                  <div class="row col-12">
                                      <!-- <div class="col-md-1"></div> -->
                                      <div class="col-6 py-3 px-5">
                                          <p style="color:black;"> <span style=" font-weight: bold;">To: </span><br>
                                          {{customer_name}} <br>
                                          {{billing_address|linebreaksbr }}
                                          </p>
                                      </div>
                                      <!-- <div class="col-md-1"></div> -->
                                      <div class="col-6 py-3 px-3">
                                          <table class="table table-borderless">
                                              <tbody>
                                                  <tr >
                                                      <td style="color: #000; font-weight: bold;">Retainer Invoice No</td>
                                                      <td style="color: #000;">:</td>
                                                      <td class="text-right" style="color: #000;">{{ invoice.retainer_invoice_number }}</td>
                                                  </tr>
                                                 
                                                  
                                                  
   
                                                  

                                                  <tr>
                                                      <td style="color: #000; font-weight: bold;">Payment Method</td>
                                                      <td style="color: #000;">:</td>
                                                      {% if ret_payments.payment_opt %}
                                                      <td class="text-right" style="color: #000;">{{ret_payments.payment_opt}}</td>
                                                      {% endif %}
                                                  </tr>
                                              </tbody>
          
                                          </table>
                                      </div>
                                  </div>
                                  
                                  <div class="col-md-12 px-4">
                                      <table class="table table-hover table-bordered  template3table" id="table3">
                                          <thead class="bg-warning">
                                              <tr class="template3tablehead">
                                                  <th class="text-center text-black">Items</th>
                                                  <th class="text-center text-black">HSN</th>
                                                  <th class="text-center text-black">Quantity</th>
                                                  <th class="text-center text-black">Rate</th>
                                                  
                                                  <th class="text-center text-black">Description</th>
                                                  <th class="text-center text-black">Amount</th>
                                              </tr>
                                          </thead>
                                          <tbody>
                                              {% for j in items %}
                                                  <tr>
                                                      <td class="text-center" style="color: black;">{{ j.itemname}}</td>
                                                      <td class="text-center" style="color: black;">{{ j.hsn }}</td>
                                                      <td class="text-center" style="color: black;">{{ j.quantity }}</td>
                                                      <td class="text-center" style="color: black;">{{ j.rate }}</td>                
                                                      <td class="text-center" style="color: black;">{{ j.description }}</td>
                                                      <td class="text-center" style="color: black;">{{ j.amount }}</td>
                                                  </tr>
                                              {% endfor %} 
                                          </tbody>
                                      </table>
                                  </div>
                              </div> 
                              <section class="balance-info mb-4">
                                  <div class="row">
                                      <div class="col-md-7"></div>
                                      <div class="col-md-4">
                                          <br>
                                          <table class="table table-borderless">
                                              <tbody>
                                                  <tr >
                                                      <td style="color: #000;">Sub Total</td>
                                                      <td style="color: #000;">:</td>
                                                      <td class="text-right" style="color: #000;">{{subtotal}}</td>
                                                  </tr>
                                                  
                                                  
                                                 
                                                 
                                                  
                                                 
                                                 
                                              </tbody>
          
                                          </table>
                                          <hr style="background-color: #000000;">
                                          <table class="table table-borderless">
                                              <tbody>
                                                  <tr >
                                                      <th style="color: #000;">Grand Total</th>
                                                      <th style="color: #000;">:</th>
                                                      <th class="text-right" style="color: #000;">{{total}}</th>
                                                  </tr>
                                                  <tr >
                                              </tbody>
                                          </table>
                                      </div>
                                  </div>
                              </section> 
                          </div>
                      </div>
                      <div id="templateToggle" class="templateToggleSegment mt-3 mb-0 w-100 d-flex justify-content-center">
                        <button id="toggleTemplate1" onclick="template_function()" class="btn btn-outline-warning btn-sm m-2  templateToggleButtons">1</button>
                        <button id="toggleTemplate2" onclick="show_template2()" class="btn btn-outline-warning btn-sm m-2  templateToggleButtons">2</button>
                        <button id="toggleTemplate3" onclick="show_template3()" class="btn btn-outline-warning btn-sm m-2 active templateToggleButtons">3</button>
                      </div>
                  </div>



                  
                
                
              </div>
            </div>
          </div> 
        </div>
      </div>
    </div>
  </div>
</div>


<!-- Share Email  -->
<div class="modal fade" id="shareToEmail">
  <div class="modal-dialog">
    <div class="modal-content" style="background-color: #3b3b3b;">
      <div class="modal-header">
        <h3 class="modal-title text-light" id="exampleModalLabel">Share Recurring Invoice</h3>
        <button type="button" class="btn close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true" style="font-size: x-large;">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3" style="background-color: #000;">
        <form action="{% url 'shareRetainerInvoiceToEmail' invoice.id %}" method="post" id="share_to_email_form" class="needs-validation" novalidate enctype="multipart/form-data">
          {%csrf_token%}
          <div class="form-group">
              <label for="emailIds">Email IDs</label>
              <textarea class="form-control" name="email_ids" id="emailIds" rows="3" placeholder="Multiple emails can be added by separating with a comma(,)." required></textarea>
          </div>
          <div class="form-group mt-2">
              <label for="item_unitname">Message(optional)</label>
              <textarea name="email_message" id="email_message" class="form-control" cols="" rows="4" placeholder="This message will be sent along with Bill details."></textarea>
          </div>
          <div class="row mt-3">
            <div class="col-md-4"></div>
            <div class="col-md-4">
              <div class="d-flex">
                <button class="btn save_btn btn-outline-warning mt-2 my-4 mx-2 w-50" type="button" id="share_with_email">Save</button> 
                <input class="btn save_btn btn-outline-warning mt-2 my-4 mx-2 w-50" data-dismiss="modal" type="reset" value="Close">
              </div>
            </div>
            <div class="col-md-4"></div>
          </div>
        </form>
      </div>
      <div class="modal-footer"></div>
    </div>
  </div>
</div>

<!-- Add Document  -->
<div class="modal fade" id="bnk_files">
  <div class="modal-dialog">
    <div class="modal-content" style="background-color: #3b3b3b;">
      <div class="modal-header">
        <h3 class="modal-title text-light" id="exampleModalLabel">Add Documents</h3>
        <button type="button" class="btn close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true" style="font-size: x-large;">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3" style="background-color: #000;">
        <form action="{% url 'attachRetainerInvoiceFile' invoice.id %}" method="post" class="needs-validation" novalidate enctype="multipart/form-data">
          {%csrf_token%}
          <div class="row mt-2">
            <div class="col-md-3">
              <label class="pt-2" for="origin" style="color: white;">Add File</label>
            </div>
            <div class="col-md-9">
              <input type="file" class="form-control text-white bg-black" name="file" id="filess">
            </div>
          </div>
          <div class="row mt-3">
            <div class="col-md-4"></div>
            <div class="col-md-4">
              <div class="d-flex">
                <button class="btn save_btn btn-outline-warning mt-2 my-4 mx-2 w-50" type="submit">Save</button> 
                <input class="btn save_btn btn-outline-warning mt-2 my-4 mx-2 w-50" data-dismiss="modal" type="reset" value="Reset">
              </div>
            </div>
            <div class="col-md-4"></div>
          </div>
        </form>
      </div>
      <div class="modal-footer"></div>
    </div>
  </div>
</div>

 <!-- Add Comment  -->
 <div class="modal fade" id="commentsModal">
  <div class="modal-dialog modal-lg">
    <div class="modal-content" style="background-color: #3b3b3b;">
      <div class="modal-header">
        <h3 class="modal-title text-light" id="exampleModalLabel">Add Comments</h3>
        <button type="button" class="btn close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true" style="font-size: x-large;">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3" style="background-color: #000;">
        <form action="{% url 'addRetainerInvoiceComment' retainer_id %}" method="post" class="needs-validation" novalidate enctype="multipart/form-data">
          {%csrf_token%}
          <div class="row mt-2">
            <div class="col-12">
              <textarea type="text" rows="4" class="form-control text-white" name="comment" placeholder="Add Comments.." required></textarea>
              {% if not comments %}
                <span class="my-2 font-weight-bold d-flex justify-content-center">No Comments.!</span>
                {% else %}
                <div class="container-fluid comments-table-container">
                    <table class="table table-borderless mt-4">
                        <thead>
                            <tr>
                                <th class="text-center">sl no.</th>
                                <th class="text-center">Comment</th>
                                <th class="text-center">Delete</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for c in comments %}
                            <tr class="">
                                <td class="text-center">{{forloop.counter }}</td>
                                <td class="text-center">{{c.comment}}</td>
                                <td class="text-center"><a class="text-danger" href="{% url 'deleteRetainerInvoiceComment' c.id %}" onclick="return confirm('Are you sure you want to delete.?')"><i class="fa fa-trash" style="font-size: 1.1rem;"></i></a></td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% endif %}
            </div>
          </div>
          <div class="row mt-3">
            <div class="col-md-4"></div>
            <div class="col-md-4">
              <div class="d-flex">
                <button class="btn save_btn btn-outline-warning mt-2 my-4 mx-2 w-50" type="submit">Save</button> 
                <input class="btn save_btn btn-outline-warning mt-2 my-4 mx-2 w-50" data-dismiss="modal" type="reset" value="Close">
              </div>
            </div>
            <div class="col-md-4"></div>
          </div>
        </form>
      </div>
      <div class="modal-footer"></div>
    </div>
  </div>
</div>
  
  
  <div class="modal fade" id="commentModal2" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"  aria-hidden="true" style="margin-top: 8vh;width: 100%;">
    <div class="modal-dialog modal-xl">
      <div class="modal-content" style="background-color: #3b3b3b;">
        <div class="modal-header">
          <h3 class="modal-title text-light" id="exampleModalLabel">HISTORY</h3>
          <button type="button" class="btn close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true" style="font-size: x-large;">&times;</span>
          </button>
        </div>
        <div class="modal-body">
        <div class="container " >
          <table class="table text-light table-borderless " style="margin:3px; background-color: #000000;width: 100%;">
            <thead>
              <tr>
                <th>
                  sl
                </th>
                <th>
                  Date
                </th>
                <th>
                  Action
                </th>
                <th>
                  By
                </th>
              </tr>
            </thead>
            <tbody>
              {% for i in latest_item_id %}
              <tr>
                <td>{{forloop.counter}}</td>
                <td>{{i.Date}}</td>
                <td>{{i.action}}</td>
                <td>{{ i.logindetails.first_name }}&nbsp;{{ i.logindetails.last_name }}</td>
              </tr>
              {% endfor %}
            </tbody>  
          </table>
        </div>
      </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-warning" data-dismiss="modal">Close</button>
  
        </div>
      </div>
    </div>
  </div>
  </div>
 <!-- History Modal  -->
 <div class="modal fade" id="historyModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"  aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content" style="background-color: #3b3b3b;">
      <div class="modal-header">
        <h3 class="modal-title text-light" id="exampleModalLabel">HISTORY</h3>
        <button type="button" class="btn close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true" style="font-size: x-large;">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3" style="background-color: #000000;">
        <div class="container-fluid history-table-container" >
          <table class="table text-light table-borderless" style="margin:3px; background-color: #000000;width: 100%;">
            <thead>
              <tr>
                <th>#</th>
                <th>Date</th>
                <th>Action</th>
                <th>By</th>
              </tr>
            </thead>
            <tbody>
              {% for entry in history_entries %}
                  <tr>
                      <td>{{ forloop.counter }}</td> <!-- Incremental number -->
                      <td>{{ entry.modified_at }}</td> <!-- Date of the history entry -->
                      <td>{% if entry.created_at == entry.modified_at %}Created{% else %}Modified{% endif %}</td>
 <!-- Action performed -->
 <td>
  {% if entry.created_by %}
      {{ entry.created_by.first_name }} {{ entry.created_by.last_name }}
  {% elif entry.modified_by %}
      {{ entry.modified_by.first_name }} {{ entry.modified_by.last_name }}
  {% endif %}
</td> <!-- Username of the user who performed the action -->
 <!-- Username of the user who performed the action -->
                  </tr>
              {% endfor %}
          </tbody>
          
          </table>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline-warning" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>




<!-- Add Document  -->
<div class="modal fade" id="retainer_files">
  <div class="modal-dialog" style="max-width: 800px;">
      <div class="modal-content" style="background-color: #3b3b3b;">
          <div class="modal-header">
              <h3 class="modal-title text-light" id="exampleModalLabel">Add Documents</h3>
              <button type="button" class="btn close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true" style="font-size: x-large;">&times;</span>
              </button>
          </div>
          <div class="modal-body mx-3" style="background-color: #000;">
              <form action="{% url 'attachRetainerInvoiceFile' invoice.id %}" method="post" class="needs-validation" novalidate enctype="multipart/form-data">
                  {% csrf_token %}
                  <div class="row mt-2">
                      <div class="col-md-3">
                          <label class="pt-2" for="origin" style="color: white;">Add File</label>
                      </div>
                      <div class="col-md-9">
                          <input type="file" class="form-control text-white bg-black" name="file" id="filess">
                      </div>
                  </div>
                  <div class="row mt-3">
                      <div class="col-md-4"></div>
                      <div class="col-md-4">
                          <div class="d-flex">
                              <button class="btn save_btn btn-outline-warning mt-2 my-4 mx-2 w-50" type="submit">Save</button>
                              <input class="btn save_btn btn-outline-warning mt-2 my-4 mx-2 w-50" data-dismiss="modal" type="reset" value="Reset">
                          </div>
                      </div>
                      <div class="col-md-4"></div>
                  </div>
              </form>
          </div>
          <div class="modal-footer"></div>
      </div>
  </div>
</div>
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>


<script>
  $('#share_with_email').on('click',function(){
    var emailsInput = document.getElementById('emailIds');
    var emailsString = emailsInput.value.trim();

    var emails = emailsString.split(',').map(function(email) {
        return email.trim();
    });

    var emailRegex = /^[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\.[a-zA-Z0-9-.]+$/;

    var invalidEmails = []
    if(emailsString == ""){
        alert('Enter valid email addresses..')
    }
    else{
        for (var i = 0; i < emails.length; i++) {
            var currentEmail = emails[i];

            if (currentEmail!="" && !emailRegex.test(currentEmail)) {
                console.log(currentEmail + ' is invalid!');
                invalidEmails.push(currentEmail)
            }
        }
        
        if(invalidEmails.length > 0){
            alert('Invalid emails..Please check!\n'+invalidEmails)
            // alert(invalidEmails)
        }else{
            $('#share_to_email_form').submit();
        }
    }
})
  function updateDateTime() {
    var currentDate = new Date();
    var day = currentDate.getDate();
    var month = currentDate.getMonth() + 1;
    var year = currentDate.getFullYear();
    var hours = currentDate.getHours();
    var minutes = currentDate.getMinutes();
    var seconds = currentDate.getSeconds();
    var formattedDay = (day < 10) ? `0${day}` : day;
    var formattedMonth = (month < 10) ? `0${month}` : month;
    var formattedHours = (hours < 10) ? `0${hours}` : hours;
    var formattedMinutes = (minutes < 10) ? `0${minutes}` : minutes;
    var formattedSeconds = (seconds < 10) ? `0${seconds}` : seconds;
    var formattedDateTime = `${formattedDay}/${formattedMonth}/${year} ${formattedHours}:${formattedMinutes}:${formattedSeconds}`;
    document.getElementById('dateTimeDisplay').textContent = formattedDateTime;
  }

  updateDateTime();
  setInterval(updateDateTime, 1000);

  $(document).ready(function() {
    var $rows = $('#sidetable tbody tr');
    $('#search').keyup(function() {
      var val = $.trim($(this).val()).replace(/ +/g, ' ').toLowerCase();
      $rows.show().filter(function() {
        var text = $(this).text().replace(/\s+/g, ' ').toLowerCase();
        return !~text.indexOf(val);
      }).hide();
    });
  });
  $('.dropdown-toggle').dropdown();

 function sortTable(col) {
    var table = document.getElementById('sidetable');
    var tbody = table.querySelector('tbody');
    var rows = Array.from(tbody.querySelectorAll('tr'));
    if (col == 1){
      rows.sort(function(a, b) {
          var balanceA = parseFloat(a.querySelector('.amt').innerText.replace(/[^\d.-]/g, ''));
          var balanceB = parseFloat(b.querySelector('.amt').innerText.replace(/[^\d.-]/g, ''));
          return balanceA - balanceB;
      });
    }else{
      rows.sort(function(a, b) {
          var nameA = a.querySelector('.name').innerText.toLowerCase();
          var nameB = b.querySelector('.name').innerText.toLowerCase();
          return nameA.localeCompare(nameB);
      });
    }
    tbody.innerHTML = '';
    rows.forEach(function(row) {
      tbody.appendChild(row);
    });
  }

  function filterTable(key) {
    var rows = document.querySelectorAll('#sidetable tbody tr');
    rows.forEach(function(row) {
        var cell = row.querySelector('.stat');
        var status = cell.innerText.trim();
        if (key === 'All' || status === key) {
            row.style.display = '';
        } else {
            row.style.display = 'none';
        }
    });
  }

  $('#alert_close').click(function(){
    $('#alert_danger').hide()
  })

  jQuery(document).ready(function($){
    $(".clickable-row").click(function (){
      window.location = $(this).data("href")
    });
  });

  $(document).ready(function() {
    var $rows = $('#table tbody tr');
    $('#search').keyup(function() {
      var val = $.trim($(this).val()).replace(/ +/g, ' ').toLowerCase();
      $rows.show().filter(function() {
        var text = $(this).text().replace(/\s+/g, ' ').toLowerCase();
        return !~text.indexOf(val);
      }).hide();
    });
  });

  $(document).ready(function () {
    $("#fileSave").click(function () {
      var formData = new FormData();
      formData.append('id', $("#file_id").val());
      formData.append('file', $("#filess")[0].files[0]); 
      formData.append('csrfmiddlewaretoken', '{{ csrf_token }}');

      $.ajax({
        type: 'POST',
        url: "",
        data: formData,
        processData: false,
        contentType: false,
        success: function (response) {
          document.getElementById("modalAddfile").reset();
          location.reload();
        },
      });
    });
  });

  // function changeTab(tab) {
  //   if (tab === "Overview") {
  //     document.getElementById('Overview').style.display = "block"; 
  //     document.getElementById('overview_btn').style.backgroundColor = "#ffae1f";    
  //     document.getElementById('overview_btn').style.color = "black";    
  //     document.getElementById('overview_btn').style.fontWeight = 'bold';    
  //     document.getElementById('overview_icon').style.fontWeight = 'bold';
  //     document.getElementById('Slip').style.display = "none"; 
  //     document.getElementById('slip_btn').style.backgroundColor = "black";    
  //     document.getElementById('slip_btn').style.color = "#ffae1f";    
  //     document.getElementById('slip_btn').style.fontWeight = 'lighter';
  //     document.getElementById('slip_icon').style.fontWeight = 'lighter';
  //     document.getElementById('Templates').style.display = "none"; 
  //     document.getElementById('templates_btn').style.backgroundColor = "black";    
  //     document.getElementById('templates_btn').style.color = "#ffae1f";    
  //     document.getElementById('templates_btn').style.fontWeight = 'lighter';
  //     document.getElementById('templates_icon').style.fontWeight = 'lighter';
  //     $('#convert_btn').show();
  //     $('#pdf_btn').hide();
  //     $('#print_btn').hide();
  //     $('#slipPdf_btn').hide();
  //     $('#slipPrint_btn').hide();
  //     $('#edit_btn').show();
  //     $('#delete_btn').show();
  //     $('#share_btn').hide();
  //     $('#attach_btn').show();
  //     document.getElementById('over').style.display = 'block'
  //     document.getElementById('slp').style.display = 'none'
  //     document.getElementById('tmplt').style.display = 'none'

  //   } else if (tab === "Slip") {
  //     document.getElementById('Overview').style.display = "none"; 
  //     document.getElementById('overview_btn').style.backgroundColor = "black";    
  //     document.getElementById('overview_btn').style.color = "#ffae1f";  
  //     document.getElementById('overview_btn').style.fontWeight = 'lighter';    
  //     document.getElementById('overview_icon').style.fontWeight = 'lighter';
  //     document.getElementById('Slip').style.display = "block"; 
  //     document.getElementById('slip_btn').style.backgroundColor = "#ffae1f";    
  //     document.getElementById('slip_btn').style.color = "black";    
  //     document.getElementById('slip_btn').style.fontWeight = 'bold';
  //     document.getElementById('slip_icon').style.fontWeight = 'bold';
  //     document.getElementById('Templates').style.display = "none"; 
  //     document.getElementById('templates_btn').style.backgroundColor = "black";    
  //     document.getElementById('templates_btn').style.color = "#ffae1f";    
  //     document.getElementById('templates_btn').style.fontWeight = 'lighter';    
  //     document.getElementById('templates_icon').style.fontWeight = 'lighter';
  //     $('#convert_btn').hide();
  //     $('#pdf_btn').hide();
  //     $('#slipPdf_btn').show();
  //     $('#slipPrint_btn').show();
  //     $('#print_btn').hide();
  //     $('#edit_btn').hide();
  //     $('#delete_btn').hide();
  //     $('#share_btn').hide();
  //     $('#attach_btn').hide();

  //     // $("#print_btn").attr("onclick","printSection('Slip')");
  //     document.getElementById('over').style.display = 'none'
  //     document.getElementById('slp').style.display = 'block'
  //     document.getElementById('tmplt').style.display = 'none'
  //   } else {
  //     document.getElementById('Overview').style.display = "none"; 
  //     document.getElementById('overview_btn').style.backgroundColor = "black";    
  //     document.getElementById('overview_btn').style.color = "#ffae1f";  
  //     document.getElementById('overview_btn').style.fontWeight = 'lighter';    
  //     document.getElementById('overview_icon').style.fontWeight = 'lighter';
  //     document.getElementById('Templates').style.display = "block"; 
  //     document.getElementById('Slip').style.display = "none"; 
  //     document.getElementById('slip_btn').style.backgroundColor = "black";    
  //     document.getElementById('slip_btn').style.color = "#ffae1f";    
  //     document.getElementById('slip_btn').style.fontWeight = 'lighter';
  //     document.getElementById('slip_icon').style.fontWeight = 'lighter';
  //     document.getElementById('templates_btn').style.backgroundColor = "#ffae1f";    
  //     document.getElementById('templates_btn').style.color = "black";    
  //     document.getElementById('templates_btn').style.fontWeight = 'bold';    
  //     document.getElementById('templates_icon').style.fontWeight = 'bold';
  //     $('#convert_btn').hide();
  //     $('#pdf_btn').show();
  //     $('#print_btn').show();
  //     $('#edit_btn').hide();
  //     $('#delete_btn').hide();
  //     $('#share_btn').show();
  //     $('#attach_btn').hide();
  //     $('#slipPdf_btn').hide();
  //     $('#slipPrint_btn').hide();

  //     // $("#print_btn").attr("onclick","printSection('whatToPrint')");
  //     document.getElementById('over').style.display = 'none'
  //     document.getElementById('slp').style.display = 'none'
  //     document.getElementById('tmplt').style.display = 'block'
  //   }
  // }
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>

<script>
  // function export_as_pdf() {
  //   const content = document.getElementById('Templates');
  //   html2pdf().from(content).save('{{invoice.bnk_name }}.pdf');
  // }

//   function slipPdf(){
//     var recInvNo = `{{invoice.rec_invoice_no }}`;
//     var element = document.getElementById('slip_container');
//     var opt =
//     {
//         margin: 1,
//         filename: 'RecurringInvoice_slip_'+ recInvNo + '.pdf',
//         image: { type: 'jpeg', quality: 0.98 },
//         html2canvas: { scale: 2 },
//         jsPDF: { unit: 'in', format: 'a4', orientation: 'portrait' }
//     };
//     html2pdf().set(opt).from(element).save();
// }

// function printSection(sectionId) {
//     // document.body.style.backgroundColor = 'white';
//     var printContents = document.getElementById(sectionId).innerHTML;
//     console.log(printContents)
//     var originalContents = document.body.innerHTML;
//     var $printerDiv = $('<div class="printContainer"></div>');

//     $printerDiv.html(printContents); 
//     $('body').append($printerDiv).addClass("printingContent"); 
//     window.print(); 
//     $printerDiv.remove();
//     $('body').removeClass("printingContent");
// }


// function slipPrint(){
//       var divToPrint=document.getElementById("Slip");
//       var printWindow = window.open('', '', 'height=700,width=1000');
//       var styles = `
//       .slip h5{
//           font-family: serif;
//       }
//       p {
//           font-size: 1.2em;
//       }
//       .address{
//           display: flex;
//           flex-direction: column;
//       }
//       .address p,.slip-footer p{
//           font-size: 1rem;
//           margin: 0;
//       }
//       .slip-container{
//           width: 105mm;
//           margin: 2rem auto;
//           padding: 2rem;
//           border: 1px dotted black;
//           box-shadow: rgba(60, 64, 67, 0.5) 0px 1px 2px 0px, rgba(60, 64, 67, 0.35) 0px 2px 6px 2px;
//       }
//       .divider{
//           margin: 1rem 0;
//           border-bottom: 3px dotted black;
//       }
//       .trns-id p,.datetime p, .createdby p{
//           font-size: 0.85rem;
//           margin: 0;
//       }
//       .equal-length-container {
//           display: flex;
//           align-items: center;
//           justify-content: space-between;
          
//           margin-left: 2vh;
//           margin-right: 2vh;
//       }

//       .equal-length-item {
//           flex: 1;
//           text-align: center;
//       }

//       `
//       printWindow.document.write('<html><head><title></title>');
//       // printWindow.document.write('</style>');
//       printWindow.document.write(`<link rel="stylesheet" href="{% static 'assets/css/styles.min.css' %}" />`)
//       printWindow.document.write('</head>');
//       printWindow.document.write('<body>');
//       printWindow.document.write('<style>')
//       printWindow.document.write(styles)
//       printWindow.document.write('</style>')


//       // printWindow.document.write("<center>header</center>");
//       printWindow.document.write(divToPrint.outerHTML);
//       printWindow.document.write('</body>');
//       printWindow.document.write('</html>');
//       printWindow.document.close();
//       printWindow.print();
//       printWindow.addEventListener('afterprint', function() {
//         printWindow.close();
//       });
//     }

//     function toggleTemplate(templateId,buttonId){
//       $('.printTemplates').css('display','none');
//       $('#'+templateId).css('display','block');
//       $('.templateToggleButtons').removeClass('active');
//       $('#'+buttonId).addClass('active');
//       $("#templatePrintButton").attr("onclick","printSection('"+templateId+"')");
//       document.getElementById('body_wrapper').scrollIntoView();
//     }

var rdx = 1;
    function overview_function() {
      rdx = 1;
// Show overview buttons
document.getElementById("overview_buttons").style.display = "block";
    // Hide other button sets
    document.getElementById("template_buttons").style.display = "none";
    document.getElementById("slip_buttons").style.display = "none";

      document.getElementById("template2").style.display = "none"; // Hides template2
    document.getElementById("Overview").style.display = "block";
    document.getElementById("template3").style.display = "none";
    document.getElementById("est_slip").style.display = "none";
    // Show template1
    document.getElementById("template1").style.display = "none";

    }
    $(document).ready(function(){
    $("#overviewBtn").click(function(){
        // Hide other templates if they are visible
        $("#template2").hide(); // Hides template2
        $("#template3").hide(); // Hides template2
        $("#template1").hide(); 
        $("#est_slip").hide(); 
        // Show template1
        $("#Overview").show();


        $("#overview_buttons").show();
        // Hide other button sets
        $("#template_buttons").hide();
        $("#slip_buttons").hide();
    });
});
    function template_function() {
      rdx = 1;

      document.getElementById("overview_buttons").style.display = "none";
    // Hide other button sets
    document.getElementById("template_buttons").style.display = "block";
    document.getElementById("slip_buttons").style.display = "none";

    // Hide other templates if they are visible
    document.getElementById("template2").style.display = "none"; // Hides template2
    document.getElementById("Overview").style.display = "none";
    document.getElementById("template3").style.display = "none";
    document.getElementById("est_slip").style.display = "none";
    // Show template1
    document.getElementById("template1").style.display = "block";
}
$(document).ready(function(){
    $("#attachmentDropdown").click(function(){
        // Hide other templates if they are visible
        $("#template2").hide(); // Hides template2
        $("#template3").hide(); // Hides template2
        $("#Overview").hide();
        $("#est_slip").hide(); 
        // Show template1
        $("#template1").show();

        $("#overview_buttons").hide();
        // Hide other button sets
        $("#template_buttons").show();
        $("#slip_buttons").hide();
    });
});
    function show_template2() {
      rdx = 2;
    document.getElementById("overview_buttons").style.display = "none";
    // Hide other button sets
    document.getElementById("template_buttons").style.display = "block";
    document.getElementById("slip_buttons").style.display = "none";

    document.getElementById("template1").style.display = "none"; // Hides template2
    document.getElementById("Overview").style.display = "none";
    document.getElementById("template3").style.display = "none";
    document.getElementById("est_slip").style.display = "none";
    // Show template1
    document.getElementById("template2").style.display = "block";

    }
    $(document).ready(function(){
    $("#attachmentDropdown").click(function(){
        // Hide other templates if they are visible
        $("#template1").hide(); // Hides template2
        $("#template3").hide(); // Hides template2
        $("#Overview").hide();
        $("#est_slip").hide(); 
        // Show template1
        $("#template2").show();


        $("#overview_buttons").hide();
        // Hide other button sets
        $("#template_buttons").show();
        $("#slip_buttons").hide();
    });
});
    function show_template3() {
      rdx = 3;
    document.getElementById("overview_buttons").style.display = "none";
    // Hide other button sets
    document.getElementById("template_buttons").style.display = "block";
    document.getElementById("slip_buttons").style.display = "none";

    document.getElementById("template2").style.display = "none"; // Hides template2
    document.getElementById("Overview").style.display = "none";
    document.getElementById("template3").style.display = "none";
    document.getElementById("est_slip").style.display = "none";
    // Show template1
    document.getElementById("template3").style.display = "block";

    }
    $(document).ready(function(){
    $("#attachmentDropdown").click(function(){
        // Hide other templates if they are visible
        $("#template2").hide(); // Hides template2
        $("#template3").hide(); // Hides template2
        $("#Overview").hide();
        $("#est_slip").hide(); 
        // Show template1
        $("#template3").show();

        $("#overview_buttons").hide();
        // Hide other button sets
        $("#template_buttons").show();
        $("#slip_buttons").hide();
    });
});
    function show_slip() {
      rdx = 4;

    document.getElementById("overview_buttons").style.display = "none";
    // Hide other button sets
    document.getElementById("template_buttons").style.display = "none";
    document.getElementById("slip_buttons").style.display = "block";


    document.getElementById("template2").style.display = "none"; // Hides template2
    document.getElementById("Overview").style.display = "none";
    document.getElementById("template3").style.display = "none";
    document.getElementById("template1").style.display = "none";
    // Show template1
    document.getElementById("est_slip").style.display = "block";
    }
  
    $(document).ready(function(){
    $("#slipBtn").click(function(){
        // Hide other templates if they are visible
        $("#template2").hide(); // Hides template2
        $("#template3").hide(); // Hides template2
        $("#Overview").hide();
        $("#template1").hide(); 
        // Show template1
        $("#est_slip").show();


        $("#overview_buttons").hide();
        // Hide other button sets
        $("#template_buttons").hide();
        $("#slip_buttons").show();
    });
});


</script>

<script>
   function getCookie(name) {
    var cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        var cookies = document.cookie.split(';');
        for (var i = 0; i < cookies.length; i++) {
            var cookie = cookies[i].trim();
            // Check if this cookie name is the one we are looking for
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

 $(document).ready(function() {
    $("#shareToEmail").on("click", "#share_with_email", function() {
        console.log("Save button clicked");
        var emailIds = $("#emailIds").val();
        var emailMessage = $("#email_message").val();
        var formData = new FormData();
        formData.append("email_ids", emailIds);
        formData.append("email_message", emailMessage);
        $.ajax({
            url: "{% url 'shareRetainerInvoiceToEmail' invoice.id %}",
            method: "POST",
            headers: { "X-CSRFToken": getCookie("csrftoken") }, // Include CSRF token
            data: formData,
            processData: false,
            contentType: false,
            success: function(response) {
                // Handle success response, such as showing a success message
                alert("Email sent successfully!");
                $("#shareToEmail").modal("hide");
            },
            error: function(xhr, status, error) {
                // Handle error response, such as showing an error message
                console.error(error);
                alert("Failed to send email. Please try again later.");
            }
        });
    });
});
p = rdx;
    function printSelectedArea(p) {

      console.log("Printing area: " + p);
        if (p === 1) {
            var printContents = document.getElementById("selected-area").innerHTML;
            document.getElementById("selected-area").style.backgroundColor = "white"
            var $printerDiv = $('<div class="printContainer bg-white style="display:block !important;"></div>'); // create the div that will contain the stuff to be printed
            $printerDiv.html(printContents); // add the content to be printed
            $('body').append($printerDiv).addClass("printingContent"); // add the div to body, and make the body aware of printing (we apply a set of css styles to the body to hide its contents)

            window.print(); // call print
            $printerDiv.remove(); // remove the div
            $('body').removeClass("printingContent");
        } if (p === 2) {
            var printContents = document.getElementById("selected-area2").innerHTML;
            document.getElementById("selected-area2").style.backgroundColor = "white"
            var $printerDiv = $('<div class="printContainer bg-white style="display:block !important;"></div>'); // create the div that will contain the stuff to be printed
            $printerDiv.html(printContents); // add the content to be printed
            $('body').append($printerDiv).addClass("printingContent"); // add the div to body, and make the body aware of printing (we apply a set of css styles to the body to hide its contents)

            window.print(); // call print
            $printerDiv.remove(); // remove the div
            $('body').removeClass("printingContent");
        } if (p === 3) {
            var printContents = document.getElementById("selected-area3").innerHTML;
            document.getElementById("selected-area3").style.backgroundColor = "white"
            var $printerDiv = $('<div class="printContainer bg-white style="display:block !important;"></div>'); // create the div that will contain the stuff to be printed
            $printerDiv.html(printContents); // add the content to be printed
            $('body').append($printerDiv).addClass("printingContent"); // add the div to body, and make the body aware of printing (we apply a set of css styles to the body to hide its contents)

            window.print(); // call print
            $printerDiv.remove(); // remove the div
            $('body').removeClass("printingContent");
        } if (p === 4) {
            var printContents = document.getElementById("printslip").innerHTML;
            document.getElementById("printslip").style.backgroundColor = "white"
            var $printerDiv = $('<div class="printContainer bg-white style="display:block !important;"></div>'); // create the div that will contain the stuff to be printed
            $printerDiv.html(printContents); // add the content to be printed
            $('body').append($printerDiv).addClass("printingContent"); // add the div to body, and make the body aware of printing (we apply a set of css styles to the body to hide its contents)

            window.print(); // call print
            $printerDiv.remove(); // remove the div
            $('body').removeClass("printingContent");
        }
    }

    // Get the button element
    var printButton = document.getElementById("print-button");

    // Add an event listener to the button for the click event
    printButton.addEventListener("click", function () {
      console.log("Print button clicked");
        printSelectedArea(rdx); // Call the printSelectedArea function on button click
    });

    var printslipButton = document.getElementById("printslip-button");

// Add an event listener to the button for the click event
printslipButton.addEventListener("click", function () {
  console.log("Print button clicked");
    printSelectedArea(rdx); // Call the printSelectedArea function on button click
});

function exportToPDF(p) {
  console.log("Exporting to PDF. p =", p);
        if (p === 1) {
            var content = document.getElementById('selected-area');
            html2pdf()
                .from(content)
                .save('Retainer_invoice.pdf')
        }
        if (p === 2) {
            var content = document.getElementById('selected-area2');
            html2pdf()
                .from(content)
                .save('Retainer_invoice.pdf')
        }
        if (p === 3) {
            var content = document.getElementById('selected-area3');
            html2pdf()
                .from(content)
                .save('Retainer_invoice.pdf')
        }
        if (p === 4) {
            var content = document.getElementById('printslip');
            html2pdf()
                .from(content)
                .save('Retainer_invoice.pdf')
        }
    }

    var pdftButton = document.getElementById("pdf-button");

    // Add an event listener to the button for the click event
    pdftButton.addEventListener("click", function () {
      
        exportToPDF(rdx); // Call the printSelectedArea function on button click
    });

    var pdftButtonSlip = document.getElementById("pdfslip-button");

// Add an event listener to the button for the click event
pdftButtonSlip.addEventListener("click", function () {
    exportToPDF(rdx); // Call the exportToPDF function with the correct parameter
});
    function convertToSaved(invoiceId) {
  if (confirm('Do you want to convert this Draft to Saved?')) {
    // Assuming you have a URL named 'convertRecurringInvoice'
    window.location.href = "{% url 'convertRetainerInvoice' 999 %}".replace('999', invoiceId);

  }
}

$(document).ready(function(){
    $('#history_btn').on('click', function() {
        var retainerId = $(this).data('retainer-id');
        $.ajax({
          url: '/retainer/' + retainerId + '/history/',
            type: 'GET',
            success: function(data) {
                // Update the modal content with history data
                $('#historyModal .modal-body').html(
                    '<p>Created By: ' + data.history.created_by + '</p>' +
                    '<p>Created At: ' + data.history.created_at + '</p>' +
                    '<p>Modified By: ' + data.history.modified_by + '</p>' +
                    '<p>Modified At: ' + data.history.modified_at + '</p>'
                );
            },
            error: function(xhr, status, error) {
                // Handle error
            }
        });
    });
});


$(document).ready(function() {
    // Add click event listener to table rows
    $('.clickable').click(function() {
        // Extract the ID of the clicked invoice
        var invoiceId = $(this).attr('id');

        // Redirect the user to the detailed view page of the clicked invoice
        window.location.href = "{% url 'retaineroverview' pk=invoice.id %}";

    });
});

function sortTable() {
        var table, rows, switching, i, x, y, shouldSwitch;
        table = document.getElementById("table2");
        switching = true;
        /* Make a loop that will continue until no switching has been done: */
        while (switching) {
            // Start by saying: no switching is done:
            switching = false;
            rows = table.rows;
            /* Loop through all table rows (except the first, which contains table headers): */
            for (i = 1; i < (rows.length - 1); i++) {
                // Start by saying there should be no switching:
                shouldSwitch = false;
                /* Get the two elements you want to compare, one from current row and one from the next: */
                x = rows[i].getElementsByTagName("TD")[0];
                y = rows[i + 1].getElementsByTagName("TD")[0];
                // Check if the two rows should switch place:
                if (x.innerHTML.toLowerCase() > y.innerHTML.toLowerCase()) {
                    // If so, mark as a switch and break the loop:
                    shouldSwitch = true;
                    break;
                }
            }
            if (shouldSwitch) {
                /* If a switch has been marked, make the switch and mark that a switch has been done: */
                rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
                switching = true;
            }
        }
    }

    function sortTablebybillno() {
        var table, rows, switching, i, x, y, shouldSwitch;
        table = document.getElementById("table2");
        switching = true;
        /* Make a loop that will continue until no switching has been done: */
        while (switching) {
            // Start by saying: no switching is done:
            switching = false;
            rows = table.rows;
            /* Loop through all table rows (except the first, which contains table headers): */
            for (i = 1; i < (rows.length - 1); i++) {
                // Start by saying there should be no switching:
                shouldSwitch = false;
                /* Get the two elements you want to compare, one from current row and one from the next: */
                x = rows[i].getElementsByTagName("TD")[1];
                y = rows[i + 1].getElementsByTagName("TD")[1];
                // Check if the two rows should switch place:
                if (Number(x.innerHTML) > Number(y.innerHTML)) {
                    // If so, mark as a switch and break the loop:
                    shouldSwitch = true;
                    break;
                }
            }
            if (shouldSwitch) {
                /* If a switch has been marked, make the switch and mark that a switch has been done: */
                rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
                switching = true;
            }
        }
    }


    $(document).ready(function () {
    $("#fileSave").click(function () {
      var formData = new FormData();
      formData.append('id', $("#file_id").val());
      formData.append('file', $("#filess")[0].files[0]); 
      formData.append('csrfmiddlewaretoken', '{{ csrf_token }}');

      $.ajax({
        type: 'POST',
        url: "",
        data: formData,
        processData: false,
        contentType: false,
        success: function (response) {
          document.getElementById("modalAddfile").reset();
          location.reload();
        },
      });
    });
  });
</script>


{%endblock%}
