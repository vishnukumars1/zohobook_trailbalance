{% extends 'base.html' %}
{% block content %}
{% load static %}

<script src="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<!-- <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" /> -->

<style>
  .modal{
    z-index: 9999;
    overflow: scroll;
  }
  .selectize-input {
    background-color: #000 !important;
    color: white !important;
}

.selectize-input input {
    color: white !important;
}

  /* .form-group{
    width: 40%;
  } */

  .row:after {
    content: "";
    display: table;
    clear: both;
  }
  
  @media screen and (max-width: 600px) {
    .col-25, .col-75, input[type=submit] {
      width: 100%;
      margin-top: 0;
    }

    input[type=text], select, textarea {
      width: 100%;
    }
  }

  .dropdown input,
  .dropdown button {
    display: none;
    position: absolute;
    top: 100%;
    left: 0;
  }

  .dropdown.open input,
  .dropdown.open button {
    display: block;
  }

  .row a{
    color: rgb(218, 164, 48);
    font-size: 12px;
  }

  .table th a{
    color:rgb(218, 164, 48);
    font-size: 11px;
    margin-left: 100px;
  }

  ::-webkit-scrollbar {
    display: none;
  }

  ::-webkit-scrollbar-track {
    background: #f1f1f1; 
  }

  ::-webkit-scrollbar-thumb {
    background: #888; 
  }

  ::-webkit-scrollbar-thumb:hover {
    background: #555; 
  }

  .item{
    height: auto;
  }

  .labels{
    color: white; 
    font-size:2.5vh; 
    font-weight: bolder;
  }

  .btn-outline-warning:hover {
    color: black !important;
    font-weight: bold;
  }
  .dropdown-item.customers-options:hover, .dropdown-item.items-options:hover{
    background: blue !important;
    cursor: pointer;
  }
</style>
<style>
  label{
      color: white;
  }
  .section-3
  {
      display: flex;
      justify-content: flex-start;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1.5rem;
      margin-top: 1rem;
  }
  .section-3 .section-toggle
  {
      margin-bottom: 0.50rem;
  }
   .section-toggle a
  {

      color: rgb(230, 171, 45);
      font-family: Cambria, Cochin, Georgia, Times, 'Times New Roman', serif;
      font-size:1.275rem;
  }
  .add_another
  {
     
      color: rgb(230, 171, 45);
  }
  #tbl thead th{
      font-size: 0.785rem;
  }
  @media (max-width:700px)
  {
  .section-3
  {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr 1fr ;  

  }
  .section-3 .section-toggle a
  {

      color: rgb(230, 171, 45);
      font-family: Cambria, Cochin, Georgia, Times, 'Times New Roman', serif;
      font-size:0.875rem;
  }
  }
 


  /* Account Modal */

  .select-box1 {
      position: relative;
      width: 100%;
  }
  

  .select-option1 {
      position: relative;
      
  }

  .select-option1 input {
      width: 100%;
      cursor: pointer;
      background-color: white;
      color: black;
      border-radius: 7px;
      padding: 10px 15px;
      border: 0 !important;
      outline: 0 !important;
  }

  .select-option1:after {
      content: "";
      border-top: 12px solid #000;
      border-left: 8px solid transparent;
      border-right: 8px solid transparent;
      position: absolute;
      right: 15px;
      top: 50%;
      margin-top: -8px;

  }

  .content1 {
      background-color: white;
      position: absolute;
      color: black;
      border-radius: 7px;
      margin-top: 15px;
      width: 100%;
      z-index: 999;
      padding: 20px;
      display: none;
  }

  .search1 input {
      width: 100%;
      font-size: 17px;
      padding: 15px;
      outline: 0;
      border: 1px solid #b3b3b3;
      border-radius: 5px;
  }

  .options1 {
      margin-top: 10px;
      max-height: 150px;
      overflow-y: scroll;
      padding: 0;
  }

  /* .options1::-webkit-scrollbar{
      width: 5px;
     
    } */
  .options1 li {
      padding: 10px 15px;
      border-radius: 5px;
      cursor: pointer;
      border-bottom: 1px solid gray;
  }

  .select-box1.active .content1 {
      display: block;
  }

  .select-box1.active .select-option1:after {
      transform: rotate(-180deg);
  }
     
</style>

<div class="body-wrapper">
  <div class="container-fluid">
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{% url 'company_dashboard' %}" class="text-warning-emphasis">Dashboard</a></li>
        <li class="breadcrumb-item"><a class="text-warning-emphasis">Sales</a></li>
        <li class="breadcrumb-item"><a href="" class="text-warning-emphasis">Payment Recieved</a></li>
        <li class="breadcrumb-item" aria-current="page">Edit</li>
      </ol>
    </nav>
<div class="row mt-5">
          <div class="col-md-12 py-3" style="background-color: black; border-radius: 1vh;">
            <div class="card mb-5 px-3 py-4" style="background-color: black; box-shadow: none;">
              <h1 class="mb-0 text-uppercase text-right" style="color: white; font-weight: bolder;">PAYMENT RECIEVED</h1><br>
              <hr class="text-warning">
              <form method="post" action="{% url 'update_payment' thisPayment.id %}" enctype="multipart/form-data" id="paymentRecievedForm" >
                {% csrf_token %}
                <div class="row">
                  <div class="col-md-3">
                    <label for="" class="labels">Customer</label>
                    <br>
                    <span class="text-danger" id="custErr"></span>
                  </div>
                  <div class="col-md-6">
                    <input type="hidden" name="customerId" id="customerId" value="{{thisPayment.customer.id}}">
                    <div class="d-flex">
                        <div class="w-100">
                            <div class="p-0 border-0 bg-none position-relative drop-box">
                                <input required type="text" id="customer" value="{{thisPayment.customer.title}} {{thisPayment.customer.first_name}} {{thisPayment.customer.last_name}}" name="customer" class="dropdown-toggle form-control text-white customers-display" onkeyup="filterCustomers()" data-bs-toggle="dropdown" aria-expanded="false" placeholder="Select Customer.." autocomplete="off">
                                <ul class="dropdown-menu w-100 customers-available position-absolute bg-black text-white" id="cust_drop"  style="overflow-y: auto; height: fit-content;max-height: 40vh; border: 1px solid gray;"> 
                                    <li class="dropdown-item customers-options text-white" onclick="getCustomerDetails('','')">Select Customer</li>
                                    {% for cust in customers %}
                                    <li class="dropdown-item customers-options text-white" onclick="getCustomerDetails(`{{cust.id}}`,this.innerHTML)">{{ cust.title }} {{ cust.first_name }} {{ cust.last_name }}</li>
                                    {% endfor %}
                                </ul>
                                
                            </div>
                        </div>
                        <button type="button" data-toggle="modal" data-target="#newCustomer" class="btn btn-outline-warning py-2 ms-1">+</button>
                    </div>
                  </div>
                </div>

                <div class="row mt-2">
                  <label for="" class="col-md-3 labels">Email</label>
                  <div class="col-md-6">
                    <input type="text" value="{{thisPayment.customer_email}}" class="form-control text-white bg-black" id="customerEmail" name="customer_email" readonly>
                  </div>
                </div>

                <div class="row mt-2">
                  <label for="" class="col-md-3 labels">GST Type</label>
                  <div class="col-md-6">
                    <input type="text" value="{{thisPayment.customer_GSTtype}}" class="form-control text-white bg-black" id="customerGstType" name="customer_gst_type" readonly>
                  </div>
                </div>

                <div class="row mt-2" id="customerGstInDisplay" style="display: flex;">
                  <label for="" class="col-md-3 labels">GSTIN</label>
                  <div class="col-md-6">
                    <input type="text" value="{{thisPayment.customer_GSTnumber}}" class="form-control text-white bg-black" id="customerGSTIN" name="customer_gstin" readonly>
                  </div>
                </div>

                <div class="row mt-2" id="billAddressSection" {% if thisPayment.customer_billingaddress == '' %} style="display: none;"{% endif %}>
                  <label for="" class="col-md-3 labels">Billing Address</label>
                  <div class="col-md-6">
                    <textarea class="form-control text-white bg-black" name="bill_address" id="billAddress" rows="4" readonly>{{thisPayment.customer_billingaddress}}</textarea>
                  </div>
                </div>

                <div class="row mt-2">
                  <label for="" class="col-md-3 labels">Place of Supply</label>
                  <div class="col-md-6">
                    <input hidden value="{{cmp.state}}" id="cmpstate">
                    <select name="place_of_supply" id="placeOfSupply" class="form-control bg-black text-white">
                      <option value="{{thisPayment.customer_place_of_supply}}" selected>{{thisPayment.customer_place_of_supply}}</option>
                      <option value="[AN]-Andaman And Nicobar Islands">[AN]-Andaman And Nicobar Islands</option>
                      <option value="[AD]-Andhra Pradesh">[AD]-Andhra Pradesh</option>
                      <option value="[AR]-Arunachal Pradesh">[AR]-Arunachal Pradesh	</option> 
                      <option value="volvo">[AS]-Assam</option>
                      <option value="[BR]-Bihar">[BR]-Bihar</option> 
                      <option value="volvo">[CH]-	Chandhigarh</option>
                      <option value="[CG]-Chattisgarh">[CG]-Chattisgarh</option>
                      <option value="[DD]-Daman Diu">[DD]-Daman Diu</option>
                      <option value="volvo">[DL]-	Delhi</option>
                      <option value="[GA]-Goa">[GA]-Goa</option> 
                      <option value="[GJ]-Gujarat">[GJ]-Gujarat</option>
                      <option value="[HR]-Haryana">[HR]-Haryana</option> 
                      <option value="[HP]-Himachal Pradesh">[HP]-Himachal Pradesh</option>
                      <option value="[JK]-Jammu And Kashmir">[JK]-Jammu And Kashmir</option>
                      <option value="[JH]-Jharkand">[JH]-Jharkand</option>
                      <option value="[KA]-Karnataka">[KA]-Karnataka</option>
                      <option value="[KL]-Kerala">[KL]-Kerala</option>
                      <option value="[LA]-Ladakh">[LA]-Ladakh</option>
                      <option value="[LD]-Lakshadweep">[LD]-Lakshadweep</option>
                      <option value="[MP]-Madhyapradesh">[MP]-Madhyapradesh</option>
                      <option value="[MH]-Maharashtra">[MH]-Maharashtra</option>
                      <option value="[MN]-Manipur">[MN]-Manipur</option>  
                      <option value="[ML]-Meghalaya">[ML]-Meghalaya</option>
                      <option value="[MZ]-Mizoram">[MZ]-Mizoram</option>
                      <option value="[NL]-Nagaland">[NL]-Nagaland</option> 
                      <option value="[NL]-Nagaland">[NL]-Nagaland</option>
                      <option value="[OD]-Odisha">[OD]-Odisha</option>
                      <option value="[PY]-Puducherry">[PY]-Puducherry</option>
                      <option value="[PB]-Punjab">[PB]-Punjab.</option>
                      <option value="[RL]-Rajasthan">[RL]-Rajasthan</option>
                      <option value="[SK]-Sikkim">[SK]-Sikkim</option>
                      <option value="[TN]-Tamilnadu">[TN]-Tamilnadu</option>
                      <option value="[TS]-Telenghana">[TS]-Telenghana</option>
                      <option value="[TR]-Tripura">[TR]-Tripura</option>
                      <option value="[UP]-Uttar Pradesh">[UP]-Uttar Pradesh</option>
                      <option value="[UK]-Utharakhand">[UK]-Utharakhand</option>
                      <option value="[WB]-West Bengal">[WB]-West Bengal</option>
                      <option value="[OT]-Other Territory">[OT]-Other Territory</option>
                  </select>
                  </div>
                </div>

                <hr>
                
                <div class="row">
                  <div class="col-md-6 mt-2">
                    <div class="row">
                      <div class="col-md-3">
                        <label for="" class="labels" >Payment Recieved No.</label>
                      </div>
                      <div class="col-md-9">
                        <input value="{{thisPayment.payment_number}}" style="text-transform: uppercase;" type="text" class="form-control bg-black text-white" name="paymentRecievedNo"  id="paymentRecievedNo" placeholder="{{nxtPayRecNo}}" required>
                        <span class="ml-1 text-danger" id="PayErr"></span>
                      </div>
                    </div>
                  </div>
                  
  
                  <div class="col-md-6 mt-2">
                    <div class="row">
                      <label for="" class="col-md-3 labels">Reference No.</label>
                      <div class="col-md-9">
                        <input type="text" value="{{thisPayment.reference_number}}" class="form-control bg-black text-white" name="reference_number" value="{{ref_no}}" readonly>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="row">
                  <div class="col-md-6 mt-2">
                    <div class="row">
                      <label for="" class="col-md-3 labels">Payment Date</label>
                      <div class="col-md-9">
                        <input type="date" value="{{thisPayment.payment_date|date:'Y-m-d'}}" class="form-control bg-black text-white" id="startDate" name="start_date" >
                      </div>
                    </div>
                  </div>

                  
                  <div class="col-md-6 mt-2">
                    <div class="row">
                      <label for="" class="col-md-3 labels">Payment Type</label>
                      <div class="col-md-9">
                        <div class="d-flex">
                          <select class="form-control bg-black text-white" onchange="togglePaymentDiv()" name="payType" id="paymentTYPE" required>
                              <option value="{{thisPayment.payment_method}}" selected>{{thisPayment.payment_method}}</option>
                                <option value="Cash">Cash</option>
                                  <option value="Cheque">Cheque</option>
                                  <option value="UPI">UPI</option>
                              {% for i in bank %}
                              <option value="{{i.}}">{{i.}}</option>
                              {% endfor %}
                          </select>
                          <!-- <a class="btn btn-outline-warning ms-1" role="button" data-target="#newPaymentTerm" data-toggle="modal" id="termsadd">+</a> -->
                      </div>
                      </div>
                    </div>
                  </div>

              <div class="col-md-6 mt-2" style="display:none;"  id="chequediv">
                <div class="row" >
                    <label for="" class="col-md-3 labels">Cheque No.</label>
                  <div class="col-md-9">
                    <input type="text" value="{{thisPayment.cheque_number}}" class="form-control bg-black text-white" name="cheque_id" id="cheque_id" placeholder="Enter Cheque No">
                  </div>
                </div>
              </div>
                   

                <div class="col-md-6 mt-2" style="display:none;" id="upidiv">
                    <div class="row" >
                    <div class="col-md-3">
                        <label for="" class="labels">UPI No.</label>
                    </div>
                    <div class="col-md-9">
                        <input value="{{thisPayment.upi_id}}" type="text" class="form-control bg-black text-white" name="upi_id" id="upi_id" placeholder="Enter UPI ID">
                    </div>
                    </div>
                </div>

                    <div class="col-md-6 mt-2" style="display:none;"  id="bnkdiv">
                        <div class="row" >
                            <div class="col-md-3">
                              <label for="" class="labels">Bank Acc No.</label>
                            </div>
                            <div class="col-md-9">
                              <input value="{{thisPayment.bank_account_number}}" type="text" class="form-control bg-black text-white" name="bnk_id" id="bnk_id" readonly>
                            </div>
                          </div>
                    </div>
                  <!-- inbetween -->
                  <div class="clearfix mt-5">
                    <div class="col-md-12 table-responsive-md">
                        <table class="table table-bordered " id="tab_logic">
                            <thead>
                            <tr>
                                <th>#</th>
                                <th class="text-center" style="color: white;"> Date</th>
                                <th class="text-center" style="color: white;">Due Date</th>
                                <th class="text-center" style="color: white;"> Invoice Type</th>
                                <th class="text-center"  style="color: white;"> Invoice Number</th>
                                <th class="text-center"  style="color: white;"> Invoice Amount</th>
                                <th class="text-center" style="color: white;"> Payment</th>
                                <th class="text-center"style="color: white;"> Balance</th>

                            </tr>
                            </thead>
                         
                            <tbody id='invoicedata'>

                                {% for i in thisPaymentdetails %}
                                    <tr>
                                        <td>
                                            <input type="date" value="{{i.Date | date:'Y-m-d'}}" name='date[]' id="date1" class="form-control bg-black text-white date" readonly />
                                        </td>
                                        <td>
                                            <input type="date" value="{{i.Due_Date | date:'Y-m-d'}}" name='duedate[]' id="duedate1" class="form-control bg-black text-white duedate" readonly />
                                        </td>
                                        <td >
                                            <input type="text" value="{{i.invoice_type}}" name='invoicetype[]' id="invoicetype" class="form-control bg-black text-white" />
                                        </td>
                                        <td >
                                            <select name='invoiceNumber[]' id="invoiceNumber"  class="form-control bg-black text-white" onchange="handleDropdownChange(this)">
                                                <option value="{{i.invoice_number}}" data-type="{{i.invoice_type}}" selected>{{i.invoice_number}}</option>
                                                {% if i.invoice_type == 'Invoice' %}
                                                {% for o in thisInvoice %}
                                                <option value="{{o.invoice_number}}" data-type="Invoice">{{o.invoice_number}}</option>
                                                {% endfor %}
                                                {% endif %}

                                                {% if i.invoice_type == 'Recurring Invoice' %}
                                                {% for o in thisRecurringInvoice %}
                                                <option value="{{o.rec_invoice_no}}" data-type="Recurring Invoice">{{o.rec_invoice_no}}</option>
                                                {% endfor %}
                                                {% endif %}

                                                {% if i.invoice_type == 'Credit Note' %}
                                                {% for o in thisCreditNote %}
                                                <option value="{{o.credit_note_number}}" data-type="Credit Note">{{o.credit_note_number}}</option>
                                                {% endfor %}
                                                {% endif %}
                                            </select>
                                        </td>
                                        <td>
                                            <input type="text" value="{{i.invoice_amount}}" name='invoiceAmount[]' id="invoiceAmount1" class="form-control bg-black text-white tamounts amount"  />
                                        </td>
                                        
                                        <td>
                                            <input type="number" value="{{i.payment}}" name='payment[]' id="payment1" onchange="calculateBalanceForRow(this)" class="form-control bg-black text-white tpayments payment"  />
                                        </td>
                                        <td>
                                            <input type="number" value="{{i.balance}}" name='balance[]' id="balance1" class="form-control bg-black text-white tbalances balance"  readonly />
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                               
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-7" ></div>
                    <div class="col-md-5 table-responsive-md mt-3 "  id="tab_logic_total" style="background-color:rgba(0,0,0,.4); border: 1px solid rgba(128, 128, 128, 0.6); margin-left: -2vh;">
                        <div class="p-3">
                            <div class="row container-fluid p-2 m-0">
                                <div class="col-sm-4 mt-2"><label for="a" class="text-center">Total Amount</label></div>
                                <div class="col-sm-1 mt-2">:</div>
                                <div class="col-sm-7 mt-2"><input value="{{thisPayment.amount_to_apply}}" type="number"  name='tamount' id="tamount" min="0" step="any" placeholder='0.00' class="form-control" style="background-color: #43596c; color: white;" readonly></div>
                            </div>
                            <div class="row container-fluid p-2 m-0" >
                                <div class="col-sm-4 mt-2"><label for="a" class="text-center">Total Payment</label></div>
                                <div class="col-sm-1 mt-2">:</div>
                                <div class="col-sm-7 mt-2"><input type="number" value="{{thisPayment.total_payment}}" min="0" step="any" name='tpayment' id="tpayment" placeholder='0.00' class="form-control" style="background-color: #43596c; color: white;" readonly></div>
                            </div>

                            <div class="row container-fluid p-2 m-0">
                                <div class="col-sm-4 mt-2"><label for="a" class="text-center">Total Balance</label></div>
                                <div class="col-sm-1 mt-2">:</div>
                                <div class="col-sm-7 mt-2"><input value="{{thisPayment.amount_to_credit}}" type="number" min="0" step="any" name='tbalance' id="tbalance" placeholder='0.00' class="form-control" style="background-color: #43596c; color: white;" readonly></div>
                            </div>

                        </div>
                    </div>
                    <div class="mt-4">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="" id="agreeTerms" required>
                            <label for="agreeTerms">Agree to terms and conditions</label>
                            <div class="invalid-feedback">You must agree before submitting.</div>
                        </div>
                      </div>
                      <input type="hidden" name="buttonValue" id="targetInput" readonly>
                      <div class="mt-4">
                        <input type="submit" class="btn save_btn" style="background-color: chocolate; color: white;" value="SAVE" name="Saved" id="save">
                        <!-- <input class="btn save_btn" style="background-color: chocolate; color: white;" type="submit" value="DRAFT" name="Draft" id="draft"> -->
                        <input class="btn save_btn" style="background-color: chocolate; color: white;" type="reset" onclick="window.location.href=`{% url 'payment_listout' %}`" value="CANCEL" id="cancel">
                      </div>
                    </form>

                </div>
                  <!-- inbetween end -->
                </div>

                <script>
                    window.onload = function() {
                        togglePaymentDiv();
                        calculateAll()
                    };
                </script>

                
                    
                <script>
                    $(document).on('change input','#paymentRecievedNo', function() {
                        $('#PayErr').text('');
                        var num = $(this).val();
                        if(num != ""){
                            
                            $.ajax({
                                type: "GET",
                                url: "{% url 'checkPaymentNumber_editpage' thisPayment.id %}",
                                data: {
                                    paymentRecievedNo : num,
                                },
                                success: function (response) {
                                    if (response.status){
                                        $('#PayErr').text('');
                                    }else{
                                        $('#PayErr').text(response.message);
                                    }
                                }
                            })
                        }
                    });
                  </script>

                  
                  <script>
                    function togglePaymentDiv() {
                        var paymentTerm = document.getElementById("paymentTYPE").value;
                        var chequediv = document.getElementById("chequediv");
                        var upidiv = document.getElementById("upidiv");
                        var bnkdiv = document.getElementById("bnkdiv");

                        if (paymentTerm === "Cheque") {
                            chequediv.style.display = "block";
                            upidiv.style.display = "none";
                            bnkdiv.style.display = "none";
                        } else if (paymentTerm === "UPI") {
                            chequediv.style.display = "none";
                            upidiv.style.display = "block";
                            bnkdiv.style.display = "none";
                        }else if (paymentTerm === "Cash" || paymentTerm === "") {
                            chequediv.style.display = "none";
                            upidiv.style.display = "none";
                            bnkdiv.style.display = "none";
                        } else {
                            chequediv.style.display = "none";
                            upidiv.style.display = "none";
                            bnkdiv.style.display = "block";
                        }
                    }
                  </script>

                  <div class="col-md-6 mt-2"></div>
                </div>

                
          </div>
      </div>
 
</div>


<script>
    document.addEventListener("DOMContentLoaded", function() {
        const saveButton = document.getElementById("save");
        const draftButton = document.getElementById("draft");
        const targetInput = document.getElementById("targetInput");
    
        saveButton.addEventListener("click", function() {
            targetInput.value = "SAVE";
        });
    
        draftButton.addEventListener("click", function() {
            targetInput.value = "DRAFT";
        });
    
        // Attach event listener to form submit event
        $('#paymentRecievedForm').submit(function(event) {
            // Prevent default form submission
            event.preventDefault();
    
            // Get the code from the input field
            var code = $('#paymentRecievedNo').val();
    
            // AJAX request to check the code
            $.ajax({
                url: '{% url "checkPaymentNumber" %}', // URL to your server-side code checker
                method: 'get',
                data: {
                    'paymentRecievedNo': code
                },
                success: function(response) {
                    // If code is valid, submit the form
                    if (response.valid) {
                        $('#paymentRecievedForm').off('submit').submit(); // Unbind this event and submit the form
                    } else {
                        // If code is invalid, show an error message
                        alert(response.message);
                    }
                },
                error: function(xhr, status, error) {
                    // Handle AJAX error
                    console.error('Error:', error);
                }
            });
        });
    });
    </script>
    

<!-- New Customer Modal -->
<div class="modal fade" id="newCustomer">
    <div class="modal-dialog modal-xl">
      <div class="modal-content" style="background: rgb(32, 35, 37);border-radius: 20px;">
        <div class="modal-header px-3" style="background: rgb(32, 35, 37);">
            <h3 class="text-uppercase" style="color: white;">Add Customer</h3>
            <button type="button" class="close btn btn-danger" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <div class="modal-body" style="background: rgb(32, 35, 37);">
          <div class="card px-2 py-4" style="background-color: #000;">
            <form id="newCustomerForm">
              {% csrf_token %}
              <div class="form-group row mt-3">
                <label class="col-sm-12 col-md-3 col-lg-3 col-form-label" style="color: white;">Customer Type</label>
                
                <div class=" col-sm-12 col-md-3 col-lg-3">
                    <input type="radio"  value="Business" name="type" >
                    <label for="Business"> Business</label>
                    &nbsp;&nbsp;&nbsp;
                    <input  type="radio"  value="Individual" name="type" >
                    <label for="Business">Individual</label>
                </div>
              </div>
  
              <div class=" form-group row">
                <div class="col-sm-12 col-md-3 col-lg-3 col-form-label">
                    <label class="labels">Primary Contact*</label>
                </div>
                <div class="col-sm-12 col-md-1 col-lg-1" >
                    <select id="select1"  name="salutation" class="form-control bg-light text-dark mt-2 " >
                    
                        <option value="Mr">Mr</option>
                        <option value="Mrs">Mrs</option>
                        <option value="Ms">Ms</option>
                        <option value="Dr">Dr</option>
  
                    </select> 
                </div>
                <div class="col-sm-12 col-md-2 col-lg-3" >
                    <input  type="text" class="form-control bg-light text-dark mt-2 change-disply " id="fname" name="first_name" placeholder="first name" required >
  
                </div>
                <div class="col-sm-12 col-md-2 col-lg-3" >
                    <input type="text" class="form-control bg-light text-dark mt-2 " id="lname" name="last_name" placeholder="last name" required >
                </div>
              </div>
              <div class="form-group row mt-4">
                <div class="col-sm-12 col-md-3 col-lg-3 col-form-label"><label class="labels">Customer Display Name</label></div>
                <div class="col-sm-12 col-md-6 col-lg-7">
                    <select class="form-control bg-light text-dark "  name="v_display_name" id="v_display_name">
                    </select> 
                </div>
            </div>
            <div class="form-group row mt-4">
                <div class="col-sm-12 col-md-3 col-lg-3 col-form-label">
                    <label class="labels">Company Name</label>
                </div>
                <div class="col-sm-12 col-md-6 col-lg-7">
                    <input  type="text" class="form-control bg-light text-dark " id="companyName" name="company_name" required>     
                    <div class="invalid-feedback">Please fill out this field.</div>   
                </div>
            </div>
            <div class="form-group row mt-4">
                <div class="col-sm-12 col-md-3 col-lg-3 col-form-label"><label class="labels">Customer Email*</label></div>
                <div class="col-sm-12 col-md-6 col-lg-7">
                    <input  type="email" class="form-control bg-light text-dark" name="vendor_email"  id="vendor-email"  required> 
                    <span class=" text-danger mt-1" id="email-message-id" style="font-size: 10px;"></span>   
                </div>
            </div>
  
            <div class="form-group row mt-4">
                <div class="col-sm-12 col-md-3 col-lg-3 ">
                    <label class="col-form-label text-white">Customer phone*</label>
                </div>
                <div class="col-sm-12 col-md-3 col-lg-3">
                    <input id="workphone"  type="text" class="form-control bg-light text-dark mt-2" pattern="[0-9]{7}"  name="w_phone" placeholder="work phone" required>
                    <span id="work-phone-message" class="mt-2 " style="font-size: 10px;"></span >
                    <span id="workphone_label" class="mt-2 text-danger" style="font-size: 10px;"></span >
                    <div class="invalid-feedback"></div>   
                </div>
                <div class=" col-sm-12 col-md-3 col-lg-4">
                    <input id="mphone"  type="text" pattern="[0-9]{10}" class="form-control bg-light text-dark mt-2"  name="m_phone" placeholder="mobile number" required>
                    <span id="phone-message" class="mt-2 " style="font-size: 10px;"></span >
                    <span id="mphone_label" class="mt-2 text-danger" style="font-size: 10px;"></span >
                    <div class="invalid-feedback"></div>
                </div>
  
                <hr style="border: none; height: 2px; background-color: #ffcc00; margin: 20px 0;">
  
                <div class="toggle1 section-toggle">
                    <a href="">Add More Details</a>
                </div>
              </div>
  
              <fieldset1 id="more_detail" class="more details" style="display: none;">
                <div class="form-group row mt-4">
                  <div class="col-sm-12 col-md-3 col-lg-3 col-form-label">
                      <label>Skype name/Number</label>
                  </div>
                  <div class="col-sm-12 col-md-6 col-lg-6">
                      <input  type="text" class="form-control bg-light text-dark" id="skypeNumber" name="skype_number">      
                  </div>
                </div>
  
                <div class="form-group row mt-4">
                    <div class="col-sm-12 col-md-3 col-lg-3 col-form-label">
                        <label>Designation</label>
                    </div>
                    <div class="col-sm-12 col-md-6 col-lg-6">
                        <input  type="text" id="design" class="form-control bg-light text-dark" name="designation">      
                    </div>
                </div>
  
                <div class="form-group row mt-4">
                    <div class="col-sm-12 col-md-3 col-lg-3 col-form-label">
                        <label>Department</label>
                    </div>
                    <div class="col-sm-12 col-md-6 col-lg-6">
                        <input  type="text" class="form-control bg-light text-dark" id="dept" name="department">      
                    </div>
                </div>
       
                <div class="form-group row mt-4">
                    <div class="col-sm-12 col-md-3 col-lg-3 col-form-label"><label>Website</label></div>
                    <div class="col-sm-12 col-md-6 col-lg-6">
                        <input id="web" type="text" class="form-control bg-light text-dark" onclick="mobile_phone()"    name="website">      
                    </div>
                </div>
              </fieldset1>
  
              <hr style="border: none; height: 2px; background-color: #ffcc00; margin: 20px 0;">
  
              <div class="section-3">
  
                  <div class="toggle2 section-toggle"> <a href="" >Other Details </a> </div>
                  <div class="toggle3 section-toggle" > <a href="">Address </a> </div>
                  <div class="toggle4 section-toggle"><a href="" >Contact Persons </a></div>
                  <div class="toggle7 section-toggle"><a href="">Remarks</a></div>
  
              </div>
  
              <fieldset2 class="other details">
                <div class="form-group row mt-2">
                    <label class="col-sm-12 col-md-3 col-lg-3 col-form-label text-white" > GST Treatment*</label>
                    <div class=" col-sm-12 col-md-3 col-lg-3">
                        <select name="gst" id="GSTT" class="form-control bg-light text-dark" onclick="gstPan_function()">
                            <option value="" selected>Select a Gst Treatment</option>
                            <option value="Registered Business-Regular Business that is registered under GST">Registered Business-Regular Business that is registered under GST</option>
                            <option value="Registered Business-Composition Business that is registered under the Composition scheme in GST">
                                Registered Business-Composition Business that is registered under the Composition schemen in GST
                            </option>
                            <option value="Unregistered Business-not Registered under GST">Unregistered Business-not Registered under GST</option>
                            <option value="Overseas- Persons with who you do import or exports of supplies outside india">Overseas- Persons with who you do import or exports of supplies outside india</option>
                            <option value="Special Economic Zone">Special Economic Zone</option>
                        </select><br>
                    </div>
                </div>
  
                <fieldset3 id="gst" style="display: none;">
                    <div class="row mt-4">
                        <label class="col-sm-12 col-md-3 col-lg-3 col-form-label text-white"  > GSTIN/UIN*</label>
                        
                        <div class=" col-sm-12 col-md-3 col-lg-3">
                            <input type="text" class="form-control bg-light text-dark" name="gst_number" id="gstInput" > 
                            <span id="gstMessage"></span>       
                        </div>
                    </div>
  
                </fieldset3>
  
                <fieldset4 id="pan" style="display: none;">
                  <div class=" row mt-4">
                      <label class="col-sm-12 col-md-3 col-lg-3 col-form-label text-white" > PAN*</label>
                      
                      <div class=" col-sm-12 col-md-3 col-lg-3">
                          <input type="text" class="form-control bg-light text-dark"  id="panInput"  name="pan_number">  
                          <span id="panMessage"></span>    
                      </div>
                  </div>
                </fieldset4>
  
  
                <div class="form-group row mt-4">
                  <label class="col-sm-12 col-md-3 col-lg-3 col-form-label text-white" > Place of Supply*</label>
                  <div class=" col-sm-12 col-md-3 col-lg-3">
                      <select name="source_supply" id="PLACE" class="form-control bg-light text-dark">
                          <option value="value" selected></option>
                          <option value="[AN]-Andaman And Nicobar Islands">[AN]-Andaman And Nicobar Islands</option>
                          <option value="[AD]-Andhra Pradesh">[AD]-Andhra Pradesh</option>
                          <option value="[AR]-Arunachal Pradesh">[AR]-Arunachal Pradesh	</option> 
                          <option value="volvo">[AS]-Assam</option>
                          <option value="[BR]-Bihar">[BR]-Bihar</option> 
                          <option value="volvo">[CH]-	Chandhigarh</option>
                          <option value="[CG]-Chattisgarh">[CG]-Chattisgarh</option>
                          <option value="[DD]-Daman Diu">[DD]-Daman Diu</option>
                          <option value="volvo">[DL]-	Delhi</option>
                          <option value="[GA]-Goa">[GA]-Goa</option> 
                          <option value="[GJ]-Gujarat">[GJ]-Gujarat</option>
                          <option value="[HR]-Haryana">[HR]-Haryana</option> 
                          <option value="[HP]-Himachal Pradesh">[HP]-Himachal Pradesh</option>
                          <option value="[JK]-Jammu And Kashmir">[JK]-Jammu And Kashmir</option>
                          <option value="[JH]-Jharkand">[JH]-Jharkand</option>
                          <option value="[KA]-Karnataka">[KA]-Karnataka</option>
                          <option value="[KL]-Kerala">[KL]-Kerala</option>
                          <option value="[LA]-Ladakh">[LA]-Ladakh</option>
                          <option value="[LD]-Lakshadweep">[LD]-Lakshadweep</option>
                          <option value="[MP]-Madhyapradesh">[MP]-Madhyapradesh</option>
                          <option value="[MH]-Maharashtra">[MH]-Maharashtra</option>
                          <option value="[MN]-Manipur">[MN]-Manipur</option>  
                          <option value="[ML]-Meghalaya">[ML]-Meghalaya</option>
                          <option value="[MZ]-Mizoram">[MZ]-Mizoram</option>
                          <option value="[NL]-Nagaland">[NL]-Nagaland</option> 
                          <option value="[NL]-Nagaland">[NL]-Nagaland</option>
                          <option value="[OD]-Odisha">[OD]-Odisha</option>
                          <option value="[PY]-Puducherry">[PY]-Puducherry</option>
                          <option value="[PB]-Punjab">[PB]-Punjab.</option>
                          <option value="[RL]-Rajasthan">[RL]-Rajasthan</option>
                          <option value="[SK]-Sikkim">[SK]-Sikkim</option>
                          <option value="[TN]-Tamilnadu">[TN]-Tamilnadu</option>
                          <option value="[TS]-Telenghana">[TS]-Telenghana</option>
                          <option value="[TR]-Tripura">[TR]-Tripura</option>
                          <option value="[UP]-Uttar Pradesh">[UP]-Uttar Pradesh</option>
                          <option value="[UK]-Utharakhand">[UK]-Utharakhand</option>
                          <option value="[WB]-West Bengal">[WB]-West Bengal</option>
                          <option value="[OT]-Other Territory">[OT]-Other Territory</option>
                      </select>
                  </div>
                </div>
  
                <div class="form-group row mt-4">
                  <label class="col-sm-12 col-md-3 col-lg-3 col-form-label" style="color:rgb(214, 75, 75) ;">Tax Preference*</label>
                    
                  <div class="col-sm-12 col-md-3 col-lg-4 d-flex align-items-center">
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="tax1" id="Taxable" value="Taxable" required>
                        <label class="form-check-label text-white" for="vehicle1">Taxable</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="tax1" id="Tax_Exempt" value="Tax Exempt" required>
                        <label class="form-check-label text-white" for="vehicle2">Tax Exempt</label>
                    </div>
                  </div>
                </div>
                
                <div class="form-group row mt-4">
                    <label class="col-sm-12 col-md-3 col-lg-3 col-form-label text-white" > Currency</label>
                    
                    <div class=" col-sm-12 col-md-3 col-lg-3">
                        <select name="currency" id="crncy" class="form-control bg-light text-dark">
                            <option value="Indian Rupee" selected>Indian Rupee</option>
                        </select>
                    </div>
                </div>
  
                <div class="form-group row mt-2">
                  <div class="col-sm-12 col-md-3 col-lg-3 ">
                      <label class="col-form-label text-white mb-3"> Opening Balance Type</label>
                  </div>
                  <div class="col-sm-12 col-md-3 col-lg-4 d-flex align-items-center">
                      <div class="form-check form-check-inline">
                          <input class="form-check-input" type="radio" name="op_type" id="debit" value="debit">
                          <label class="form-check-label text-white" for="debit">Debit</label>
                      </div>
                      <div class="form-check form-check-inline">
                          <input class="form-check-input" type="radio" name="op_type" id="credit" value="credit">
                          <label class="form-check-label text-white" for="credit">Credit</label>
                      </div>
                  </div>
                </div>
  
                <div class="form-group row mt-4">
                    <label class="col-sm-12 col-md-3 col-lg-3 col-form-label text-white" > Opening Balance Amount</label>                    
                    <div class=" col-sm-12 col-md-3 col-lg-3">
                        <input  type="number" class="form-control bg-light text-dark" name="opening_bal" id="opa" value="0.00">      
                    </div>
                </div>
  
                <div class="form-group row mt-4">
                    <label class="col-sm-12 col-md-3 col-lg-3 col-form-label text-white" >Credit Limit</label>                    
                    <div class=" col-sm-12 col-md-3 col-lg-3">
                        <input  type="number" class="form-control bg-light text-dark" name="credit_lm" id="cl" value="0.00">      
                    </div>
                </div>
            
                <div id="custom-alert" class="customalert">
                    <span class="close-btn">&times;</span>
                    <div class="custom-alert-content">
                      Credit limit should not exceed opening balance amount.
                    </div>
                </div>
                  <style>
                    .customalert {
                            display: none;
                            position: fixed;
                            top: 30%;
                            left: 50%;
                            transform: translate(-50%, -50%);
                            background-color: #f44336;
                            color: white;
                            padding: 15px;
                            border-radius: 5px;
                            }
  
                            .close-btn {
                            float: right;
                            cursor: pointer;
                            }
  
                            .custom-alert-content {
                            margin-bottom: 10px;
                            }
                  </style>
                <div class="form-group row mt-4">
                  <label class="col-sm-12 col-md-3 col-lg-3 col-form-label text-white" > Payment Terms</label>
                  
                  <div class=" col-sm-12 col-md-3 col-lg-3">
                      <select name="payment_terms" id="paytearm-select" class="form-control bg-light text-dark">
                          {% for pay_terms in pTerms %}
                          <option value="{{pay_terms.id}}" >{{pay_terms.term_name}}</option>
                          {% endfor %}
                      </select>
                  </div>
                  <div class="col-md-4 ">
                      <a href="#" class="btn btn-outline-warning py-2 my-1" data-target="#newpayment" data-toggle="modal">+</a>
                  </div>
                </div>
  
                <div class="form-group row mt-4">
                  <label class="col-sm-12 col-md-3 col-lg-3 col-form-label text-white">Price List </label>
                    
                  <div class=" col-sm-12 col-md-3 col-lg-3">
                      <select name="plst" id="priceLs" class="form-control bg-light text-dark">
                          <option value="0">Not selected</option>
                          {% for price_list in priceListItems %}
                          <option value="{{price_list.id}}">{{price_list.name}}</option>    
                          {% endfor %}
                      </select>
                  </div>
                </div>
             
                <div class="form-group row mt-4">
                    <label class="col-sm-12 col-md-3 col-lg-3 col-form-label" style="color:white ;">
                        Portal Language</label>
                        <div class=" col-sm-12 col-md-3 col-lg-3">
                            <select name="plang" id="plang" style="width: 100%;" class="form-control bg-light text-dark">
                                <option selected value="0" >Choose..</option>
                                <option value="ENGLISH">ENGLISH</option>
                              </select>
                    </div>
                </div>   
                <div class="form-group row mt-4">
                    <label class="col-sm-12 col-md-3 col-lg-3 col-form-label" style="color:white ;">Facebook </label>
                      <div class=" col-sm-12 col-md-3 col-lg-3"> 
                        <input type="text" id="fbk" name="fbk" class="form-control bg-light text-dark" >    
                    </div>
                </div>
                <div class="form-group row mt-4">
                    <label class="col-sm-12 col-md-3 col-lg-3 col-form-label" style="color:white ;">Twitter</label>
                        <div class=" col-sm-12 col-md-3 col-lg-3">
                            <input type="text" id="twtr" name="twtr" class="form-control bg-light text-dark" >
                          
                    </div>
                </div>
              </fieldset2>
  
              <fieldset5 id="address" style="display: none;">
                <div>
                    <div class="row">
                        <div class="col-sm-12 col-md-6 col-lg-6">
                            <div class="row">
                                <div class="col-sm-12 col-md-6 col-lg-6">
                                    <label for="">BILLING ADDRESS</label>
                                </div>
                                <div class="col"></div>
                            </div>
                            <div class="form-group row mt-4">
                                <label class="col-sm-12 col-md-3 col-lg-3 col-form-label text-white" > Attention</label>                    
                                <div class=" col-sm-12 col-md-6 col-lg-6">
                                    <input  type="text" class="form-control bg-light text-dark" name="battention" id="batten">      
                                </div>
                            </div>
                            <div class="form-group row mt-4">
                                <label class="col-sm-12 col-md-3 col-lg-3 col-form-label text-white" > Country</label>                    
                                <div class=" col-sm-12 col-md-6 col-lg-6">
                                    <select name="bcountry" id="btry" class="form-control bg-light text-dark">
                                        <option value="India" selected>India</option>
                                    </select>      
                                </div>
                            </div>
                            <div class="form-group row mt-4">
                                <label class="col-sm-12 col-md-3 col-lg-3 col-form-label text-white" > Address</label>                    
                                <div class=" col-sm-12 col-md-6 col-lg-6">
                                    <textarea class="form-control bg-light " style="border: none;color: rgb(7, 7, 7);" cols="26" rows="4" name="baddress" id="badd1"></textarea>
                                </div>
                            </div>
                            <div class="form-group row mt-4">
                                <label class="col-sm-12 col-md-3 col-lg-3 col-form-label text-white" > City</label>                    
                                <div class=" col-sm-12 col-md-6 col-lg-6">
                                    <input  type="text" class="form-control bg-light text-dark" name="bcity" id="bcty">      
                                </div>
                            </div>
                            <div class="form-group row mt-4">
                                <label class="col-sm-12 col-md-3 col-lg-3 col-form-label text-white" > State</label>                    
                                <div class=" col-sm-12 col-md-6 col-lg-6">
                                    <input type="text" class="form-control bg-light text-dark" name="bstate" id="bste">      
                                </div>
                            </div>
                            <div class="form-group row mt-4">
                                <label class="col-sm-12 col-md-3 col-lg-3 col-form-label text-white" > Zip Code </label>                    
                                <div class=" col-sm-12 col-md-6 col-lg-6">
                                    <input  type="number" class="form-control bg-light text-dark" name="bzip" id="bzp">      
                                </div>
                            </div>
                        
                            <div class="form-group row mt-4">
                                <label class="col-sm-12 col-md-3 col-lg-3 col-form-label text-white" > Phone </label>                    
                                <div class=" col-sm-12 col-md-6 col-lg-6">
                                    <input id="bphone_num"  type="tel" pattern="[0-9]{10}" class="form-control bg-light text-dark" name="bphone" >
                                    <label for="" id="bphone_label"></label>      
                                </div>
                            </div>
                            <div class="form-group row mt-4">
                                <label class="col-sm-12 col-md-3 col-lg-3 col-form-label text-white" > Fax </label>                    
                                <div class=" col-sm-12 col-md-6 col-lg-6">
                                    <input  type="tel" class="form-control bg-light text-dark" pattern="[0-9]{7}" onmouseout="fax_number()"  onclick="bphone_number()" name="bfax" id="bfx">  
                                
                                    <label for="" id="fax_label"></label> 
                                </div>
                            </div>
  
                        </div>
                        <div class="col-sm-12 col-md-6 col-lg-6">
                            <div class="row">
                                <div class="col-sm-12 col-md-6 col-lg-6">
                                    <label for="">SHIPPING ADDRESS</label>
                                </div>
                                <div class="col-sm-12 col-md-6 col-lg-6">
                                    <input  type="checkbox" id="myCheckT" onclick="myCopyAddressFunction()">&nbsp;
                                    <label for="myCheck">Same as Billing Address:</label>
                                </div>
                            </div>
                            <div class="form-group row mt-4">
                                <label class="col-sm-12 col-md-3 col-lg-3 col-form-label text-white" > Attention</label>                    
                                <div class=" col-sm-12 col-md-6 col-lg-6">
                                    <input  type="text" class="form-control bg-light text-dark " style="color: white;" name="sattention" id="satten">      
                                </div>
                            </div>
                            <div class="form-group row mt-4">
                                <label class="col-sm-12 col-md-3 col-lg-3 col-form-label text-white" > Country</label>                    
                                <div class=" col-sm-12 col-md-6 col-lg-6">
                                    <select name="s_country" id="sctry" class="form-control bg-light text-dark">
                                        <option value="India" selected>India</option>
                                    </select>      
                                </div>
                            </div>
                            <div class="form-group row mt-4">
                                <label class="col-sm-12 col-md-3 col-lg-3 col-form-label text-white" > Address</label>                    
                                <div class=" col-sm-12 col-md-6 col-lg-6">
                                    <textarea class="form-control bg-light" style="border: none;color: rgb(10, 10, 10);" id="sadd1" cols="26" rows="4" name="saddress"></textarea>
                                </div>
                            </div>
                            <div class="form-group row mt-4">
                                <label class="col-sm-12 col-md-3 col-lg-3 col-form-label text-white" > City</label>                    
                                <div class=" col-sm-12 col-md-6 col-lg-6">
                                    <input  type="text" class="form-control bg-light text-dark" name="scity" id="scty">      
                                </div>
                            </div>
                            <div class="form-group row mt-4">
                                <label class="col-sm-12 col-md-3 col-lg-3 col-form-label text-white" > State</label>                    
                                <div class=" col-sm-12 col-md-6 col-lg-6">
                                    <input type="text" class="form-control bg-light text-dark" name="sstate" id="sste">      
                                </div>
                            </div>
                            <div class="form-group row mt-4">
                                <label class="col-sm-12 col-md-3 col-lg-3 col-form-label text-white" > Zip Code </label>                    
                                <div class=" col-sm-12 col-md-6 col-lg-6">
                                    <input  type="number" class="form-control bg-light text-dark" name="szip" id="szp">      
                                </div>
                            </div>
                        
  
                            <div class="form-group row mt-4">
                                <label class="col-sm-12 col-md-3 col-lg-3 col-form-label text-white" > Phone </label>                    
                                <div class=" col-sm-12 col-md-6 col-lg-6">
                                    <input  type="tel" class="form-control bg-light text-dark" pattern="[0-9]{10}" style="color: white;" name="sphone" id="sphone_num">  
                                    <label for="" id="sphone_label"></label>    
                                </div>
                            </div>
                            <div class="form-group row mt-4">
                                <label class="col-sm-12 col-md-3 col-lg-3 col-form-label text-white" > Fax </label>                    
                                <div class=" col-sm-12 col-md-6 col-lg-6">
                                    <input  type="tel" class="form-control bg-light text-dark" pattern="[0-9]{7}" style="color: white;" name="sfax" onclick="sphone_number()" onmouseout="sfax_number()" id="sfx"> 
                                    <label for="" id="sfax_label"></label>     
                                </div>
                            </div>
  
                        </div>
                    </div>
                </div>
              </fieldset5>
  
              <fieldset6 id="contact_person" style="display: none;" >
                <div class="row">
                    <div class="col-sm-12 ">
                        
                        <div class="table-responsive">
                        
                            <table id="tbl" class="table text-white" style="background-color: rgba(250, 227, 198, 0.5);">
                                <thead>
                                    <tr>
                                        
                                    <th>Salutation</th>
                                    <th>First Name</th>
                                    <th>Last Name</th>
                                    <th>Email Address</th>
                                    <th >Work Phone <br><span id="twph_label"></span></th>
                                    <th >Mobile <br><span id="tlabel"></span>    </th>
                                    <th >Skype Name/No</th>
                                    <th >Designation</th>
                                    <th >Department</th>
                                    <th>Action</th>
  
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                <td><select name="salutation[]" class="salutation form-control bg-transparent border-1 text-white" >
                                  <option value="" class="text-dark">Select</option>
                                    <option class="text-dark" value="Mr">Mr.</option>
                                    <option class="text-dark" value="Mrs">Mrs.</option>
                                    <option class="text-dark" value="Ms">Ms.</option>
                                    <option class="text-dark" value="Miss">Miss.</option>
                                    <option class="text-dark" value="Dr">Dr.</option>
                                    </select></td>
                                <td><input type="text" class="first_name form-control border-1 bg-transparent text-white"    name="first_name[]"  ></td>
                                <td><input type="text"class="last_name form-control border-1 bg-transparent text-white"  name="last_name[]" /></td>
                                <td>
                                    <input type="text" class="email form-control border-1 bg-transparent text-white" name="email[]" />
                                    
                                    
                                </td>
                                
                                <td>
                                    <input type="tel" pattern="[0-9]{7}" class="work_phone form-control border-1 bg-transparent text-white"  id="twphone" name="wphone[]"/>
                                   
                                </td>
                                <td>
                                    <input type="tel" pattern="[0-9]{10}"  class="mobile_phone form-control border-1 bg-transparent text-white"  id="tmobile" onclick="sample1()"   name="mobile[]" />
                                    
                                </td>
                                <td><input type="number" class="skype_number form-control border-1 bg-transparent text-white"  onclick="sample()" name="skype[]" /></td>
                                <td><input type="text" class="designation form-control border-1 bg-transparent text-white"  name="designation[]" /></td>
                                <td><input type="text" class="department form-control border-1 bg-transparent text-white"  name="department[]" /></td>
                                <td><button type="button" class="btn btn-danger" onclick="deleteContact(this)">Delete</button></td>
                                </tr>
                            </tbody>
                            </table>
                            
                        </div>
                        
                        <div class="button add_another mt-3 ">
                            <i class="fa fa-user-plus" aria-hidden="true"></i> 
                            <span class="text-small" style="margin-left: 0.30rem;">
                                Add Contact Person
                            </span>
                        </div>
                           
                        
                    </div>
                    
                </div>
  
              </fieldset6>
  
              <!---------------------Contact Person Section End -------------->
  
  
              <!------------------ Remark Section Start------------- -->
  
              <fieldset7 class="remarks" style="display: none;">
                  <div class="row">
                      <div class="col-sm-12 col-md-8 col-lg-8">
                          <div class="form-group row mt-4">
                              <div class=" col-sm-12 col-md-6 col-lg-6">
                                  <textarea class="bg-light w-100" style="border: none;color: rgb(5, 5, 5);" id="rmrk"  rows="5" name="remark"></textarea>
                              </div>
                          </div>
                      </div>
                      <div class="col-sm-12 col-md-2 col-lg-2"></div>
                  </div>
  
              </fieldset7>
            
            
          </form>
          <div class="row mt-5">
            <div class="col-lg-12 col-md-12 col-sm-12">
              <div class="d-flex justify-content-center">
                <button class="btn save_btn rounded-pill text-grey w-25 my-1 mx-1 btn-outline-warning" type="button" id="newCustomerSave">Save</button>
                <button type="button" class="close btn save_btn rounded-pill text-grey w-25 my-1 mx-1 btn-outline-warning close_customer_modal" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">Cancel</span></button>
              </div>
            </div>
          </div>
          </div>
        </div>
      </div>
    </div>  
  </div>
  
  
  <!-- New Customer Payment Term -->
  <div class="modal fade" id="newpayment">
    <div class="modal-dialog modal-md">
    <div class="modal-content" style="background: rgb(32, 35, 37);border-radius: 20px;">
        <div class="modal-header " style="background: rgb(32, 35, 37);">
            <h3 class="m-3 text-uppercase" style="color: white;">Add Payment Term</h3>
            <button type="button" class="close btn btn-danger" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <div class="modal-body" style="background: rgb(32, 35, 37);">
        <div class="card p-3 m-3" style="background-color: #141414a2;">
            <form action="" method="post" class="needs-validation" novalidate autocomplete="off" id="modalPayment_terms">
            
  
  
            <div class="row mt-2">
  
                <div class="col-lg-12 col-md-12 col-sm-12 mt-2">
                    <label for="termname" style="color: white">Term Name *</label>
  
                <input type="text " class="form-control text-dark bg-light mt-2" id="tname" name="term_name" autocapitalize="characters" required> 
                <span id="message-id" class="mt-1 text-danger" style="font-size: 10px;"></span> 
                <span id="success-message-id" class=" mt-1 text-success" style="font-size: 10px;"></span>    
                </div>
  
                <div class="col-lg-12 col-md-12 col-sm-12 mt-2">
                    <label for="termdays" style="color: white">Number of Days *</label>
  
                <input type="number" class="form-control text-dark bg-light mt-2" id="tdays" name="term_days" autocapitalize="characters" required>
                </div>
                <div class="col-md-2 mt-2"></div>
  
            </div>
            
            <div class="row mt-5">
                <div class="col-lg-12 col-md-12 col-sm-12">
                <div class="d-flex">
                    <button class="btn save_btn rounded-pill text-grey w-50 my-1 mx-1 btn-outline-warning "
                    type="submit" data-dismiss="modal" id="customerPaymentTermSave">Save
                    </button> 
                    
  
                    <button type="button" class="close btn save_btn rounded-pill text-grey w-50 my-1 mx-1 btn-outline-warning" 
                    data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">Cancel</span>
                    </button>
                </div>
                </div>
            </div>
            </form>
        </div>
        </div>
    </div>
    </div>  
  </div>




<!-- NEW CUSTOMER  Scripts -->
<script>
    function deleteContact(button) {
        var row = button.parentNode.parentNode;
        row.parentNode.removeChild(row);
    }
  
    document.querySelector('.add_another').addEventListener('click', function() {
        var table = document.getElementById('tbl').getElementsByTagName('tbody')[1];
        var newRow = table.insertRow(table.rows.length);
  
        for (var i = 1; i < 9; i++) {
            var cell = newRow.insertCell(i);
            cell.innerHTML = '<input type="text" class="form-control border-1 bg-transparent text-white" name="dynamic[]">';
        }
  
        var deleteCell = newRow.insertCell(9);
        deleteCell.innerHTML = '<button type="button" class="btn btn-danger" onclick="deleteContact(this)">Delete</button>';
    });
  
   
  
    $(document).ready(function() {
    // Attach event listener to input fields
    $('#opa, #cl').on('input', function() {
        // Get values of the input fields
        var openingBal = parseFloat($('#opa').val());
        var creditLimit = parseFloat($('#cl').val());
  
        // Check if credit limit is greater than opening balance amount
        if (creditLimit > openingBal) {
            // Show custom alert
            $('#custom-alert').fadeIn();
  
            // Clear the value of #cl
            $('#cl').val('');
        }
    });
  
    // Close custom alert when close button is clicked
    $('.close-btn').on('click', function() {
        $('#custom-alert').fadeOut();
    });
  });
  
  
    $(document).ready(function(){
  
    // Get the CSRF token from the cookie
        function getCookie(name) {
        var cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            var cookies = document.cookie.split(';');
            for (var i = 0; i < cookies.length; i++) {
                var cookie = cookies[i].trim();
                // Does this cookie string begin with the name we want?
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
        }
        var csrftoken = getCookie('csrftoken');
  
        // Pan Number Check
  
        $('#panInput').on('input', function(){
        var panNumber = $(this).val();
        var regex = /[A-Z]{5}[0-9]{4}[A-Z]{1}$/;
        if(regex.test(panNumber)) {
            $('#panMessage').text('PAN number is valid.').css('color', 'green');
            // PAN number is valid, call AJAX to check if it exists
            $.ajax({
            url: "{% url 'customer_check_pan' %}",
            headers: {'X-CSRFToken': csrftoken}, 
            type: 'POST',
            data: {panNumber: panNumber},
            success: function(response) {
                if (response.status == 'exists') {
                    $('#panMessage').text('PAN number already exists.').css({
                        'color': 'red',
                        'font-size': '12px'
                    });
                    
                }
            }
            });
        } else {
            $('#panMessage').text('Please enter a valid PAN number.').css({
                'color': 'red',
                'font-size': '12px'
            });
        }
        });
  
        // Pna Number Check End 
  
  
        // GST Number Check 
  
        $('#gstInput').on('input', function(){
            var gstNumber = $(this).val();
            var regex = /^[0-9]{2}[A-Z]{5}[0-9]{4}[A-Z]{1}[1-9A-Z]{1}Z[0-9A-Z]{1}$/;
            if(regex.test(gstNumber)) {
                $('#gstMessage').text('GST number is valid.').css('color', 'green');
                // GST number is valid, call AJAX to check if it exists
                $.ajax({
                    url: "{% url 'customer_check_gst' %}",
                    headers: {'X-CSRFToken': csrftoken}, 
                    type: 'POST',
                    data: {gstNumber: gstNumber},
                    success: function(response) {
                        if (response.status == 'exists') {
                            $('#gstMessage').text('GST number already exists.').css({
                                'color': 'red',
                                'font-size': '12px'
                            });
                            
                        }
                    }
                    });
            } 
            else {
                $('#gstMessage').text('Please enter a valid GST number.').css({
                    'color': 'red',
                    'font-size': '12px'
                });
            }
            });
    
        // GST Number Check End 
  
    });
  
      // Name display 
  
        
      const Title = document.getElementById('select1');
  const fname = document.getElementById('fname');
  const laname = document.getElementById('lname');
  const vDisplayName = document.getElementById('v_display_name');
  
  // Listen for input events on the initial input fields
  Title.addEventListener('input', updateOutputFields);
  fname.addEventListener('input', updateOutputFields);
  laname.addEventListener('input', updateOutputFields);
  
  // Function to update the output fields
  function updateOutputFields() {
    const selectedTitle = Title.value;
    const selectedFname = fname.value;
    const selectedLname = laname.value;
  
    // Clear existing options
    vDisplayName.innerHTML = '';
  // Add new options based on input field values
  const option1 = document.createElement('option');
    option1.text = selectedTitle + ' ' + selectedFname + ' ' + selectedLname;
    vDisplayName.add(option1);
  
   
  
    const option2 = document.createElement('option');
    option2.text = selectedFname + ' ' + selectedLname;
    vDisplayName.add(option2);
  
    const option3 = document.createElement('option');
    option3.text = selectedLname + ' ' + selectedFname;
    vDisplayName.add(option3);
  }
  
  
    function gstPan_function(){
        var x=document.getElementById('GSTT').value
        if(x=="Unregistered Business-not Registered under GST")
        {
            document.getElementById("pan").style.display="block";
            document.getElementById("gst").style.display="none";
  
            
        }
        else if((x=="Registered Business-Regular Business that is registered under GST") || (x=="Registered Business-Composition Business that is registered under the Composition scheme in GST") || (x=="Overseas- Persons with who you do import or exports of supplies outside india") || (x=="Special Economic Zone"))
        {
            document.getElementById("gst").style.display="block";
            document.getElementById("pan").style.display="block";
  
  
        }
    
    }
  
  
  
    $(document).ready(function () {
        $(".toggle1").click(function (e) {
          e.preventDefault();
          $("fieldset1").toggle();
        })
      })
      $(document).ready(function () {
        $(".toggle2").click(function (e) {
          e.preventDefault();
         
          $("fieldset2").toggle(); 
          $("fieldset5").hide();
          $("fieldset6").hide();
          $("fieldset7").hide();
  
  
      
        })
      })
  
      $(document).ready(function () {
        $(".toggle3").click(function (e) {
          e.preventDefault();
          $("fieldset5").toggle();
          $("fieldset2").hide();
          $("fieldset6").hide();
          $("fieldset7").hide();
  
        })
      })
      $(document).ready(function () {
        $(".toggle4").click(function (e) {
          e.preventDefault();
          $("fieldset6").toggle();
          $("fieldset2").hide();
          $("fieldset5").hide();
          $("fieldset7").hide();
                
        })
      })
      $(document).ready(function () {
        $(".toggle7").click(function (e) {
          e.preventDefault();
          $("fieldset7").toggle();
          $("fieldset2").hide();
          $("fieldset6").hide();
          $("fieldset5").hide();
         
  
         
        })
      })
  
  
  
    $('document').ready(function () {
        $('.add_another').click(function () {
          $("#tbl").append(`<tr>
            <td>
                <select name="salutation[]" class="salutation form-control bg-transparent border-1 text-white">
                  <option value="" class="text-dark">Select</option>
                    <option value="Mr" class="text-dark">Mr.</option>
                    <option class="text-dark" value="Mrs">Mrs.</option>
                    <option class="text-dark" value="Ms">Ms.</option>
                    <option class="text-dark" value="Miss">Miss.</option>
                    <option class="text-dark" value="Dr">Dr.</option>
                </select>  
            </td>
            <td>
                <input type="text" name="first_name[]" class="first_name form-control border-1 bg-transparent text-white"  value="" />
            </td>
            <td>
                <input type="text" name="last_name[]" class="last_name form-control border-1 bg-transparent text-white"   value="" />
            </td>
            <td>
                <input type="email" name="email[]" class="email form-control border-1 bg-transparent text-white" value="" />
            </td>
            <td>
                <input type="tel" pattern="[0-9]{7}" id="twphone" name="wphone[]" class="work_phone form-control border-1 bg-transparent text-white"  value="" />
            </td>
            <td>
                <input type="tel" pattern="[0-9]{10}" id="tmobile" onclick="sample1()" name="mobile[]" class="mobile_phone form-control border-1 bg-transparent text-white"  value="" />
            </td>
            <td>
                <input type="number" onclick="sample()" name="skype[]" class="skype_number form-control border-1 bg-transparent text-white"  value="" />
            </td>
            <td>
                <input type="text" name="designation[]" class="designation form-control border-1 bg-transparent text-white" value="" />
            </td>
            <td>
                <input type="text" name="department[]" class="department form-control border-1 bg-transparent text-white" value="" />
            </td>
            <td><button type="button" class="btn btn-danger" onclick="deleteContact(this)">Delete</button></td>
        </tr>`);
        });
      })
  
      function fieldset5_function()
      {
        document.getElementById("address").style.display="block";
      }
  
    
  
    function myCopyAddressFunction() {
        var checkBox = document.getElementById("myCheckT");
        var textatn = document.getElementById("batten");
        var txtcry = document.getElementById("bctry");
        var txtadrs11 = document.getElementById("badd1");
        var txtcty = document.getElementById("bcty");
        var txtstat = document.getElementById("bste");
        var txtzip = document.getElementById("bzp");
        var txtphone = document.getElementById("bphone_num");
        var txtfx = document.getElementById("bfx");
  
        var textatn1 = document.getElementById("satten");
        var txtcry1 = document.getElementById("sctry");
        var txtadrs21 = document.getElementById("sadd1");
        var txtcty1 = document.getElementById("scty");
        var txtstat1 = document.getElementById("sste");
        var txtzip1 = document.getElementById("szp");
        var txtphone1 = document.getElementById("sphone_num");
        var txtfx1 = document.getElementById("sfx");
        if (checkBox.checked == true) {
          textatn1.value = textatn.value;
          txtadrs21.value = txtadrs11.value;
          txtcty1.value = txtcty.value;
          txtstat1.value = txtstat.value;
          txtzip1.value = txtzip.value; 
          txtphone1.value = txtphone.value;
          txtfx1.value = txtfx.value;
          
  
  
  
          
  
        } else {
          txtadrs21.value = "";
          txtcty1.value = "";
          txtstat1.value = "";
          txtzip1.value = "";
          txtphone1.value = "";
          txtfx1.value = "";
          txtcry1.value = "";
          textatn1.value = "";
  
  
        }
      }
  
  
      function open_table()
      {
        document.getElementById("hid").style.display="block";
        
      }
  
  
  
    
  
      function bphone_number()
      {
        var a1=document.getElementById("bphone_num").value;
        var b1=document.getElementById("bphone_label");
        var expr=/^[0-9]{10}$/;
        if (!expr.test(a1)) {
            b1.style.color="red";
            b1.style.fontSize="0.750rem";
            b1.innerHTML = "Invalid Phone Number. Please Enter 10 digit Number";
        }
        else{
            b1.style.color="green";
            b1.style.fontSize="0.750rem";
            b1.innerHTML = "Valid Phone Number.";
  
        }
      }
  
      function sphone_number()
      {
        var a1=document.getElementById("sphone_num").value;
        var b1=document.getElementById("sphone_label");
        var expr=/^[0-9]{10}$/;
        if (!expr.test(a1)) {
            b1.style.color="red";
            b1.style.fontSize="0.750rem";
            b1.innerHTML = "Invalid Phone Number.";
        }
        else{
            b1.style.color="green";
            b1.style.fontSize="0.750rem";
            b1.innerHTML = "Valid Phone Number.";
  
        }
      }
  
      function fax_number()
      {
        var a1=document.getElementById("bfx").value;
        var b1=document.getElementById("fax_label");
        var expr=/^[0-9]{7}$/;
        if (!expr.test(a1)) {
            b1.style.color="red";
            b1.style.fontSize="0.750rem";
            b1.innerHTML = "Invalid Fax Number.Please Enter 7 digit Number";
        }
        else{
            b1.style.color="green";
            b1.style.fontSize="0.750rem";
            b1.innerHTML = "Valid Fax Number.";
  
        }
      }
  
      function sfax_number()
      {
        var a1=document.getElementById("sfx").value;
        var b1=document.getElementById("sfax_label");
        var expr=/^[0-9]{7}$/;
        if (!expr.test(a1)) {
            b1.style.color="red";
            b1.style.fontSize="0.750rem";
            b1.innerHTML = "Invalid Fax Number.";
        }
        else{
            b1.style.color="green";
            b1.style.fontSize="0.750rem";
            b1.innerHTML = "Valid Fax Number.";
  
        }
      }
  
    
      function sample()
      {
  
        var tbldata = document.getElementById("tbl");
        var total_rows = tbldata.rows.length;
        x=document.getElementById("tbl");
        var a1=x.rows[total_rows-1].cells[5].getElementsByTagName('input')[0].value;
  
        var b1=document.getElementById("tlabel");
  
        b1.innerHTML = "";
  
        var expr=/^[0-9]{10}$/;
        if (!expr.test(a1)) {
            b1.style.color="red";
            b1.innerHTML = "Invalid";
            b1.style.fontSize="0.750rem";
        }
        else{
            b1.style.color="green";
            b1.innerHTML = "Valid";
            b1.style.fontSize="0.750rem";
  
        }
  
       
  
      }
  
      function sample1()
      {
  
        var tbldata = document.getElementById("tbl");
        var total_rows = tbldata.rows.length;
        x=document.getElementById("tbl");
        var a1=x.rows[total_rows-1].cells[4].getElementsByTagName('input')[0].value;
  
        var b1=document.getElementById("twph_label");
  
        b1.innerHTML = "";
  
        var expr=/^[0-9]{7}$/;
        if (!expr.test(a1)) {
            b1.style.color="red";
            b1.innerHTML = "Invalid";
            b1.style.fontSize="0.750rem";
        }
        else{
            b1.style.color="green";
            b1.innerHTML = "valid";
            b1.style.fontSize="0.750rem";
  
        }
  
  
      }
  
  
  
    function vendor_display()
    {
        var x=document.getElementById("select1").value;
        var y=document.getElementById("fname").value;
        var z=document.getElementById("lname").value;
  
        document.getElementById("select2").innerHTML=x+" "+y+" "+z
    
        
    }
  
  
    // Get the input element
    const inputElement = document.getElementById("tname");
  
    // Add event listener for input event
    inputElement.addEventListener("input", function() {
        // Convert the input value to uppercase
        this.value = this.value.toUpperCase();
    });
  
  
  $(document).ready(function() {
    $('#tname').on('blur', function() {
        
        var termName = $(this).val();
       
        $.ajax({
            type: 'GET',
            url:'{% url "check_customer_term_exist" %}',
            data: {
                term_name: termName
            },
            success: function(response) {
                if (response.exists) {
                  alert('Term already exists !')
                    $('#message-id').text('Term already exists !');
                    $('#success-message-id').text('');
                  
                    $('#tname').val('');
                } else {
                    $('#success-message-id').text('Term name available !');
                    $('#message-id').text('');
                }
                
            },
            error: function(xhr, status, error) {
                console.error('Error:', error);
            }
        });
    });
  });
  
  $('#vendor-email').on('input', function() {
        
    var vendorEmail = $(this).val();
    console.log(vendorEmail)
    $.ajax({
        type: 'GET',
        url:'{% url "check_customer_email_exist" %}',
        data: {
            vendor_email: vendorEmail
        },
        success: function(response) {
            if (response.exists) {
                $('#email-message-id').text('Email id already exists !');
                $('#vendor-email').val('');
            }
            else{
                $('#email-message-id').text('');
            }
            
        },
        error: function(xhr, status, error) {
            console.error('Error:', error);
        }
    });
  });
  
  $('#workphone').on('input', function() {
        
    var wPhone = $(this).val();
    
    $.ajax({
        type: 'GET',
        url:'{% url "check_customer_work_phone_exist" %}',
        data: {
            w_Phone: wPhone
        },
        success: function(response) {
            if (response.exists) {
                $('#workphone_label').text('Work phone number already exists !');
                $('#workphone').val('');
            }
            else{
                $('#workphone_label').text('');
            }
            
        },
        error: function(xhr, status, error) {
            console.error('Error:', error);
        }
    });
  });
  
  
  $('#mphone').on('input', function() {
        
    var mPhone = $(this).val();
    
    $.ajax({
        type: 'GET',
        url:'{% url "check_customer_phonenumber_exist" %}',
        data: {
            m_Phone: mPhone
        },
        success: function(response) {
            if (response.exists) {
                $('#mphone_label').text('Phone number already exists !');
                $('#mphone').val('');
            }
            else{
                $('#mphone_label').text('');
            }
            
        },
        error: function(xhr, status, error) {
            console.error('Error:', error);
        }
    });
  });
  
    // Work Phone Number Validation 
    $(document).ready(function () {
        $('#workphone').on('input', function () {
            var inputVal = $(this).val();
            var expr = /^[0-9]{7}$/;
            if (expr.test(inputVal)) {
                $('#work-phone-message').text('Valid work phone number').css('color', 'green');
            } else {
                $('#work-phone-message').text('Invalid work phone number').css('color', 'red');
            }
        });
    });
  
    // Phone Number Validation
    $(document).ready(function () {
        $('#mphone').on('input', function () {
            var inputVal = $(this).val();
            var expr=/^[0-9]{10}$/;
            if (expr.test(inputVal)) {
                $('#phone-message').text('Valid  phone number').css('color', 'green');
            } else {
                $('#phone-message').text('Invalid  phone number').css('color', 'red');
            }
        });
    });
  
    $(document).on("click","#customerPaymentTermSave",function(){
          var trm = $('#tname').val();
          var dys = $("#tdays").val();
          if (trm !="" && dys !=""){
              $.ajax({
                  type : 'POST',
                  url:"{% url 'newPaymentTermAjax' %}",
                  data:{
                      'term' : trm,
                      'days' : dys,
                      csrfmiddlewaretoken: '{{ csrf_token }}'
                  },
                  
                  success: function(response) {
                      if(response.status){
                          document.getElementById("newTermForm").reset();
                          
                          var dropdown = $('#paytearm-select');
                          dropdown.empty();
                          dropdown.append(`<option value="" selected>Choose</option>`);
                          $.each(response, function(key, value) {
                              for(let i=0; i<value.length; i++){
                                  if(value[i].name == trm){
                                      dropdown.append($('<option selected></option>').text(value[i].name).val(value[i].id))
                                  }else{
                                      dropdown.append($('<option></option>').text(value[i].name).val(value[i].id))
                                  }   
                              }
                          });
  
                      }else{
                          alert("Something went wrong.!")
                      }
                  },         
              });
          }
          else{
              alert('Invalid')
          }
      });
  
  
      $(document).on("click", "#newCustomerSave", function(){
      var type = $('input[name="type"]:checked').val();
      var title = $('#select1').val();
      var fName = $('#fname').val();
      var lName = $('#lname').val();
      var placeSupply = $('#PLACE').val();
      var gstType = $("#GSTT").val();
      var gstIN = $("#gstInput").val();
      var panNo = $("#panInput").val();
      var Email = $("#vendor-email").val();
      var Mob = $("#mphone").val();
      var street = $("#badd1").val();
      var city = $("#bcty").val();
      var state = $("#bste").val();
      var pin = $("#bzp").val();
      var country = $("#btry").val();
      var tax_ref = $('input[name="tax1"]:checked').val();
      var tSalutation = []
      var tFirstName = []
      var tLastName = []
      var tEmail = []
      var tWork = []
      var tMobile = []
      var tSkype = []
      var tDesignation = []
      var tDepartment = []

      if(gstType != "" && gstType != "Unregistered Business-not Registered under GST" && gstType != 'Overseas- Persons with who you do import or exports of supplies outside india' && gstIN == ""){
          alert('Fill Enter GSTIN..!')
          return
      }

      $('#tbl tbody tr').each(function(){
        var row = $(this)
        if(row != ""){
            var sal = row.find('.salutation').val();
            var fn = row.find('.first_name').val();
            var ln = row.find('.last_name').val();
            var eml = row.find('.email').val();
            var wrk = row.find('.work_phone').val();
            var mob = row.find('.mobile_phone').val();
            var sky = row.find('.skype_number').val();
            var dep = row.find('.department').val();
            var des = row.find('.designation').val();
            console.log(sal,fn,ln, eml,wrk, mob, sky, dep, des)
            // if(sal == "" && fn == "" && ln == "" && eml == "" && wrk == "" && mob == "" && sky == "" && dep == "" && des == ""){
            //     console.log('No table data')
            // }else{
            //     if(sal == "" || fn == "" || ln == "" || eml == "" || wrk == "" || mob == "" || sky == "" || dep == "" || des == ""){
            //         // alert('Fill All Fields of Contact persons table')
            //         // return
            //     }
            // }
            tSalutation.push(sal);
            tFirstName.push(fn);
            tLastName.push(ln);
            tEmail.push(eml);
            tWork.push(wrk);
            tMobile.push(mob);
            tSkype.push(sky);
            tDesignation.push(des);
            tDepartment.push(dep);
        }
    })
    var cols = [tSalutation,tFirstName,tLastName,tEmail,tWork,tMobile,tSkype,tDesignation,tDepartment]
    var cntactTableLength = $('#tbl tbody tr').length
    var nullExists = false
    if(cntactTableLength == 1 && tSalutation[0] == "" && tFirstName[0] == "" && tLastName[0] == "" && tEmail[0] == "" && tWork[0] == "" && tMobile[0] == "" && tSkype[0] == "" && tDesignation[0] == "" && tDepartment[0] == ""){
        console.log('No table data')
    }else{
        for(i=0; i<cols.length; i++){
            for(j=0; j<cols[i].length; j++){
                if(cols[i][j] == ''){
                    nullExists = true
                }
            }
        }
        // if(sal == "" || fn == "" || ln == "" || eml == "" || wrk == "" || mob == "" || sky == "" || dep == "" || des == ""){
        //     // alert('Fill All Fields of Contact persons table')
        //     // return
        // }
    }
    if(nullExists){
        alert('Fill All Fields of Contact persons table')
        return
    }

      if(fName != "" && lName != "" && placeSupply != "" && gstType != "" && panNo != "" && Email != "" && Mob != "" && tax_ref != undefined){
          $.ajax({
              type : 'POST',
              url:"{% url 'newCustomerAjax' %}",
              data:{
                'type': type,
                'salutation' : title,
                'first_name' : fName,
                'last_name' : lName,
                'company_name' : $('#companyName').val(),
                'v_display_name' : $('#v_display_name').val(),
                'vendor_email' : Email,
                'w_phone' : $('#workphone').val(),
                'm_phone' : Mob,
                'skype_number' : $('#skypeNumber').val(),
                'designation' : $('#design').val(),
                'department' : $('#dept').val(),
                'website' : $('#web').val(),
                'gst' : gstType,
                'remark' : $('#rmrk').val(),
                'pan_number' : panNo,
                'gst_number' : gstIN,
                'source_supply' : placeSupply,
                'currency' : $('#crncy').val(),
                'op_type' : $('input[name="op_type"]:checked').val(),
                'opening_bal' : $('#opa').val(),
                'payment_terms' : $('#paytearm-select').val(),
                'plst' : $('#priceLs').val(),
                'plang' : $('#plang').val(),
                'fbk' : $('#fbk').val(),
                'twtr' : $('#twtr').val(),
                'tax1' : tax_ref,
                'battention' : $('#batten').val(),
                'bcountry' : country,
                'baddress' : street,
                'bcity' : city,
                'bstate' : state,
                'bzip' : pin,
                'bphone' : $('#bphone_num').val(),
                'bfax' : $('#bfx').val(),
                'sattention' : $('#satten').val(),
                's_country' : $('#sctry').val(),
                'saddress' : $('#sadd1').val(),
                'scity' : $('#scty').val(),
                'sstate' : $('#sste').val(),
                'szip' : $('#szp').val(),
                'sphone' : $('#sphone_num').val(),
                'sfax' : $('#sfx').val(),
                'tsalutation[]' : tSalutation,
                'tfirstName[]' : tFirstName,
                'tlastName[]' : tLastName,
                'tEmail[]' : tEmail,
                'tWorkPhone[]' : tWork,
                'tMobilePhone[]' : tMobile,
                'tSkype[]' : tSkype,
                'tDesignation[]' : tDesignation,
                'tDepartment[]' : tDepartment,
                csrfmiddlewaretoken: '{{ csrf_token }}',
              },

              success: function(response) {
                if(response.status){
                    console.log("AJAX Success",response)
                    document.getElementById("newCustomerForm").reset();
                    if($('#newCustomer').hasClass('show')){
                        $("#newCustomer .close_customer_modal").click()
                    }
                    reloadCustomer(title, fName, lName);
                }else{
                    alert(response.message)
                }
              },
          });
      }else{
          alert('Fill all required fields..!')
          return
      }
  });


  function reloadCustomer(title,fName,lName) {
      const fullName = title+' '+fName+' '+lName
      $.ajax({
          url: "{% url 'getCustomers_pay' %}",
          type: "GET",
          dataType: "json",
          data: {},

          success: function(data) {
              console.log('Ajax Response ->',data);
              var custDrpDwn = $('#cust_drop');
              custDrpDwn.empty();
              custDrpDwn.append(`<li class="dropdown-item customers-options text-white" onclick="getCustomerDetails('','')">Select Customer</li>`);

              $.each(data, function (key, value) {
                  const customerDetails = `${value[1]} ${value[2]} ${value[3]}`;
                  const ID = `${value[0]}`

                  if(customerDetails == fullName){
                      getCustomerDetails(value[0], customerDetails)
                  }
                  const listItem = $(`
                      <li class="dropdown-item customers-options text-white" onclick="getCustomerDetails('${ID}', '${customerDetails}')">${customerDetails}</li>`
                  );
                  custDrpDwn.append(listItem);
              });
              console.log('Customers RELOADED');

          },
          error: function(xhr, status, error) {
              console.error(xhr.responseText);
          }

      });
      // refreshCustomerDetails();

      if ($('#newpayment').hasClass('show')){
          $('#newpayment .cust_payment_modal_close').click();
      }
  }

  function filterCustomers(){
      var options = $('#cust_drop').children();
      var search_text = $("#customer").val().toLowerCase();
      options.each(function(){
          if($(this).text().toLowerCase().includes(search_text)){
              $(this).show()
          }else{
              $(this).hide()
          }
      })
  }


  window.onload = function() {
            // Get the table element
            var table = document.getElementById("invoicedata");

            // Loop through each row in the table
            for (var i = 0; i < table.rows.length; i++) {
                // Get the row
                var row = table.rows[i];

                // Create a new cell for the index
                var cell = row.insertCell(0);

                // Add the index number to the cell (starting from 1)
                cell.innerHTML = i + 1;
            }
        };

//   ====================================================================================================================================================================================================================
  function getCustomerDetails(custId, name){
    $('#customer').val(name);
    console.log('name', name);
    if ($('#customer').val() != "") {
        $('#custErr').text('');
        $.ajax({
            type: 'POST',
            url: "{% url 'getCustomerDetailsAjax3' %}", 
            data: {
                id: custId,
                csrfmiddlewaretoken: '{{ csrf_token }}',
            },
            success: function(data) {
                console.log('AJAX-Response-->', data);
                document.getElementById('customerId').value = data.id;
                document.getElementById('customerEmail').value = data.email;
                document.getElementById('placeOfSupply').value = data.shipState;
                document.getElementById('customerGstType').value = data.gstType;

                if (data.street == "" && data.city == "" && data.state == "") {
                    $("#billAddressSection").hide();
                } else {
                    $('#billAddressSection').show();
                    document.getElementById('billAddress').value = data.street + ',' + data.city + '\n' + data.state + '\n' + data.country + '\n' + data.pincode;
                }
                if (data.gstin) {
                    document.getElementById('customerGstInDisplay').style.display = 'flex';
                    document.getElementById('customerGSTIN').value = data.gstNo;
                } else {
                    document.getElementById('customerGstInDisplay').style.display = 'none';
                    document.getElementById('customerGSTIN').value = '';
                }

                if(data.invoice.length === 0){
                    var table = $('#invoicedata');
                    table.empty();
                    
                }else{
                    var table = $('#invoicedata');
                    table.empty();
                    $.each(data.invoice, function(index, invoice) { 
                        var indexNumber = index + 1;
                        var newRow =  ` <tr id='${invoice[3]}+'row'>
                    <td >
                        <label class=' text-white'>${indexNumber}</label>
                    </td>
                    <td >
                        <input type='date' name='date' id='date1' value='${invoice[1]}' class='form-control bg-black text-white date' readonly />
                    </td>
                    <td >
                        <input type='date' name='duedate' id='duedate1' value='${invoice[2]}' class='form-control bg-black text-white duedate' readonly />
                    </td>
                    <td style="width: 15%;">
                        <input type='text' name='invoicetype[]' id='invoicetype'  value='${invoice[3]}' class='form-control bg-black text-white' />
                    </td>
                    <td >
                        <select name='invoiceNumber[]' class='form-control bg-black text-white' onchange="handleDropdownChange(this)">
                            <option selected value='${invoice[4]}' data-type="${invoice[3]}">${invoice[4]}</option>
                        </select>
                    </td>
                    <td>
                        <input type='text' name='invoiceAmount[]' onchange="updateBalanceForAmount(this)" oninput="updateBalanceForAmount(this)" value='${invoice[5]}' id='invoiceAmount1' class='form-control bg-black text-white amount tamounts' value='0' />
                    </td>
                    <td>
                        <input type='number' name='payment[]' id='payment1' onchange="calculateBalanceForRow(this)" value='${invoice[6]}' class='form-control bg-black text-white payment tpayments' value='0' />
                    </td>
                    <td>
                        <input type='number' name='balance[]' id='balance1' value='${invoice[7]}' class='form-control bg-black text-white balance tbalances' value='0' readonly />
                    </td>
                </tr> ` ;
                        table.append(newRow);
                    });


                    
                    // Iterate over each row in the table
                    $("#invoicedata tr").each(function(index, row) {
                        // Get the value of the 3rd column (index 2)
                        var invoiceType = $(row).find("td:eq(2) input[name='invoicetype[]']").val();

                        // Iterate over invoicelist
                        $.each(data.invoicelist, function(i, invoicelist) {
                            // Check if the invoiceType matches any item in invoicelist
                            if (invoiceType.toLowerCase() == invoicelist[2].toLowerCase()) {
                                // Get the dropdown in the 4th column of the current row
                                var dropdown = $(row).find("td:eq(3) select");
                                // Add option to the dropdown
                                console.log('123123123===',invoicelist[0],invoicelist[2])
                                dropdown.append($("<option></option>")
                                    .attr("value", invoicelist[1])
                                    .data("type", invoicelist[2])
                                    .text(invoicelist[1]));
                            }
                        });
                    });

                    calculateBalance();
                    calculateAmount();
                    calculatePayment();
                }
                
                
            }
        });
    } else {
        document.getElementById('customerEmail').value = "";
        document.getElementById('placeOfSupply').value = "";
        document.getElementById('customerGstType').value = "";
        document.getElementById('billAddress').value = "";
        document.getElementById('customerGSTIN').value = "";
        $('#custErr').text('Select a customer..');
        var dropdown = $('#invoiceNum');
        dropdown.empty();
        dropdown.append($('<option></option>').attr('value', '').text('Select'));
    }
}

function calculateBalanceForRow(paymentInput) {
    // Get the parent row of the payment input
    const row = paymentInput.closest("tr");
    
    // Get input fields for invoiceAmount, payment, and balance in this row
    const invoiceAmountInput = row.querySelector(".tamounts");
    const balanceInput = row.querySelector(".tbalances");
    
    // Get the values from invoiceAmount and payment inputs
    const invoiceAmount = parseFloat(invoiceAmountInput.value);
    const payment = parseFloat(paymentInput.value);
    
    // Calculate the balance
    const balance = invoiceAmount - payment;
    
    // Update the value of the balance input
    balanceInput.value = balance.toFixed(2);
    calculateAll();
}

// Wait for the document to be fully loaded
document.addEventListener("DOMContentLoaded", function() {
    calculateAll();
    // Get all payment inputs
    const paymentInputs = document.querySelectorAll(".tpayments");

    // Add event listeners to all payment inputs
    paymentInputs.forEach(paymentInput => {
        paymentInput.addEventListener("input", function() {
            calculateBalanceForRow(this);
        });
    });
});



function updateBalanceForAmount(amountInput) {
    // Get the parent row of the amount input
    const row = amountInput.closest("tr");
    
    // Get input fields for invoiceAmount, payment, and balance in this row
    const balanceInput = row.querySelector(".tbalances");
    const paymentInput = row.querySelector(".tpayments");

    // Get the values from invoiceAmount and payment inputs
    const invoiceAmount = parseFloat(amountInput.value);
    const payment = parseFloat(paymentInput.value);
    
    // Calculate the balance
    const balance = invoiceAmount - payment;
    
    // Update the value of the balance input
    balanceInput.value = balance.toFixed(2);
    calculateAll();
}

// Wait for the document to be fully loaded
document.addEventListener("DOMContentLoaded", function() {
    // Get all amount inputs
    const amountInputs = document.querySelectorAll(".tamounts");

    // Add event listeners to all amount inputs
    amountInputs.forEach(amountInput => {
        amountInput.addEventListener("input", function() {
            updateBalanceForAmount(this);
        });
    });
});








function calculateBalance() {
    var table = document.getElementById("invoicedata");
    var total = 0;
    for (var i = 1; i < table.rows.length; i++) {
        var row = table.rows[i];
        var balanceCell = row.cells[row.cells.length - 1];
        var balanceInput = balanceCell.querySelector("input");
        var balance = parseFloat(balanceInput.value);

        var invoiceTypeCell = row.cells[3]; // Assuming invoicetype is in the 4th column
        var invoiceType = invoiceTypeCell.querySelector("input").value;

        // Subtract balance if invoiceType is "Credit Note"
        if (invoiceType.trim().toLowerCase() === "credit note") {
            total -= balance;
        } else {
            total += balance;            
        }
    }
    document.getElementById("tbalance").value = total.toFixed(2);
}
function calculatePayment() {
    var table = document.getElementById("invoicedata");
    var totalSixth = 0;
    for (var i = 1; i < table.rows.length; i++) {
        var row = table.rows[i];
        var sixthCell = row.cells[6]; // Index 5 corresponds to the 6th column
        var value = parseFloat(sixthCell.querySelector("input").value);
        
        var invoiceTypeCell = row.cells[3]; // Assuming invoicetype is in the 4th column
        var invoiceType = invoiceTypeCell.querySelector("input").value;

        // Subtract value if invoiceType is "Credit Note"
        if (invoiceType.trim().toLowerCase() === "credit note") {
            totalSixth -= value;
        } else {
            totalSixth += value;
        }
    }
    document.getElementById("tpayment").value = totalSixth.toFixed(2);
}

function calculateAmount() {
    var table = document.getElementById("invoicedata");
    var totalFifth = 0;
    for (var i = 1; i < table.rows.length; i++) {
        var row = table.rows[i];
        var fifthCell = row.cells[5]; // Index 4 corresponds to the 5th column
        var value = parseFloat(fifthCell.querySelector("input").value);
        
        var invoiceTypeCell = row.cells[3]; // Assuming invoicetype is in the 4th column
        var invoiceType = invoiceTypeCell.querySelector("input").value;

        // Subtract value if invoiceType is "Credit Note"
        if (invoiceType.trim().toLowerCase() === "credit note") {
            totalFifth -= value;
        } else {
            totalFifth += value;
        }
    }
    document.getElementById("tamount").value = totalFifth.toFixed(2);
}


function calculateAll() {
    setTimeout(function() {
        calculateBalance();
        calculateAmount();
        calculatePayment();
    }, 300);
}


// Define a function to handle the dropdown change event
function handleDropdownChange(selectElement) {
    // Get the selected option element
    var selectedOption = $(selectElement).find('option:selected');
    
    var selectedType = selectedOption.data('type');
    var selectedValue = selectElement.value;

    console.log('handle--------',selectedValue, selectedType)
    $.ajax({
        url: '{% url "changeInvoiceRow" %}', 
        method: 'POST', // or 'GET' depending on your server endpoint
        data: {
            value: selectedValue,
            type: selectedType,
            csrfmiddlewaretoken: '{{ csrf_token }}',
        },
        success: function(response) {
            
            var tr = $(selectElement).closest('tr');
            

            tr.find('.date').val(response.date);
            tr.find('.duedate').val(response.duedate);
            tr.find('.amount').val(response.amount);
            tr.find('.payment').val(response.payment);
            tr.find('.balance').val(response.balance);
            calculateAll();
        },
        error: function(xhr, status, error) {
            alert('something went wrong',response.error)
        }
    });
}




  </script>     
  
  
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <div class="modal fade" id="newPaymentTerm">
    <div class="modal-dialog modal-md">
    <div class="modal-content" style="background: rgb(32, 35, 37);border-radius: 20px;">
        <div class="modal-header px-3" style="background: rgb(32, 35, 37);">
            <h3 class="text-uppercase" style="color: white;">Add Payment Term</h3>
            <button type="button" class="close btn btn-danger" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <div class="modal-body" style="background: rgb(32, 35, 37);">
        <div class="card px-2 py-4" style="background-color: #141414a2;">
            <form action="" method="post" class="needs-validation" novalidate autocomplete="off" id="newTermForm">
            
            <div class="row mt-2">
  
                <div class="col-lg-12 col-md-12 col-sm-12 mt-2">
                    <label for="termname" style="color: white">Term Name *</label>
  
                  <input type="text " class="form-control text-dark bg-light mt-2" id="termName" name="term_name" autocapitalize="characters" required> 
                  <span id="message-id" class="mt-1 text-danger" style="font-size: 10px;"></span> 
                  <span id="success-message-id" class=" mt-1 text-success" style="font-size: 10px;"></span>    
                </div>
  
                <div class="col-lg-12 col-md-12 col-sm-12 mt-2">
                      <label for="termdays" style="color: white">Number of Days *</label>
  
                  <input type="number" class="form-control text-dark bg-light mt-2" id="termDays" name="term_days" autocapitalize="characters" required>
                  </div>
                  <div class="col-md-2 mt-2"></div>
  
              </div>
            
                  <div class="row mt-5">
                    <div class="col-lg-12 col-md-12 col-sm-12">
                      <div class="d-flex">
                        <button class="btn save_btn rounded-pill text-grey w-50 my-1 mx-1 btn-outline-warning "
                        type="submit" data-dismiss="modal" id="savePaymentTerm">Save
                        </button> 
                        
  
                        <button type="button" class="close btn save_btn rounded-pill text-grey w-50 my-1 mx-1 btn-outline-warning" 
                        data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">Cancel</span>
                        </button>
                      </div>
                    </div>
                </div>
              </form>
            </div>
          </div>
        </div>
    </div>  
  </div>


<!-- payment scripts -->
<script>
$(document).on("click","#savePaymentTerm",function(){
    var trm = $('#termName').val();
    var dys = $("#termDays").val();
    if (trm !="" && dys !=""){
        $.ajax({
            type : 'POST',
            url:"{% url 'newinvPaymentTerm' %}",
            data:{
                'term' : trm,
                'days' : dys,
                csrfmiddlewaretoken: '{{ csrf_token }}'
            },
            
            success: function(response) {
                if(response.status){
                    document.getElementById("newTermForm").reset();
                    
                    var dropdown = $('#paymentTerm');
                    dropdown.empty();
                    dropdown.append(`<option value="" selected>Choose</option>`);
                    $.each(response, function(key, value) {
                        for(let i=0; i<value.length; i++){
                            if(value[i].name == trm){
                                dropdown.append($('<option selected></option>').attr('text',value[i].days).text(value[i].name).val(value[i].id))
                            }else{
                                dropdown.append($('<option></option>').attr('text',value[i].days).text(value[i].name).val(value[i].id))
                            }   
                        }
                    });

                    findDueDate();

                }else{
                    alert("Something went wrong.!")
                }
            },         
        });
    }
    else{
        alert('Invalid')
    }
});

function findDueDate(){
    var days = parseInt($('#paymentTerm').find(":selected").attr('text'))
    start_date =new Date($('#startDate').val())

    if (!isNaN(start_date.getTime())) {

        const endDate = new Date(start_date);
        endDate.setDate(endDate.getDate() + days);

        const isoString = endDate.toISOString(); 
        const day = isoString.slice(8, 10);
        const month = isoString.slice(5, 7);
        const year = isoString.slice(0, 4);

        const formattedDate = `${day}-${month}-${year}`;

        document.getElementById("endDate").value = formattedDate;
    } else {
            alert("Please enter a valid date.");
            $('#paymentTerm').val('')
    }
}

$('#paymentTerm').on('change', function () {
    findDueDate();
});

$('#startDate').on('change', function() {
    findDueDate();
});
</script>
{% endblock %}